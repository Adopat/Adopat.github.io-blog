<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx | Adopat的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/blog/logo.jpeg">
    <link rel="manifest" href="/blog/logo.jpeg">
    <link rel="apple-touch-icon" href="/blog/logo.jpeg">
    <link rel="mask-icon" href="/blog/logo.jpeg" color="#3eaf7c">
    <meta name="description" content="长路漫漫，唯键作伴">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="expires" cotent="0">
    <meta http-quiv="pragma" cotent="no-cache, must-revalidate">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta charset="utf-8">
    
    <link rel="preload" href="/blog/assets/css/0.styles.c74f429a.css" as="style"><link rel="preload" href="/blog/assets/js/app.f600c34c.js" as="script"><link rel="preload" href="/blog/assets/js/3.1aae9359.js" as="script"><link rel="preload" href="/blog/assets/js/1.ae8a88ec.js" as="script"><link rel="preload" href="/blog/assets/js/57.b7d9dbdd.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.d3b9c11d.js"><link rel="prefetch" href="/blog/assets/js/11.acb152df.js"><link rel="prefetch" href="/blog/assets/js/12.c8509742.js"><link rel="prefetch" href="/blog/assets/js/13.811061e2.js"><link rel="prefetch" href="/blog/assets/js/14.db6b0e70.js"><link rel="prefetch" href="/blog/assets/js/15.2ce37a4a.js"><link rel="prefetch" href="/blog/assets/js/16.b3452aec.js"><link rel="prefetch" href="/blog/assets/js/17.dc1a8405.js"><link rel="prefetch" href="/blog/assets/js/18.f03199ab.js"><link rel="prefetch" href="/blog/assets/js/19.bb1e396b.js"><link rel="prefetch" href="/blog/assets/js/20.4e2d0adb.js"><link rel="prefetch" href="/blog/assets/js/21.b67291e2.js"><link rel="prefetch" href="/blog/assets/js/22.057ea7c4.js"><link rel="prefetch" href="/blog/assets/js/23.70da62c2.js"><link rel="prefetch" href="/blog/assets/js/24.8cd404c5.js"><link rel="prefetch" href="/blog/assets/js/25.e637bb66.js"><link rel="prefetch" href="/blog/assets/js/26.bb3896ad.js"><link rel="prefetch" href="/blog/assets/js/27.021e6dc3.js"><link rel="prefetch" href="/blog/assets/js/28.6949fbc1.js"><link rel="prefetch" href="/blog/assets/js/29.6c652456.js"><link rel="prefetch" href="/blog/assets/js/30.f23dfdea.js"><link rel="prefetch" href="/blog/assets/js/31.3dcf5164.js"><link rel="prefetch" href="/blog/assets/js/32.b554bb64.js"><link rel="prefetch" href="/blog/assets/js/33.6ba9e186.js"><link rel="prefetch" href="/blog/assets/js/34.2ae1eb6a.js"><link rel="prefetch" href="/blog/assets/js/35.1fe5b5a2.js"><link rel="prefetch" href="/blog/assets/js/36.614599d6.js"><link rel="prefetch" href="/blog/assets/js/37.311ebd2c.js"><link rel="prefetch" href="/blog/assets/js/38.50bccc51.js"><link rel="prefetch" href="/blog/assets/js/39.fc5b9233.js"><link rel="prefetch" href="/blog/assets/js/4.1dd123be.js"><link rel="prefetch" href="/blog/assets/js/40.f5520796.js"><link rel="prefetch" href="/blog/assets/js/41.a23e6477.js"><link rel="prefetch" href="/blog/assets/js/42.1ad13e0e.js"><link rel="prefetch" href="/blog/assets/js/43.1235eb55.js"><link rel="prefetch" href="/blog/assets/js/44.e50bce95.js"><link rel="prefetch" href="/blog/assets/js/45.96aaada5.js"><link rel="prefetch" href="/blog/assets/js/46.f656cba5.js"><link rel="prefetch" href="/blog/assets/js/47.e170369f.js"><link rel="prefetch" href="/blog/assets/js/48.95e08a63.js"><link rel="prefetch" href="/blog/assets/js/49.eaea0707.js"><link rel="prefetch" href="/blog/assets/js/5.4cb445b4.js"><link rel="prefetch" href="/blog/assets/js/50.b1126e4d.js"><link rel="prefetch" href="/blog/assets/js/51.c28c85ff.js"><link rel="prefetch" href="/blog/assets/js/52.431357ea.js"><link rel="prefetch" href="/blog/assets/js/53.be380102.js"><link rel="prefetch" href="/blog/assets/js/54.5877a497.js"><link rel="prefetch" href="/blog/assets/js/55.e1d5dddb.js"><link rel="prefetch" href="/blog/assets/js/56.1962bc1e.js"><link rel="prefetch" href="/blog/assets/js/58.b5d9b427.js"><link rel="prefetch" href="/blog/assets/js/59.e07757a4.js"><link rel="prefetch" href="/blog/assets/js/6.e02ce0fc.js"><link rel="prefetch" href="/blog/assets/js/60.50d5d207.js"><link rel="prefetch" href="/blog/assets/js/61.2bdc68d5.js"><link rel="prefetch" href="/blog/assets/js/62.6f6c77db.js"><link rel="prefetch" href="/blog/assets/js/63.fd62d822.js"><link rel="prefetch" href="/blog/assets/js/64.d83a9500.js"><link rel="prefetch" href="/blog/assets/js/65.e76b3053.js"><link rel="prefetch" href="/blog/assets/js/66.de39f9b4.js"><link rel="prefetch" href="/blog/assets/js/67.44ce2347.js"><link rel="prefetch" href="/blog/assets/js/68.9efe46cd.js"><link rel="prefetch" href="/blog/assets/js/69.a06475fc.js"><link rel="prefetch" href="/blog/assets/js/7.3df43e48.js"><link rel="prefetch" href="/blog/assets/js/70.d38d05d7.js"><link rel="prefetch" href="/blog/assets/js/71.563b0c4a.js"><link rel="prefetch" href="/blog/assets/js/72.14bc1390.js"><link rel="prefetch" href="/blog/assets/js/73.9d176c78.js"><link rel="prefetch" href="/blog/assets/js/74.3a37688f.js"><link rel="prefetch" href="/blog/assets/js/75.7c4802f6.js"><link rel="prefetch" href="/blog/assets/js/76.7309aafa.js"><link rel="prefetch" href="/blog/assets/js/77.418b1686.js"><link rel="prefetch" href="/blog/assets/js/78.8b748ecf.js"><link rel="prefetch" href="/blog/assets/js/8.417a4fef.js"><link rel="prefetch" href="/blog/assets/js/9.28024d7d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.c74f429a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1c636796><div data-v-1c636796><div class="password-shadow password-wrapper-out" style="display:none;" data-v-2c3e9f55 data-v-1c636796 data-v-1c636796><h3 class="title" data-v-2c3e9f55>Adopat的博客</h3> <p class="description" data-v-2c3e9f55>长路漫漫，唯键作伴</p> <label id="box" class="inputBox" data-v-2c3e9f55><input type="password" value="" data-v-2c3e9f55> <span data-v-2c3e9f55>Konck! Knock!</span> <button data-v-2c3e9f55>OK</button></label> <div class="footer" data-v-2c3e9f55><span data-v-2c3e9f55><i class="iconfont reco-theme" data-v-2c3e9f55></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-2c3e9f55>vuePress-theme-reco</a></span> <span data-v-2c3e9f55><i class="iconfont reco-copyright" data-v-2c3e9f55></i> <a data-v-2c3e9f55><span data-v-2c3e9f55>Adopat</span>
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-1c636796><header class="navbar" data-v-1c636796><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.jpeg" alt="Adopat的博客" class="logo"> <span class="site-name">Adopat的博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  HOME
</a></div><div class="nav-item"><a href="/blog/handbook/about/" class="nav-link"><i class="iconfont reco-document"></i>
  导读
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/handbook/basic/composition-principle.html" class="nav-link"><i class="fa fa-solid fa-computer"></i>
  计算机基础
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/frontend/basic.html" class="nav-link"><i class="fa fa-brands fa-js"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/backend/java-core-basic.html" class="nav-link"><i class="fa fa-brands fa-java"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/database/" class="nav-link"><i class="fa fa-solid fa-database"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/bigdata/hadoop.html" class="nav-link"><i class="fa fa-brands fa-hive"></i>
  大数据
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/ml/python-core.html" class="nav-link"><i class="fa fa-brands fa-python"></i>
  人工智能
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/devops/docker.html" class="nav-link"><i class="fa fa-brands fa-docker"></i>
  运维
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/tools/Git.html" class="nav-link"><i class="fa fa-solid fa-toolbox"></i>
  常用开发工具
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      友情链接
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_44446122?type=blog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Adopat" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1c636796></div> <aside class="sidebar" data-v-1c636796><div class="personal-info-wrapper" data-v-6f92ba70 data-v-1c636796><!----> <h3 class="name" data-v-6f92ba70>
    Adopat
  </h3> <div class="num" data-v-6f92ba70><div data-v-6f92ba70><h3 data-v-6f92ba70>67</h3> <h6 data-v-6f92ba70>文章</h6></div> <div data-v-6f92ba70><h3 data-v-6f92ba70>0</h3> <h6 data-v-6f92ba70>标签</h6></div></div> <ul class="social-links" data-v-6f92ba70></ul> <hr data-v-6f92ba70></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  HOME
</a></div><div class="nav-item"><a href="/blog/handbook/about/" class="nav-link"><i class="iconfont reco-document"></i>
  导读
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/handbook/basic/composition-principle.html" class="nav-link"><i class="fa fa-solid fa-computer"></i>
  计算机基础
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/frontend/basic.html" class="nav-link"><i class="fa fa-brands fa-js"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/backend/java-core-basic.html" class="nav-link"><i class="fa fa-brands fa-java"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/database/" class="nav-link"><i class="fa fa-solid fa-database"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/bigdata/hadoop.html" class="nav-link"><i class="fa fa-brands fa-hive"></i>
  大数据
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/ml/python-core.html" class="nav-link"><i class="fa fa-brands fa-python"></i>
  人工智能
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/devops/docker.html" class="nav-link"><i class="fa fa-brands fa-docker"></i>
  运维
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/tools/Git.html" class="nav-link"><i class="fa fa-solid fa-toolbox"></i>
  常用开发工具
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      友情链接
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_44446122?type=blog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Adopat" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>运维</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/devops/docker.html" class="sidebar-link">Docker</a></li><li><a href="/blog/handbook/devops/nginx.html" aria-current="page" class="active sidebar-link">Nginx</a></li><li><a href="/blog/handbook/devops/Kubernetes.html" class="sidebar-link">K8s教程</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-2c3e9f55 data-v-1c636796><h3 class="title" data-v-2c3e9f55></h3> <!----> <label id="box" class="inputBox" data-v-2c3e9f55><input type="password" value="" data-v-2c3e9f55> <span data-v-2c3e9f55>Konck! Knock!</span> <button data-v-2c3e9f55>OK</button></label> <div class="footer" data-v-2c3e9f55><span data-v-2c3e9f55><i class="iconfont reco-theme" data-v-2c3e9f55></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-2c3e9f55>vuePress-theme-reco</a></span> <span data-v-2c3e9f55><i class="iconfont reco-copyright" data-v-2c3e9f55></i> <a data-v-2c3e9f55><span data-v-2c3e9f55>Adopat</span>
          
        <!---->
        2023
      </a></span></div></div> <div data-v-1c636796><div data-v-1c636796><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">Nginx</h1> <div data-v-6acedb3b><i class="iconfont reco-account" data-v-6acedb3b><span data-v-6acedb3b>Adopat</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="nginx"><a href="#nginx" class="header-anchor">#</a> Nginx</h1> <h2 id="安装和简介"><a href="#安装和简介" class="header-anchor">#</a> 安装和简介</h2> <h3 id="nginx简介"><a href="#nginx简介" class="header-anchor">#</a> <code>Nginx</code>简介</h3> <p><code>Nginx</code> 是一个功能强大的 Web 服务器和反向代理服务器，适用于高并发、高性能、负载均衡和静态文件缓存等场景。它被广泛应用于各种 Web 应用、大型网站、微服务架构、容器化环境等。</p> <h3 id="nginx安装"><a href="#nginx安装" class="header-anchor">#</a> <code>Nginx</code>安装</h3> <p><strong>环境准备</strong></p> <ul><li><p>系统版本</p> <p>保证<code>centos 7</code>以上。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@nginx ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/redhat-release </span>
CentOS Linux release <span class="token number">7.9</span>.2009 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>防火墙关闭</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl disable firewalld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Senlinux</code> 关闭</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@nginx ~]# cat /etc/selinux/config 

# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#     enforcing - SELinux security policy is enforced.
#     permissive - SELinux prints warnings instead of enforcing.
#     disabled - No SELinux policy is loaded.
SELINUX=disabled
# SELINUXTYPE= can take one of three values:
#     targeted - Targeted processes are protected,
#     minimum - Modification of targeted policy. Only selected processes are protected. 
#     mls - Multi Level Security protection.
SELINUXTYPE=targeted 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p>将 <code>SELINUX</code> 值设置为disabled,主要原因是一些非标准端口(端口号大于1024)访问会受到 <code>selinux</code>限制</p> <p>参考资料:</p> <p><a href="https://blog.csdn.net/Jack_num1/article/details/120014311" target="_blank" rel="noopener noreferrer">Nginx 启动报 [emerg] bind() to 0.0.0.0:XXXX failed (13: Permission denied)错误处理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.linuxprobe.com/selinux-introduction.html" target="_blank" rel="noopener noreferrer">SELINUX入门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></li> <li><p>服务器可以上网</p></li></ul> <p><strong>安装步骤</strong></p> <ol><li><p>安装一些工具包</p> <p><code>yum-utils</code>是一个包含了一些实用工具的软件包。它提供了一些额外的功能和命令，用于增强 <code>yum</code> 的功能，例如清理缓存、查找可用软件包、管理存储库等。</p> <p><code>net-tools</code>是一个软件包，提供了一些网络工具，如 <code>ifconfig</code>、<code>netstat</code>、<code>arp</code> 等。这些工具可以用于配置和查看网络接口、网络连接状态以及网络地址解析协议等。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> yum install yum-utils net-tools
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>设置<code>Nginx</code>安装源</p> <p>根据<code>Nginx</code>安装官方文档安装说明，第一次在新机器上安装<code>Nginx</code>之前，需要设置<code>Nginx</code>的安装源。之后，才可以从存储库安装和更新<code>Nginx</code>。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cat &gt; /etc/yum.repos.d/nginx.repo &lt;&lt; EOF
[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/\$releasever/\$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
EOF
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p><code>[nginx-stable]</code>：这是存储库的名称，用于在 Yum 中唯一标识该存储库。</p> <p><code>name=nginx stable repo</code>：这是存储库的描述，用于描述该存储库的用途。</p> <p><code>baseurl=http://nginx.org/packages/centos/$releasever/$basearch/</code>：这是存储库的基本 URL，指定了 <code>Nginx</code> 软件包的下载地址。<code>$releasever</code> 和 <code>$basearch</code> 是变量，将在运行时由 Yum 替换为适当的值，以匹配系统的 <code>CentOS</code> 版本和体系结构。</p> <p><code>gpgcheck=1</code>：这个选项指示 Yum 在从该存储库安装软件包时验证软件包的 <code>GPG</code> 签名。</p> <p><code>enabled=1</code>：这个选项指示 Yum 启用该存储库，允许从该存储库安装软件包。</p> <p><code>gpgkey=https://nginx.org/keys/nginx_signing.key</code>：这是存储库的 <code>GPG</code> 密钥的 URL，用于验证软件包的完整性和真实性。</p> <p><code>module_hotfixes=true</code>：这个选项指示 Yum 在加载模块时自动应用热修复。</p></blockquote></li> <li><p>安装<code>Nginx</code></p> <div class="language-SHELL line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>设置开机启动</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl <span class="token builtin class-name">enable</span> nginx.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h3 id="nginx常用命令"><a href="#nginx常用命令" class="header-anchor">#</a> <code>Nginx</code>常用命令</h3> <ul><li><p>查看版本</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1. 显示 nginx 的版本。</span>
<span class="token punctuation">[</span>root@nginx ~<span class="token punctuation">]</span><span class="token comment"># nginx -v</span>
nginx version: nginx/1.24.0
<span class="token comment"># 2. 显示 nginx 的版本，编译器版本和配置参数。</span>
<span class="token punctuation">[</span>root@nginx ~<span class="token punctuation">]</span><span class="token comment"># nginx -V</span>
nginx version: nginx/1.24.0
built by gcc <span class="token number">4.8</span>.5 <span class="token number">20150623</span> <span class="token punctuation">(</span>Red Hat <span class="token number">4.8</span>.5-44<span class="token punctuation">)</span> <span class="token punctuation">(</span>GCC<span class="token punctuation">)</span> 
built with OpenSSL <span class="token number">1.0</span>.2k-fips  <span class="token number">26</span> Jan <span class="token number">2017</span>
TLS SNI support enabled
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>查看运行状态</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@nginx ~]# systemctl status nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>启动</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@nginx ~]# systemctl start nginx
# 重启 nginx
[root@nginx ~]#systemctl reload nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>关闭</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 快速关闭Nginx，可能不保存相关信息，并迅速终止web服务。</span>
nginx <span class="token parameter variable">-s</span> stop 
<span class="token comment"># 平稳关闭Nginx，保存相关信息，有安排的结束web服务。</span>
nginx <span class="token parameter variable">-s</span> quit       
<span class="token comment"># 也可以使用 systemctl 进行关闭</span>
systemctl stop nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>测试配置文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>nginx <span class="token parameter variable">-t</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>重新加载配置文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>nginx <span class="token parameter variable">-s</span> reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>每次修改完配置文件，需要执行<code>nginx -t</code>测试<code>nginx</code>配置文件，在执行 <code>nginx -s reload</code> 重新加载配置文件</p></blockquote></li> <li><p>日志查看</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#产看日志</span>
journalctl <span class="token parameter variable">-xe</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h3 id="nginx配置文件结构"><a href="#nginx配置文件结构" class="header-anchor">#</a> <code>Nginx</code>配置文件结构</h3> <ul><li><p>配置文件图</p> <p><img src="/blog/Nginx.assets/image-20230811093818760.png" alt="image-20230811093818760"></p></li> <li><p>配置文件总结</p> <p><code>Nginx</code>配置文件的结构可以总结如下：</p> <ol><li><p>全局块（Global Block）：配置文件的开头，用于设置全局的配置指令，对整个<code>Nginx</code>服务器生效。</p></li> <li><p>events 块：配置与连接处理相关的参数，如并发连接数、连接超时等。</p></li> <li><p><code>http</code> 块：配置HTTP服务器的行为，包括HTTP请求处理、反向代理、负载均衡等。</p></li> <li><p>server 块：定义一个虚拟主机（server），用于支持多个域名或多个端口的访问。</p></li> <li><p>location 块：匹配请求的URL路径，并定义如何处理这些请求。</p></li></ol> <p>在配置文件中，可以有多个server块和location块，以支持多个虚拟主机和不同的URL路径的处理规则。</p></li> <li><p>参考资料</p> <p><a href="https://www.shuzhiduo.com/A/A2dm8Ejb5e/" target="_blank" rel="noopener noreferrer">Nginx常用配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h3 id="一些重要的文件"><a href="#一些重要的文件" class="header-anchor">#</a> 一些重要的文件</h3> <ul><li><p>日志文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>/var/log/nginx/access.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>日志文件过多，可以设置脚本将日志切割，</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#!/bin/ bash
L0G_PATH=&quot;/var/log/nginx&quot;
RECORD_TIME=$(date -d &quot;yesterday&quot; +%Y-%m-%d+%H:%M)
PID=/var/run/nginx/nginx.pid
mv ${LOG_PATH}/access.log ${LOG_PATH}/access.${RECORD_TIME}.log
mv ${LOG_PATH}/error.log ${LOG_PATH}/error.${RECORD_TIME}.log
#向Nginx主进程发送信号，用于重新打开日志文件
kill -USR1 `cat $PID`
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参考资料:<a href="https://developer.aliyun.com/article/792474?spm=a2c6h.12873639.article-detail.11.5b4b43d1NBh6Gn" target="_blank" rel="noopener noreferrer">Nginx极简入门（七）Nginx的日志管理及配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></li> <li><p>主配置文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>/etc/nginx/nginx.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>注意在<code>nginx.conf</code>中存在一条这样的命令<code>include /etc/nginx/conf.d/*.conf;</code>,这条命令会引用<code>/etc/nginx/conf.d</code>目录下所有的<code>.conf</code>文件，这样可以保持主配置文件的简洁，同时配个多个<code>.conf</code>文件方便区分，增加可读性。</p></blockquote></li> <li><p>默认配置文件</p> <p>默认配置位于<code>/etc/nginx/conf.d/default.conf</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span> <span class="token comment">#监听端口</span>
    server_name  localhost<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
        root   /usr/share/nginx/html<span class="token punctuation">;</span> <span class="token comment">#根目录</span>
        index  index.html index.htm<span class="token punctuation">;</span> <span class="token comment">#首页</span>
    <span class="token punctuation">}</span>

    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
        root   /usr/share/nginx/html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>默认网站数据</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>/usr/share/nginx/html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h3 id="一些必备基础"><a href="#一些必备基础" class="header-anchor">#</a> 一些必备基础</h3> <ul><li><p>请求转发和重定向的区别</p> <p>转发是<strong>服务端行为</strong>，发向代理proxy_pass属于转发，浏览器的访问栏输入的地址不会发生变化。</p> <p>重定向是<strong>客户端行为</strong>。浏览器的访问栏输入的地址会发生变化。</p></li> <li><p>常见状态码及其含义</p> <ul><li><p><code>2xx</code> 成功</p></li> <li><p><code>3xx</code> 表示重定向</p></li> <li><ul><li>301 永久重定向</li> <li>302 临时重定向</li></ul></li> <li><p><code>4xx</code> 请求地址出错</p></li> <li><ul><li>403 拒绝请求</li> <li>404 请求找不到</li></ul></li> <li><p><code>5xx</code> 服务器内部错误</p></li></ul></li></ul> <h2 id="环境准备"><a href="#环境准备" class="header-anchor">#</a> 环境准备</h2> <p>为了测试常用的使用场景需要提前准备以下应用</p> <table><thead><tr><th>目录</th> <th>简介</th> <th>说明</th> <th>下载地址</th> <th>修改内容</th></tr></thead> <tbody><tr><td><code>/home/AdminLTE-3.2.0.tar.gz</code></td> <td>静态web后台管理系统</td> <td>静态web的配置演示</td> <td>https://codeload.github.com/ColorlibHQ/AdminLTE/tar.gz/refs/tags/v3.2.0</td> <td>在当前目录解压</td></tr> <tr><td><code>/home/apache-tomcat-8.5.81.tar.gz</code><br><code>/home/apps/ruoyi-admin.war</code><br></td> <td><code>javaweb</code>服务器</td> <td>动静分离演示</td> <td>https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.81/bin/</td> <td>在当前目录解压,<br><code>ruoyi-admin.war</code>下载源码编译打包，需要修改端口号为8080,数据库连接</td></tr> <tr><td><code>/home/apps/ruoyi-admin.jar</code></td> <td>若依后台管理系统，基于<code>springboot</code></td> <td>HTTP反向代理</td> <td>https://codeload.github.com/yangzongzhuan/RuoYi/zip/refs/tags/v4.7.4</td> <td>在当前目录解压,<br><code>ruoyi-admin.jar</code>下载源码编译打包，需要修改端口号为8080,数据库地址修改连接</td></tr> <tr><td><code>/home/apps/sql/ry_20210924.sql</code><br><code>/home/apps/sql/quartz.sql</code></td> <td>数据库初始化脚本</td> <td></td> <td></td> <td>创建若依后台数据库,创建数据库<code>ry</code>，数据库编码<code>utf8mb4</code>,使用 source命令导入初始化<code>sql</code></td></tr> <tr><td><code>/home/apps/ruoyi-admin-9981.jar</code><br><code>/home/apps/ruoyi-admin-8088.jar</code></td> <td>若依后台管理系统，基于<code>springboot</code></td> <td>演示负载均衡</td> <td>https://codeload.github.com/yangzongzhuan/RuoYi/zip/refs/tags/v4.7.4</td> <td>在当前目录解压,<br><code>ruoyi-admin.jar</code>下载源码编译打包，需要修改端口号为,数据库连接<br>9981,8088分别代表不同的启动端口</td></tr> <tr><td><code>open-JDK 1.8</code></td> <td><code>java</code>运行环境</td> <td>已安装</td> <td></td> <td>执行命令<code>yum install java-1.8.0-openjdk.x86_64 java-1.8.0-openjdk-devel.x86_64</code> 安装，记得修改环境变量</td></tr> <tr><td><code>mysql8.0</code></td> <td><code>mysql</code>数据库</td> <td>已安装</td> <td></td> <td>用户名:root<br>密码:123456</td></tr></tbody></table> <h2 id="常见使用场景"><a href="#常见使用场景" class="header-anchor">#</a> 常见使用场景</h2> <h3 id="静态网页"><a href="#静态网页" class="header-anchor">#</a> 静态网页</h3> <ul><li><p>静态网页概念</p> <p>静态网页是指在服务器上预先创建好的网页文件，其内容在用户请求时不会发生变化。它通常由<code>HTML</code>、<code>CSS</code>、<code>JavaScrip</code>t等静态资源组成，这些资源在用户请求时直接返回给浏览器进行渲染。</p></li> <li><p>静态网页和动态网页的区别</p> <p>静态网页的内容在服务器上预先生成，每次请求时都返回相同的内容。而动态网页的内容是在服务器上根据用户请求动态生成的，可以根据不同的条件和数据进行个性化的内容展示。动态网页通常使用服务器端脚本语言（如<code>PHP</code>、<code>Python</code>、<code>Node.js</code>等）来处理用户请求，并从<strong>数据库</strong>或其他<strong>数据源</strong>获取数据。</p></li> <li><p>使用<code>Nginx</code>配置静态网页的优点</p> <ol><li>高性能：<code>Nginx</code>是一个高性能的Web服务器，能够处理大量并发请求，适合用于提供静态网页。</li> <li>高并发支持：<code>Nginx</code>采用异步非阻塞的工作方式，能够同时处理多个并发请求，提供更好的响应速度和吞吐量。</li> <li>轻量级：<code>Nginx</code>的设计目标是高性能和低资源消耗，占用较少的内存和CPU资源。</li> <li>静态文件缓存：<code>Nginx</code>可以配置静态文件缓存，将静态网页的内容缓存在内存中，减少对后端服务器的访问，提高响应速度。</li> <li>负载均衡：<code>Nginx</code>支持负载均衡配置，可以将请求分发到多个后端服务器上，提高系统的可靠性和扩展性。</li></ol></li> <li><p><code>Nginx</code>配置静态网页</p> <p>在 <code>/etc/nginx/conf.d/目录下</code>创建配置文件<code>8000.conf</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 配置静态网页</span>
<span class="token comment"># server 定义一个虚拟主机</span>
server<span class="token punctuation">{</span>
    <span class="token comment"># 监听80端口，这是HTTP协议的默认端口。</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token comment"># 指定服务器的主机名为localhost，这意味着只有通过localhost访问的请求会被这个虚拟主机处理。这里可以设置域名，需要在hosts中配置映射</span>
    server_name localhost<span class="token punctuation">;</span><span class="token comment">#主机名</span>
    <span class="token comment"># 匹配所有以斜杠（/）开头的请求</span>
    location / <span class="token punctuation">{</span>
        <span class="token comment"># 指定静态文件的根目录为/home/AdminLTE-3.2.0，这是你的静态网页文件所在的目录。</span>
        root /home/AdminLTE-3.2.0<span class="token punctuation">;</span>
        <span class="token comment"># 指定当访问目录时默认显示的文件名。在这个例子中，如果访问的是根目录（/），Nginx会按照指定的顺序依次尝试返回index.html、index2.html和index3.html这三个文件。如果找到其中一个文件，就会返回该文件的内容。</span>
        index index.html index2.html index3.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>注意配置文件 一般使用监听端口进行命名</p></blockquote></li></ul> <h3 id="http反向代理"><a href="#http反向代理" class="header-anchor">#</a> HTTP反向代理</h3> <ul><li><p>反向代理的概念</p> <p>客户端将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器，获取数据后再返回给客户端。对外暴露的是反向代理服务器地址，隐藏了真实服务器P地址。反向代理“代理”的是目标服务器，这一个过程对于客户端而言是透明的。</p></li> <li><p>反向代理和正向代理的区别</p> <p>想要理解正确理解和区分正向代理和反向代理，你要关注的是代理对象，<strong>正向代理</strong>“代理”的是客户端，<strong>反向代理</strong>“代理”的是目标服务器。代理其实就是一个中介，A和B本来可以直连，中间插入一个C,C就是中介。刚开始的时候，代理多数是帮助内网client访问外网server用的（比如HTTP代理），从内到外,后来出现了反向代理，“反向&quot;这个词在这儿的意思其实是指方向相反，即代理将来自外网client的请求forward到内网server,从外到内。</p> <blockquote><p>正向代理 如<code>vpn</code>,反向代理如 <code>nginx</code></p></blockquote></li> <li><p>反向代理的优点</p> <ol><li><p>提高了内部服务器的安全</p> <p>外部网络用户通过反向代理访向内部服务器，只能看到反向代理服务器的<code>IP</code>地址和端口号，内部服务器对于外部网络来说是完全不可见。而且反向代理服务器上没有保存任何的信息资源，所有的网页程序都保存在内部服务器上，对反向代理服务器的攻击并不能使真的网页信息系统受到破坏，这样就提高了内部服务器的安全性。</p></li> <li><p>加快了对内部服务器的访问速度</p> <p>在内部服务器前放置两台反向代理服务器，分别连接到教育网和公网，这样公网用户就可以直接通过公网线路访问学校服务器，从而避开了公网和教育网之间拥挤的链路。同时反向代理服务器的缓存功能也加快了用户的访问速度。</p></li> <li><p>节约了有限的<code>IP</code>资源</p> <p>校园网内部服务器除使用教育网地址外，也会采用公网的<code>IP</code>地址对外提供服务，公网分配的<code>IP</code>地址数目是有限的，如果每个服务器有分配-个公网地址，那是不可能的，通过反向代理技术很好的解决了<code>IP</code>地址不足的问题。</p></li></ol></li> <li><p><code>Nginx</code>反向代理的使用场景</p> <ol><li>Web服务器：HTTP反向代理最常见的用途是代理Web服务器。它可以负载均衡传入的HTTP请求，并将请求转发给后端的多个Web服务器，以提高性能和可靠性。</li> <li>缓存服务器：HTTP反向代理可以缓存静态资源，如图片、<code>CSS</code>和JavaScript文件，减轻后端服务器的负载，加快用户的访问速度。</li> <li><code>SSL</code>终端代理：HTTP反向代理可以作为<code>SSL</code>终端代理，将加密的<code>HTTPS</code>请求解密后转发给后端的HTTP服务器，从而减轻后端服务器的负担。</li> <li>安全性和访问控制：HTTP反向代理可以用于实施安全策略，如防火墙、访问控制和身份验证，以保护后端服务器免受恶意请求和攻击。</li></ol></li> <li><p>反向代理的配置</p> <p>在 <code>/etc/nginx/conf.d/目录下</code>创建配置文件<code>8001.conf</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 配置反向代理</span>
<span class="token comment"># 定义一个虚拟主机（server）</span>
server <span class="token punctuation">{</span>
  <span class="token comment"># 监听8001端口，这是你的Nginx服务器将要监听的端口号。</span>
  listen <span class="token number">8001</span><span class="token punctuation">;</span>
  <span class="token comment"># 指定服务器的主机名为ruoyi.localhost，这意味着只有通过ruoyi.localhost访问的请求会被这个虚拟主机处理。</span>
  server_name ruoyi.localhost<span class="token punctuation">;</span>
  <span class="token comment"># 匹配所有以斜杠（/）开头的请求。</span>
  location / <span class="token punctuation">{</span>
    <span class="token comment"># 将匹配到的请求转发到http://192.168.35.107:8080，这是你要代理的后端服务器的地址。</span>
    proxy_pass http://192.168.35.107:8080<span class="token punctuation">;</span>
    <span class="token comment">#将客户端请求的Host头信息传递给后端服务器，确保后端服务器能够正确处理请求。</span>
    proxy_set_header Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>
    <span class="token comment">#将客户端的真实IP地址传递给后端服务器，这样后端服务器可以获取到客户端的真实IP地址。</span>
    proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
    <span class="token comment"># 将客户端的原始IP地址传递给后端服务器，这样后端服务器可以获取到经过代理的客户端IP地址。</span>
    proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li><p>非HTTP代理</p> <p>如果要将请求传递到非 HTTP 代理服务器，可以使用下列指令：</p> <ul><li><a href="https://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_pass" target="_blank" rel="noopener noreferrer">fastcgi_pass<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将请求转发到<code>FastCGI</code>服务器（多用于<code>PHP</code>）</li> <li><a href="https://nginx.org/en/docs/http/ngx_http_scgi_module.html#scgi_pass" target="_blank" rel="noopener noreferrer">scgi_pass<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将请求转发到<code>SCGI server</code>服务器（多用于<code>PHP</code>）</li> <li><a href="https://nginx.org/en/docs/http/ngx_http_uwsgi_module.html#uwsgi_pass" target="_blank" rel="noopener noreferrer">uwsgi_pass<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将请求转发到<code>uwsgi</code>服务器（多用于<code>python</code>）</li> <li><a href="https://nginx.org/en/docs/http/ngx_http_memcached_module.html#memcached_pass" target="_blank" rel="noopener noreferrer">memcached_pass<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将请求转发到<code>memcached</code>服务器</li></ul></li> <li><p>参考资料</p> <p><a href="https://www.zhihu.com/question/593342107/answer/2965205173?utm_id=0" target="_blank" rel="noopener noreferrer">Nginx如何隐藏版本号<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h3 id="动静分离"><a href="#动静分离" class="header-anchor">#</a> 动静分离</h3> <ul><li><p>动静分离概念</p> <p><code>Apache Tocmat</code> 严格来说是一款<code>java EE</code>服务器，主要是用来处理 <code>servlet</code>请求。处理<code>css</code>、<code>js</code>、图片这些静态文件的IO性能不够好，因此，将静态文件交给<code>nginx</code>处理，可以提高系统的访问速度，减少tomcat的请求次数，有效的给后端服务器降压。</p></li> <li><p>动静分离资源准备</p> <ol><li>部署<code>ruoyi-admin.war</code></li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mv</span> /home/apps/ruoyi-admin.war /home/apache-tomcat-8.5.81/webapps/ROOT.war
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /home/apache-tomcat-8.5.81/webapps/ROOT
/home/apache-tomcat-8.5.81/bin/startup.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>部署完成后，对项目目录稍作调整</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /home/apache-tomcat-8.5.81/webapps/ROOT
<span class="token function">mv</span> WEB-INF/classes/static/i18n  WEB-INF/classes/templates/i18n 
<span class="token function">mv</span> WEB-INF/classes/static /home/www/static
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>修改<code>application.yml</code></li></ol> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">messages</span><span class="token punctuation">:</span>
    <span class="token comment"># 国际化资源文件路径 </span>
    <span class="token comment"># 将 static/i18n/messages 修改为 templates/i18n/messages</span>
    <span class="token key atrule">basename</span><span class="token punctuation">:</span> templates/i18n/messages
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="4"><li>修改<code>nginx</code>用户组</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 修改工作用户为root,否则会出现403没权限</span>
user  root<span class="token punctuation">;</span>
worker_processes  auto<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>修改 <code>/etc/nginx/nginx.conf</code></p></blockquote></li> <li><p>动静分离配置</p> <p>在 <code>/etc/nginx/conf.d/</code>目录下 创建配置文件<code>8002.conf</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># nginx 配置动静分离</span>
server<span class="token punctuation">{</span>
    listen <span class="token number">8002</span><span class="token punctuation">;</span>
    <span class="token comment"># 指定服务器的主机名为localhost，这意味着只有通过localhost访问的请求会被这个虚拟主机处理。</span>
    <span class="token comment"># 主机名</span>
    server_name localhost<span class="token punctuation">;</span>

  location / <span class="token punctuation">{</span>
    <span class="token comment"># 请求转发 http://192.168.35.107:8080/;</span>
    proxy_pass http://192.168.35.107:8080/<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 精确匹配路径为/html/ie.html的请求。</span>
  location <span class="token operator">=</span> /html/ie.html <span class="token punctuation">{</span>
    root  /home/www/static<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 以&quot;/fonts/&quot;开头的路径匹配。</span>
  location ^~ /fonts/ <span class="token punctuation">{</span>
   
    root  /home/www/static<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 使用正则表达式匹配以.css、.js、.png、.jpg、.gif或.ico结尾的路径。</span>
  location ~ <span class="token punctuation">\</span>.<span class="token punctuation">(</span>css<span class="token operator">|</span>js<span class="token operator">|</span>png<span class="token operator">|</span>jpg<span class="token operator">|</span>gif<span class="token operator">|</span>ico<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    root /home/www/static<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li> <li><p>location 修饰符</p> <p>location可以使用修饰符或正则表达式</p> <p>修饰符：</p> <ul><li><p>=     等于，严格匹配 ，匹配优先级最高。</p></li> <li><p>^~  表示普通字符匹配。使用前缀匹配。如果匹配成功，则不再匹配其它 location。优先级第二高。</p></li> <li><p>~     区分大小写</p></li> <li><p>~*  不区分大小写</p></li></ul> <p>优先级从高到低依次为</p> <ol><li>精确匹配（=）</li> <li>前缀匹配（^~）</li> <li>正则匹配（~和～*）</li> <li>不写</li></ol></li></ul> <h3 id="缓冲和缓存"><a href="#缓冲和缓存" class="header-anchor">#</a> 缓冲和缓存</h3> <p><code>Nginx</code>的缓冲和缓存功能可以有效地提高网站的性能和响应速度。通过使用缓冲功能，可以减少对上游服务器的请求次数，提高数据的传输效率。而通过使用缓存功能，可以将经常访问的静态资源缓存到本地，减轻服务器的负载压力，并提高响应速度。</p> <ul><li><p>缓冲（Buffering）：
<code>Nginx</code>的缓冲功能可以将客户端请求或从上游服务器获取的响应暂时存储在<strong>内存</strong>中，以提高数据的传输效率。<code>Nginx</code>的缓冲可以分为客户端缓冲和上游服务器缓冲。</p> <ul><li><p>客户端缓冲：当<code>Nginx</code>接收到客户端的请求时，可以选择将请求暂时存储在内存中进行缓冲，然后再将请求转发给上游服务器。这样可以避免上游服务器因为短时间内接收到大量请求而导致的性能问题。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 开启客户端缓冲</span>
proxy_buffering on<span class="token punctuation">;</span> 
<span class="token comment"># 设置缓冲区的大小和数量</span>
proxy_buffers <span class="token number">8</span> 16k<span class="token punctuation">;</span>
<span class="token comment"># 设置单个缓冲区的大小</span>
proxy_buffer_size 16k<span class="token punctuation">;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>上游服务器缓冲：当<code>Nginx</code>从上游服务器获取响应时，可以选择将响应暂时存储在内存中进行缓冲，然后再将响应返回给客户端。这样可以减轻上游服务器的负载压力，并提高响应速度。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 开启上游服务器缓冲</span>
proxy_buffering on<span class="token punctuation">;</span>  
<span class="token comment"># 设置缓冲区的大小和数量</span>
proxy_buffers <span class="token number">8</span> 16k<span class="token punctuation">;</span>  
<span class="token comment"># 设置单个缓冲区的大小</span>
proxy_buffer_size 16k<span class="token punctuation">;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul></li> <li><p>缓存（Caching）：
<code>Nginx</code>的缓存功能可以将经常访问的静态资源（如图片、<code>CSS</code>、<code>JavaScript</code>文件等）缓存到<strong>磁盘</strong>中，以减少对后端服务器的请求，提高网站的性能和响应速度。</p> <ul><li><p>客户端缓存：<code>Nginx</code>可以通过设置响应头中的缓存相关字段，告诉客户端将响应内容缓存到本地浏览器中。这样，当客户端再次请求相同的资源时，可以直接从本地缓存中获取，而无需再次向服务器发起请求。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 设置缓存的过期时间</span>
expires 1d<span class="token punctuation">;</span>  
<span class="token comment"># 设置缓存的控制头</span>
add_header Cache-Control <span class="token string">&quot;public&quot;</span><span class="token punctuation">;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>代理缓存：<code>Nginx</code>还可以作为反向代理服务器，将从上游服务器获取的响应缓存到本地磁盘中。当下次有相同的请求时，<code>Nginx</code>可以直接从本地缓存中返回响应，而无需再次请求上游服务器。这样可以减轻上游服务器的负载压力，并提高响应速度。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 设置缓存路径和相关参数</span>
proxy_cache_path /path/to/cache <span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2 <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>my_cache:10m <span class="token assign-left variable">max_size</span><span class="token operator">=</span>10g <span class="token assign-left variable">inactive</span><span class="token operator">=</span>60m<span class="token punctuation">;</span>  
<span class="token comment"># 指定缓存的名称</span>
proxy_cache my_cache<span class="token punctuation">;</span> 
<span class="token comment"># 设置缓存的键</span>
proxy_cache_key <span class="token variable">$scheme</span><span class="token variable">$proxy_host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span> 
<span class="token comment"># 设置响应状态码为200和302的缓存有效时间为10分钟</span>
proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>  
<span class="token comment"># 设置响应状态码为404的缓存有效时间为1分钟</span>
proxy_cache_valid <span class="token number">404</span> 1m<span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ul></li> <li><p>示例</p> <p>在 <code>/etc/nginx/conf.d/</code>目录下 创建配置文件<code>8003.conf</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># nginx 配置动静分离 静态资源配置缓存</span>
<span class="token comment"># 设置缓存路径和定义了缓存区域的名称和大小</span>
proxy_cache_path /var/cache/nginx/data <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>mycache:10m<span class="token punctuation">;</span>

server <span class="token punctuation">{</span>

    listen <span class="token number">8001</span><span class="token punctuation">;</span>
    server_name ruoyi.localhost<span class="token punctuation">;</span>
    
    location / <span class="token punctuation">{</span>
        <span class="token comment"># 设置缓冲区的大小和数量</span>
        proxy_buffers <span class="token number">16</span> 4k<span class="token punctuation">;</span>
        <span class="token comment"># 设置单个缓冲区的大小</span>
        proxy_buffer_size 2k<span class="token punctuation">;</span>
        proxy_pass http://localhost:8088<span class="token punctuation">;</span>        

    <span class="token punctuation">}</span>


    location ~ <span class="token punctuation">\</span>.<span class="token punctuation">(</span>js<span class="token operator">|</span>css<span class="token operator">|</span>png<span class="token operator">|</span>jpg<span class="token operator">|</span>gif<span class="token operator">|</span>ico<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment"># 指定缓存的名称</span>
        proxy_cache mycache<span class="token punctuation">;</span>
        <span class="token comment"># 设置响应状态码为200和302的缓存有效时间为10分钟</span>
        proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>
        <span class="token comment"># 设置响应状态码为404的缓存有效时间为10分钟</span>
        proxy_cache_valid <span class="token number">404</span>      1m<span class="token punctuation">;</span>
        <span class="token comment"># 设置所有其他响应状态码的缓存有效时间为5分钟</span>
        proxy_cache_valid any 5m<span class="token punctuation">;</span>
        proxy_pass http://localhost:8088<span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>

    location <span class="token operator">=</span> /html/ie.html <span class="token punctuation">{</span>

        proxy_cache mycache<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">404</span>      1m<span class="token punctuation">;</span>
        proxy_cache_valid any 5m<span class="token punctuation">;</span>

        proxy_pass http://localhost:8088<span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>

    location ^~ /fonts/ <span class="token punctuation">{</span>

        proxy_cache mycache<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">404</span>      1m<span class="token punctuation">;</span>
        proxy_cache_valid any 5m<span class="token punctuation">;</span>

        proxy_pass http://localhost:8088<span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div></li></ul> <h3 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h3> <ul><li><p>负载均衡概念</p> <p>跨多个应用程序实例的负载平衡是一种常用技术，用于优化资源利用率、最大化吞吐量、减少延迟和确保容错配置。使用nginx作为非常有效的HTTP负载平衡器，将流量分配到多个应用程序服务器，可以提升Web应用程序的性能，提高扩展性和可靠性。</p></li> <li><p>负载均衡策略</p> <ul><li><p>轮询机制(round-robin)</p> <p>默认机制，以轮循机制方式分发。</p></li> <li><p>最小连接(least-connected)</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>upstream backend <span class="token punctuation">{</span>
    least_conn<span class="token punctuation">;</span>
    server backend1.example.com<span class="token punctuation">;</span>
    server backend2.example.com<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><code>ip-hash</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>upstream backend <span class="token punctuation">{</span>
    ip_hash<span class="token punctuation">;</span>
    server backend1.example.com<span class="token punctuation">;</span>
    server backend2.example.com<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>通用Hash</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>upstream backend <span class="token punctuation">{</span>
    <span class="token builtin class-name">hash</span> <span class="token variable">$request_uri</span> consistent<span class="token punctuation">;</span>
    server backend1.example.com<span class="token punctuation">;</span>
    server backend2.example.com<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>随机(random)</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>upstream backend <span class="token punctuation">{</span>
    random two least_conn<span class="token punctuation">;</span>
    server backend1.example.com<span class="token punctuation">;</span>
    server backend2.example.com<span class="token punctuation">;</span>
    server backend3.example.com<span class="token punctuation">;</span>
    server backend4.example.com<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>权重(weight)</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>upstream my-server <span class="token punctuation">{</span>
  
    server performance.server <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
    server app1.server<span class="token punctuation">;</span>
    server app2.server<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>如上所示，每 5 个新请求将按如下方式分布在应用程序实例中：3 个请求将定向到<code>performance.server</code>，一个请求将转到<code>app1.server</code>，另一个请求将转到<code>app2.server</code>。</p></blockquote></li> <li><p>健康检查</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>upstream backend {
  server backend1.example.com;
  server backend2.example.com max_fails=3 fail_timeout=30s; 
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>在以上示例中，如果<code>NGINX</code>无法向服务器发送请求或在30秒内请求失败次数超过3次，则会将服务器标记为不可用30秒。</p></blockquote></li></ul></li> <li><p>负载均衡配置示例</p> <p>在 <code>/etc/nginx/conf.d/</code>目录下 创建配置文件<code>9005.conf</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 负载均衡</span>
upstream ruoyi-apps <span class="token punctuation">{</span>
    <span class="token comment">#不写，采用轮循机制</span>
    server localhost:9981 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
    server localhost:8088<span class="token punctuation">;</span>
  
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
  
  listen <span class="token number">9005</span><span class="token punctuation">;</span>
  server_name ruoyi.loadbalance<span class="token punctuation">;</span>
  
  location / <span class="token punctuation">{</span>
    proxy_pass http://ruoyi-apps<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ul> <h3 id="https配置"><a href="#https配置" class="header-anchor">#</a> <code>HTTPS</code>配置</h3> <ul><li><p>概念</p> <p><code>HTTPS</code> 协议是<strong>由HTTP 加上<code>TLS/SSL</code>协议构建的可进行加密传输、身份认证的网络协议</strong>，主要通过数字证书、加密算法、非对称密钥等技术完成互联网数据传输加密，实现互联网传输安全保护。</p></li> <li><p>生成证书</p> <p>使用<code>OpenSSL</code>生成自签名<code>SSL</code>证书的步骤。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 这个命令生成一个带有密码保护的RSA私钥文件（server.key）。-des3选项指定使用Triple DES算法对私钥进行加密。2048表示生成的私钥的长度为2048位。</span>
openssl genrsa <span class="token parameter variable">-des3</span> <span class="token parameter variable">-out</span> server.key <span class="token number">2048</span>
<span class="token comment"># 这个命令生成一个证书签名请求文件（server.csr）。-new选项表示创建一个新的证书请求。-key server.key指定使用之前生成的私钥文件。-out server.csr指定生成的证书签名请求文件的输出路径。</span>
openssl req <span class="token parameter variable">-new</span> <span class="token parameter variable">-key</span> server.key <span class="token parameter variable">-out</span> server.csr
<span class="token comment"># 这个命令使用私钥对证书签名请求进行签名，生成一个自签名的SSL证书文件（server.crt）。-req选项表示输入的文件是一个证书签名请求。-days 365指定证书的有效期为365天。-in server.csr指定输入的证书签名请求文件。-signkey server.key指定用于签名的私钥文件。-out server.crt指定生成的SSL证书文件的输出路径。</span>
openssl x509 <span class="token parameter variable">-req</span> <span class="token parameter variable">-days</span> <span class="token number">365</span> <span class="token parameter variable">-in</span> server.csr <span class="token parameter variable">-signkey</span> server.key <span class="token parameter variable">-out</span> server.crt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>示例</p> <p>在 <code>/etc/nginx/conf.d/</code>目录下 创建配置文件<code>443.conf</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 配置HTTPS</span>
server <span class="token punctuation">{</span>
    <span class="token comment"># HTTP 80端口</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name ruoyi.https<span class="token punctuation">;</span>
    <span class="token comment"># 永久重定向</span>
    <span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
    <span class="token comment"># 监听HTTPS的443端口，并启用SSL</span>
    listen              <span class="token number">443</span> ssl<span class="token punctuation">;</span>
    <span class="token comment"># 指定服务器的域名或IP地址</span>
    server_name         ruoyi.https<span class="token punctuation">;</span>
    <span class="token comment"># 指定SSL证书和</span>
    ssl_certificate     /home/ssl/server.crt<span class="token punctuation">;</span>
    <span class="token comment"># 指定私钥的文件路径</span>
    ssl_certificate_key /home/ssl/server.key<span class="token punctuation">;</span>
    <span class="token comment"># 指定支持的SSL/TLS协议版本</span>
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2<span class="token punctuation">;</span>
    <span class="token comment"># 指定支持的加密套件。</span>
    ssl_ciphers         HIGH:<span class="token operator">!</span>aNULL:<span class="token operator">!</span>MD5<span class="token punctuation">;</span>
    ssl_password_file   /home/ssl/cert.pass<span class="token punctuation">;</span>
    <span class="token comment"># https优化</span>
    ssl_session_cache   shared:SSL:10m<span class="token punctuation">;</span>
    ssl_session_timeout 10m<span class="token punctuation">;</span>
  
    location / <span class="token punctuation">{</span>
        <span class="token comment"># 将所有请求转发到本地的 8080 端口</span>
        proxy_pass http://192.168.35.107:8088<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div></li></ul> <h3 id="tcp反向代理"><a href="#tcp反向代理" class="header-anchor">#</a> TCP反向代理</h3> <ul><li><p><code>TCP</code>反向代理和HTTP反向代理的区别</p> <p>在<code>Nginx</code>中，TCP反向代理和HTTP反向代理是两种不同的代理方式，它们有一些区别和联系。</p> <p>区别：</p> <ol><li>协议支持：TCP反向代理可以代理任何基于TCP协议的应用，包括HTTP、SMTP、FTP等，而HTTP反向代理仅能代理基于HTTP协议的应用。</li> <li>数据处理：TCP反向代理在传递数据时是以字节流的形式进行转发，不关心数据的内容，而HTTP反向代理可以解析HTTP请求和响应，并进行一些处理，如负载均衡、缓存等。</li> <li>配置方式：TCP反向代理的配置相对简单，只需指定代理的目标地址和端口即可，而HTTP反向代理的配置可以更加灵活，可以根据请求的URL、头部信息等进行配置。</li></ol> <p>联系：</p> <ol><li>反向代理：无论是TCP反向代理还是HTTP反向代理，它们都是通过代理服务器来接收客户端的请求，并将请求转发给后端的服务器处理，然后将响应返回给客户端。</li> <li>负载均衡：TCP反向代理和HTTP反向代理都可以用于实现负载均衡，将请求分发给多个后端服务器，以提高系统的性能和可靠性。</li> <li>安全性：无论是TCP反向代理还是HTTP反向代理，都可以用于隐藏后端服务器的真实<code>IP</code>地址，提高系统的安全性。</li></ol></li> <li><p>TCP协议和HTTP协议的区别和联系</p> <p>TCP（传输控制协议）和HTTP（超文本传输协议）是两种不同的网络协议，它们有一些区别和联系。</p> <p>区别：</p> <ol><li>层次位置：TCP是传输层协议，负责在网络中可靠地传输数据，而HTTP是应用层协议，用于在Web浏览器和Web服务器之间传输超文本数据。</li> <li>功能目标：TCP的主要目标是提供可靠的数据传输，通过数据包的分段、重组和确认来确保数据的完整性和可靠性。而HTTP的主要目标是在客户端和服务器之间传输和呈现Web内容。</li> <li>数据格式：TCP传输的是字节流，不关心数据的内容，而HTTP传输的是基于文本的超文本数据，使用HTTP报文格式进行交换。</li></ol> <p>联系：</p> <ol><li>应用关系：HTTP协议是基于TCP协议的，它使用TCP作为传输层协议来实现数据的可靠传输。HTTP利用TCP的连接性和可靠性，确保数据在客户端和服务器之间的可靠传输。</li> <li>端口关系：HTTP协议使用TCP的端口号80（默认）进行通信。当客户端发起HTTP请求时，会使用TCP连接到服务器的80端口，并在该连接上发送HTTP请求和接收HTTP响应。</li> <li>协议栈关系：TCP协议位于网络协议栈的传输层，负责将数据分割成数据包并进行可靠传输。HTTP协议位于应用层，建立在TCP之上，使用TCP协议提供的可靠传输服务进行数据交换。</li></ol></li> <li><p>使用场景</p> <p>TCP反向代理的使用场景：</p> <ol><li>邮件服务器：TCP反向代理可以代理SMTP（Simple Mail Transfer Protocol）服务器，用于处理电子邮件的发送和接收。</li> <li>文件传输服务器：TCP反向代理可以代理FTP（File Transfer Protocol）服务器，用于文件的上传和下载。</li> <li>数据库服务器：TCP反向代理可以代理数据库服务器，用于负载均衡、故障转移和提高数据库的性能和可靠性。</li> <li>实时通信服务器：TCP反向代理可以代理实时通信应用，如即时通讯、语音通话等，用于负载均衡和提供高可用性。</li></ol></li> <li><p>示例</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#TCP代理</span>
stream <span class="token punctuation">{</span>
  server <span class="token punctuation">{</span>
    listen <span class="token number">13306</span><span class="token punctuation">;</span>
    proxy_pass localhost:3306<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># TCP 负载均衡</span>
stream <span class="token punctuation">{</span>
  
  upstream backend-mysql <span class="token punctuation">{</span>
  
    server localhost:3306<span class="token punctuation">;</span>
    server localhost:3307<span class="token punctuation">;</span>
    
    keepalive <span class="token number">8</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  server <span class="token punctuation">{</span>
    listen <span class="token number">13306</span><span class="token punctuation">;</span>
    proxy_pass backend-mysql<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><blockquote><p>使用<code>keepalive</code>定义连接池里空闲连接的数量。<code>keepalive_timeout</code> 默认60s。如果连接池里的连接空闲时间超过这个值，则连接关闭。</p></blockquote></li></ul> <h3 id="搭建文件服务器"><a href="#搭建文件服务器" class="header-anchor">#</a> 搭建文件服务器</h3> <ul><li><p>示例</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 搭建文件服务器</span>
server <span class="token punctuation">{</span>
    listen <span class="token number">9006</span><span class="token punctuation">;</span>
    <span class="token comment"># 替换为你的域名</span>
    server_name example.com<span class="token punctuation">;</span>  

    location / <span class="token punctuation">{</span>
        <span class="token comment"># 替换为你的文件存储路径</span>
        root /upload<span class="token punctuation">;</span>  
        <span class="token comment"># 启用目录列表功能，允许用户浏览和下载文件。</span>
        autoindex on<span class="token punctuation">;</span>
        <span class="token comment"># 文件大小自动换算</span>
        autoindex_exact_size on<span class="token punctuation">;</span>
        <span class="token comment"># 按照服务器时间显示文件时间</span>
        autoindex_localtime on<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li> <li><p>参考资料</p> <p><a href="https://blog.csdn.net/weixin_49511376/article/details/129461595" target="_blank" rel="noopener noreferrer">搭建nginx文件服务器(保姆级)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h3 id="解决跨域"><a href="#解决跨域" class="header-anchor">#</a> 解决跨域</h3> <ul><li><p>示例</p> <p>要使用<code>Nginx</code>解决跨域问题，你可以在<code>Nginx</code>的配置文件中添加一些配置项来处理跨域请求。下面是一个示例配置：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name example.com<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
        <span class="token comment"># 允许跨域请求的来源</span>
        add_header Access-Control-Allow-Origin *<span class="token punctuation">;</span>
        <span class="token comment"># 允许的请求方法</span>
        add_header Access-Control-Allow-Methods <span class="token string">&quot;GET, POST, OPTIONS&quot;</span><span class="token punctuation">;</span>
        <span class="token comment"># 允许的请求头</span>
        add_header Access-Control-Allow-Headers <span class="token string">&quot;Authorization, Content-Type&quot;</span><span class="token punctuation">;</span>
        <span class="token comment"># 允许携带凭证（如Cookie）</span>
        add_header Access-Control-Allow-Credentials <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token comment"># 处理预检请求（OPTIONS请求）</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">=</span> OPTIONS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment"># 允许所有来源的跨域请求，也可以指定具体的来源，如 `add_header Access-Control-Allow-Origin http://example.com;`。</span>
            add_header Access-Control-Allow-Origin *<span class="token punctuation">;</span>
            <span class="token comment"># 允许的请求方法。</span>
            add_header Access-Control-Allow-Methods <span class="token string">&quot;GET, POST, OPTIONS&quot;</span><span class="token punctuation">;</span>
            <span class="token comment"># 允许的请求头。</span>
            add_header Access-Control-Allow-Headers <span class="token string">&quot;Authorization, Content-Type&quot;</span><span class="token punctuation">;</span>
            <span class="token comment"># 允许携带凭证（如Cookie）</span>
            add_header Access-Control-Allow-Credentials <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token comment"># 明确指定响应的长度为0 </span>
            add_header Content-Length <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment"># 并且指定响应的内容类型为纯文本。</span>
            add_header Content-Type text/plain<span class="token punctuation">;</span>
            <span class="token builtin class-name">return</span> <span class="token number">200</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># 其他请求交给后端处理</span>
        proxy_pass http://backend_server<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div></li> <li><p>参考资料</p> <p><a href="https://blog.csdn.net/leesinbad/article/details/128230789" target="_blank" rel="noopener noreferrer">Spring Boot 解决跨域问题的 5种方案<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.zhihu.com/question/586453283?utm_id=0" target="_blank" rel="noopener noreferrer">怎么利用 nginx 解决跨域问题？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h3 id="nginx限流"><a href="#nginx限流" class="header-anchor">#</a> <code>Nginx</code>限流</h3> <ul><li><p>概念</p> <p>在<code>Nginx</code>中，限流用于控制对服务器的请求流量，以防止服务器过载或遭受恶意攻击。速率限制可以出于安全目的使用。例如，可以降低暴力破解账号密码的攻击速度。通过将传入请求速率限制为实际用户的典型值，并（通过记录）标识目标URL，它可以帮助我们防御<code>DDOS</code>攻击。而更为通用的用法是，防止上游应用程序服务器同时被太多用户请求所淹没。</p></li> <li><p>限流算法</p> <p>在<code>Nginx</code>中，限流算法用于控制对服务器的请求流量。<code>Nginx</code>提供了几种常用的限流算法，包括：</p> <ol><li><p>漏桶算法（Leaky Bucket Algorithm）：
漏桶算法是一种简单而常用的限流算法。在漏桶算法中，请求被看作是一滴水，而桶则代表服务器的处理能力。请求被放入漏桶中，并以固定的速率从桶中流出。如果请求到达时桶已满，则请求被丢弃。这种算法可以平滑限制请求的速率。</p></li> <li><p>令牌桶算法（Token Bucket Algorithm）：
令牌桶算法也是一种常用的限流算法。在令牌桶算法中，请求被看作是令牌，而桶则代表令牌的生成速率和桶的容量。令牌以固定的速率被放入桶中，每个请求需要从桶中获取一个令牌才能被处理。如果桶中没有足够的令牌，则请求被暂时阻塞或丢弃。</p></li> <li><p>计数器算法（Counter Algorithm）：
计数器算法是一种简单的限流算法，基于计数器来限制请求的速率。在计数器算法中，每个请求到达时，计数器递增。当计数器达到设定的阈值时，请求被丢弃或延迟处理。这种算法适用于对请求速率进行精确控制的场景。</p></li></ol> <p><code>Nginx</code>通过<code>limit_req</code>和<code>limit_conn</code>等指令提供了对这些限流算法的支持。<code>limit_req</code>用于基于请求速率的限流，可以结合漏桶算法或令牌桶算法进行配置。<code>limit_conn</code>用于基于连接数的限流，可以结合计数器算法进行配置。</p> <p>在配置限流时，需要根据实际需求和服务器的处理能力选择合适的限流算法，并进行适当的参数调整。这样可以确保服务器能够有效地控制请求流量，避免过载或遭受恶意攻击。</p></li> <li><p>示例</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 基于连接数的限流</span>
http <span class="token punctuation">{</span>
    limit_conn_zone <span class="token variable">$binary_remote_addr</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>conn_limit_per_ip:10m<span class="token punctuation">;</span>

    server <span class="token punctuation">{</span>
        location / <span class="token punctuation">{</span>
            <span class="token comment"># 这个配置限制了每个IP地址的并发连接数为10。当某个IP地址的并发连接数超过10时，Nginx将拒绝额外的连接请求。</span>
            limit_conn conn_limit_per_ip <span class="token number">10</span><span class="token punctuation">;</span>
            <span class="token punctuation">..</span>.
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># 2.基于请求速率的限流</span>
http <span class="token punctuation">{</span>
    limit_req_zone <span class="token variable">$binary_remote_addr</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>req_limit_per_ip:10m <span class="token assign-left variable">rate</span><span class="token operator">=</span>10r/s<span class="token punctuation">;</span>

    server <span class="token punctuation">{</span>
        location / <span class="token punctuation">{</span>
            <span class="token comment"># 将请求限制为每个IP地址在指定的时间窗口内最多处理20个请求。当超过这个限制时，Nginx将返回503响应码。</span>
            limit_req <span class="token assign-left variable">zone</span><span class="token operator">=</span>req_limit_per_ip <span class="token assign-left variable">burst</span><span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
            <span class="token punctuation">..</span>.
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># 3.基于缓存大小的限流</span>
http <span class="token punctuation">{</span>
    limit_req_zone <span class="token variable">$binary_remote_addr</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>cache_limit_per_ip:10m <span class="token assign-left variable">size</span><span class="token operator">=</span>10m<span class="token punctuation">;</span>

    server <span class="token punctuation">{</span>
        location / <span class="token punctuation">{</span>
            <span class="token comment"># nodelay参数表示不延迟请求处理，即使超过了限制的请求数量。这样可以确保在高峰期时尽快处理请求。</span>
            limit_req <span class="token assign-left variable">zone</span><span class="token operator">=</span>cache_limit_per_ip <span class="token assign-left variable">burst</span><span class="token operator">=</span><span class="token number">100</span> nodelay<span class="token punctuation">;</span>
            <span class="token punctuation">..</span>.
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div></li> <li><p>参考资料</p> <p><a href="https://blog.csdn.net/liji133122/article/details/126667277" target="_blank" rel="noopener noreferrer">Nginx--流量限制（最有用的功能之一）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h3 id="nginx热备"><a href="#nginx热备" class="header-anchor">#</a> <code>Nginx</code>热备</h3> <ul><li><p>概念</p> <p>双机热备其实就是指一台服务器在提供服务时，另一台为某服务的备用状态；当主服务器不可用时，另外备份服务器会获取到主服务器的<code>IP</code>，自动顶替主服务器的功能。比较流行的实现<code>Nginx</code>高可用方案就是：<code>keepalived+nginx</code>实现主备方案。这是国内企业中最为普遍的一种高可用方案。</p></li> <li><p>参考资料</p> <p><a href="https://developer.aliyun.com/article/793235?spm=a2c6h.24874632.expert-profile.196.4a634f0dqZKYW6" target="_blank" rel="noopener noreferrer">Nginx极简入门（十）配置Nginx双机热备份，实现系统高可用解决方案！<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h3 id="nginx镜像服务器"><a href="#nginx镜像服务器" class="header-anchor">#</a> <code>Nginx</code>镜像服务器</h3> <ul><li><p>概念</p> <p>在<code>Nginx</code>中，镜像服务是一种常见的用途，它可以用于在多个服务器之间复制和分发文件或数据。<code>Nginx</code>提供了一些功能和模块，使其成为一个强大的镜像服务工具。</p></li> <li><p>示例</p> <p>下面是一些在<code>Nginx</code>中实现镜像服务的常用方法和配置：</p> <ol><li><p>静态文件镜像：
<code>Nginx</code>可以通过配置反向代理来实现静态文件的镜像。假设有两个服务器，源服务器和镜像服务器。可以使用<code>proxy_pass</code>指令将请求代理到镜像服务器上，从而实现文件的镜像分发。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>location / <span class="token punctuation">{</span>
    proxy_pass http://mirror_server<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在上述配置中，<code>mirror_server</code>是镜像服务器的地址。当源服务器接收到请求时，它会将请求转发到镜像服务器，从而实现文件的镜像分发。</p></li> <li><p>动态内容镜像：
对于动态内容，可以使用<code>Nginx</code>的缓存模块来实现镜像服务。缓存模块可以将动态内容缓存到本地，并在后续的请求中直接返回缓存的内容，而无需再次请求源服务器。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>http <span class="token punctuation">{</span>
    proxy_cache_path /path/to/cache <span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2 <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>my_cache:10m <span class="token assign-left variable">max_size</span><span class="token operator">=</span>10g <span class="token assign-left variable">inactive</span><span class="token operator">=</span>60m<span class="token punctuation">;</span>

    server <span class="token punctuation">{</span>
        location / <span class="token punctuation">{</span>
            proxy_pass http://backend_server<span class="token punctuation">;</span>
            proxy_cache my_cache<span class="token punctuation">;</span>
            proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>
            proxy_cache_valid <span class="token number">404</span> 1m<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在上述配置中，<code>proxy_cache_path</code>指令用于设置缓存路径和相关参数。<code>proxy_cache</code>指令启用缓存，并将请求代理到后端服务器。<code>proxy_cache_valid</code>指令设置缓存的有效期。当请求到达时，<code>Nginx</code>会首先查找缓存，如果缓存中存在有效的内容，则直接返回缓存的内容，否则会请求后端服务器并将响应缓存起来。</p></li> <li><p>负载均衡镜像：
<code>Nginx</code>还可以结合负载均衡模块来实现镜像服务。负载均衡模块可以将请求分发到多个镜像服务器上，从而实现负载均衡和高可用性。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>http <span class="token punctuation">{</span>
    upstream mirror_servers <span class="token punctuation">{</span>
        server mirror_server1<span class="token punctuation">;</span>
        server mirror_server2<span class="token punctuation">;</span>
        server mirror_server3<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    server <span class="token punctuation">{</span>
        location / <span class="token punctuation">{</span>
            proxy_pass http://mirror_servers<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>在上述配置中，<code>upstream</code>指令定义了一组镜像服务器，可以是多个镜像服务器的地址。当请求到达时，<code>Nginx</code>会将请求分发到这组镜像服务器上，实现负载均衡镜像服务。</p></li></ol></li></ul> <h3 id="nginx安全认证"><a href="#nginx安全认证" class="header-anchor">#</a> <code>Nginx</code>安全认证</h3> <p>要在<code>Nginx</code>中进行安全认证，你可以使用HTTP基本认证（HTTP Basic Authentication）或使用第三方模块（如<code>ngx_http_auth_request_module</code>）进行高级认证。</p> <ol><li><p>HTTP基本认证（HTTP Basic Authentication）：</p> <ul><li>HTTP基本认证是一种简单的认证方法，它要求用户提供用户名和密码来访问受保护的资源。</li> <li>在<code>Nginx</code>中，你可以使用<code>auth_basic</code>和<code>auth_basic_user_file</code>指令来配置HTTP基本认证。</li> <li><code>auth_basic</code>指令用于启用基本认证，并指定认证提示信息。</li> <li><code>auth_basic_user_file</code>指令用于指定存储用户名和密码的文件路径。</li> <li>你可以使用<code>htpasswd</code>命令创建密码文件，例如：<code>htpasswd -c /etc/nginx/.htpasswd username</code>。</li></ul> <blockquote><p><code>username</code> 输入用户名,<code>yum install -y httpd-tools</code></p> <p>参考资料:<a href="https://www.cnblogs.com/Chilam007/p/16900400.html" target="_blank" rel="noopener noreferrer">Nginx实现安全认证Basic Auth <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <ul><li>配置示例：<div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 搭建文件服务器</span>
server <span class="token punctuation">{</span>
    listen <span class="token number">9006</span><span class="token punctuation">;</span>
    <span class="token comment"># 替换为你的域名</span>
    server_name example.com<span class="token punctuation">;</span>  

    location / <span class="token punctuation">{</span>
        <span class="token comment"># 替换为你的文件存储路径</span>
        root /upload<span class="token punctuation">;</span>
        <span class="token comment"># 设置安全认证</span>
        auth_basic <span class="token string">&quot;Restricted Content&quot;</span><span class="token punctuation">;</span>
        <span class="token comment"># 指定存储用户名和密码的文件路径。</span>
        auth_basic_user_file /etc/nginx/.htpasswd<span class="token punctuation">;</span>  
        autoindex on<span class="token punctuation">;</span>
        autoindex_exact_size on<span class="token punctuation">;</span>
        autoindex_localtime on<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 启动 Nginx Status模块</span>
    location /status <span class="token punctuation">{</span>
        stub_status on<span class="token punctuation">;</span>
        access_log off<span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li></ul></li> <li><p>第三方模块（<code>ngx_http_auth_request_module</code>）：</p> <ul><li><p><code>ngx_http_auth_request_module</code>是一个<code>Nginx</code>的第三方模块，它允许你使用自定义的认证后端来进行高级认证。</p></li> <li><p>该模块允许你将认证请求发送到另一个URL，并根据认证后端的响应来决定是否允许访问。</p></li> <li><p>配置示例：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>location / <span class="token punctuation">{</span>
    auth_request /auth<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

location <span class="token operator">=</span> /auth <span class="token punctuation">{</span>
    internal<span class="token punctuation">;</span>
    proxy_pass http://auth_backend<span class="token punctuation">;</span>
    proxy_pass_request_body off<span class="token punctuation">;</span>
    proxy_set_header Content-Length <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    proxy_set_header X-Original-URI <span class="token variable">$request_uri</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>在上述示例中，所有请求都被转发到<code>/auth</code>位置进行认证。</p></li> <li><p><code>/auth</code>位置使用<code>auth_request</code>指令将认证请求发送到<code>http://auth_backend</code>。</p></li> <li><p><code>auth_backend</code>是一个代表认证后端的上游服务器，你可以根据需要进行配置。</p></li></ul></li></ol> <p>这些是在<code>Nginx</code>中进行安全认证的两种常见方法。你可以根据你的具体需求和环境选择适合你的方法，并进行相应的配置。请注意，在配置认证时，确保密码文件或认证后端的连接是安全的，并采取适当的措施来保护用户凭据的安全性。</p> <h3 id="其他指令"><a href="#其他指令" class="header-anchor">#</a> 其他指令</h3> <ul><li><p><code>return</code></p> <p><code>return</code>指令用于返回指定的HTTP响应码和响应体，它可以用于快速返回响应而无需执行后续的请求处理。常见的用法是在<code>Nginx</code>配置中根据条件进行快速响应，或者在特定路径上返回自定义的响应。例如：</p> <div class="language-SHELL line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1. 返回指定的HTTP响应码， 在示例中，当请求匹配到`/maintenance`路径时，Nginx会返回一个HTTP 503响应码，表示服务器处于维护状态。</span>
   location /maintenance <span class="token punctuation">{</span>
     <span class="token builtin class-name">return</span> <span class="token number">503</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token comment">#2. 执行重定向,在此示例中，当有请求访问`http://example.com`时，Nginx会执行一个301重定向到`https://www.example.com`。</span>
   server <span class="token punctuation">{</span>
     listen <span class="token number">80</span><span class="token punctuation">;</span>
     server_name example.com<span class="token punctuation">;</span>
     <span class="token builtin class-name">return</span> <span class="token number">301</span> https://www.example.com<span class="token variable">$request_uri</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   
<span class="token comment"># 3. 返回自定义的错误页面，在此示例中，当请求无法匹配到任何有效的路径时，Nginx会返回一个HTTP 404响应码，并显示自定义的404错误页面。</span>
   error_page <span class="token number">404</span> /404.html<span class="token punctuation">;</span>
   location / <span class="token punctuation">{</span>
     <span class="token builtin class-name">return</span> <span class="token number">404</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token comment"># 4. 返回带有响应体的响应,在此示例中，当请求匹配到`/hello`路径时，Nginx会返回一个HTTP 200响应码，并在响应体中包含&quot;Hello, world!&quot;。</span>
   location /hello <span class="token punctuation">{</span>
     <span class="token builtin class-name">return</span> <span class="token number">200</span> <span class="token string">&quot;Hello, world!&quot;</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token comment"># 5.强制所有请求使用Https</span>
server <span class="token punctuation">{</span>

    listen <span class="token number">8003</span><span class="token punctuation">;</span>
    server_name ruoyi.loadbalance<span class="token punctuation">;</span>

    <span class="token builtin class-name">return</span> <span class="token number">301</span> https://192.168.56.105:8004<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment"># 6. 域名迁移，不让用户收藏的链接或者搜索引擎的链接失效,将请求从 www.old-name.com old-name.com 永久重定向到 www.new-name.com，包含http和https请求</span>
server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>
    server_name www.old-name.com old-name.com<span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token number">301</span> <span class="token variable">$scheme</span>://www.new-name.com<span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token comment"># 如果除了更改域名之外还重新组织了网站，则通过省略以下内容，将所有请求重定向到主页可能会更安全</span>
    <span class="token comment"># return 301 $scheme://www.new-name.com;</span>
<span class="token punctuation">}</span>
<span class="token comment"># 7. add 'www' 增加www</span>
server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>
    server_name domain.com<span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token number">301</span> <span class="token variable">$scheme</span>://www.domain.com<span class="token variable">$request_uri</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div></li> <li><p><code>rewrite</code></p> <p><code>rewrite</code>指令用于修改请求的URI或执行重定向操作。它使用正则表达式匹配请求的URI，并根据需要进行修改或重定向。常见的用法包括修改URI、重定向到其他URL或捕获参数等。例如：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1. 修改请求URI， 在示例中，当请求匹配到`/old-path`路径时，Nginx会将请求URI中的`/old-path/`替换为`/new-path/`，并继续处理请求。</span>
   location /old-path <span class="token punctuation">{</span>
     rewrite ^/old-path/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ /new-path/<span class="token variable">$1</span> last<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token comment"># 2. 执行重定向，在示例中，当有请求访问`http://example.com`时，Nginx会执行一个永久重定向到`https://www.example.com`。</span>
   server <span class="token punctuation">{</span>
     listen <span class="token number">80</span><span class="token punctuation">;</span>
     server_name example.com<span class="token punctuation">;</span>
     rewrite ^/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ https://www.example.com/<span class="token variable">$1</span> permanent<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token comment"># 3. 使用正则表达式捕获并传递参数,在示例中，当请求匹配到/category路径时，Nginx会将匹配的部分作为参数传递给/products，例如，/category/electronics将被重写为/products?category=electronics。</span>
   location /category <span class="token punctuation">{</span>
     rewrite ^/category/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ /products?category<span class="token operator">=</span><span class="token variable">$1</span> last<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token comment"># 4. 修改URI并终止请求处理, 在示例中，当请求匹配到/admin路径时，Nginx会将请求URI中的/admin/去除，并终止后续的rewrite指令和请求处理，直接进入/admin路径下的请求逻辑。</span>
   location /admin <span class="token punctuation">{</span>
     rewrite ^/admin/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ /<span class="token variable">$1</span> <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
     <span class="token comment"># 处理/admin路径下的请求逻辑...</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li> <li><p><code>break</code></p> <p><code>break</code>指令用于终止当前<code>rewrite</code>指令的执行，并立即退出当前的<code>location</code>块。它通常与<code>rewrite</code>指令结合使用，用于在<code>rewrite</code>中进行URI修改后立即停止后续的<code>rewrite</code>指令和请求处理。例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /admin {
  rewrite ^/admin/(.*)$ /$1 break;
  # 处理/admin路径下的请求逻辑...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>last</code></p> <p><code>last</code>指令用于终止当前的<code>rewrite</code>指令的执行，并重新开始处理新的请求。它通常与<code>rewrite</code>指令结合使用，用于在<code>rewrite</code>中进行URI修改后重新开始请求处理。例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /redirect {
  rewrite ^/redirect/(.*)$ /new-path/$1 last;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <h2 id="nginx优化"><a href="#nginx优化" class="header-anchor">#</a> <code>Nginx</code>优化</h2> <h3 id="nginx性能监控"><a href="#nginx性能监控" class="header-anchor">#</a> <code>Nginx</code>性能监控</h3> <p>在<code>Nginx</code>中，有几种常用的方式可以进行性能监控：</p> <ol><li><p><code>Nginx</code>状态模块：
<code>Nginx</code>提供了一个内置的状态模块（<code>ngx_http_stub_status_module</code>），可以通过该模块获取<code>Nginx</code>的基本性能指标，如活跃连接数、请求处理情况、吞吐量等。要启用该模块，需要在<code>Nginx</code>配置文件中添加相应的配置，并通过访问特定的URL来获取状态信息。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 搭建文件服务器
server {
    listen 9006;
    # 替换为你的域名
    server_name example.com;  

    location / {
        # 替换为你的文件存储路径
        root /upload;
        # 设置安全认证
        auth_basic &quot;Restricted Content&quot;;
        # 指定存储用户名和密码的文件路径。
        auth_basic_user_file /etc/nginx/.htpasswd;  
        autoindex on;
        autoindex_exact_size on;
        autoindex_localtime on;
    }
    # 启动 Nginx Status模块
    location /status {
        stub_status on;
        access_log off;  
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><blockquote><p>访问<code>localhost:9006/status</code> 输出类似如下信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#当前活动连接数为1。这表示当前有一个客户端连接到Nginx服务器。
Active connections: 1
# 这一行显示了Nginx服务器接受、处理和请求的统计数据。
 server accepts handled requests
 # 表示服务器已经接受的连接总数。在这个例子中，服务器已经接受了6个连接。
 # 表示服务器已经处理的连接总数。在这个例子中，服务器已经处理了6个连接。
 # 表示服务器已经处理的请求数量。在这个例子中，服务器已经处理了17个请求。
 6 6 17
 # Reading: 0：表示当前正在读取客户端请求的连接数。在这个例子中，没有连接正在进行读取操作。
 # Writing: 1：表示当前正在向客户端发送响应的连接数。在这个例子中，有一个连接正在进行写入操作，即向客户端发送响应。
 # Waiting: 0：表示当前等待空闲连接的连接数。在这个例子中，没有连接在等待空闲状态。
 Reading: 0 Writing: 1 Waiting: 0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>参考资料:<a href="https://developer.aliyun.com/article/792694?spm=a2c6h.12873639.article-detail.10.231143d1cWsg4K" target="_blank" rel="noopener noreferrer">Nginx极简入门（八）Nginx性能监控及性能状态参数详解！<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></li> <li><p><code>Nginx</code>日志：
<code>Nginx</code>生成的访问日志中包含了大量的信息，包括请求的时间、响应码、请求大小等。通过分析访问日志，可以了解<code>Nginx</code>的请求情况、响应时间和流量等指标。可以使用日志分析工具（如<code>ELK Stack</code>、<code>Splunk</code>等）对<code>Nginx</code>日志进行实时监控和分析。</p></li> <li><p>第三方监控工具：
有许多第三方监控工具可以用于监控<code>Nginx</code>的性能，如<code>Prometheus</code>、<code>Grafana</code>、<code>Zabbix</code>等。这些工具可以通过<code>Nginx</code>的状态模块、日志或其他方式获取性能指标，并提供可视化的仪表板和报警功能，帮助管理员实时监控<code>Nginx</code>的运行状态。</p></li> <li><p><code>Nginx Plus</code>：
<code>Nginx Plus</code>是<code>Nginx</code>官方提供的商业版本，它提供了高级的性能监控和管理功能。<code>Nginx Plus</code>可以通过内置的Dashboard和<code>API</code>提供实时的性能指标、连接数、请求处理情况等信息，并支持自定义的报警和日志功能。</p></li></ol> <h3 id="nginx优化方式"><a href="#nginx优化方式" class="header-anchor">#</a> <code>Nginx</code>优化方式</h3> <p>对<code>Nginx</code>进行优化可以提高其性能和可靠性，以下是一些常见的<code>Nginx</code>优化建议：</p> <ol><li><p>调整工作进程数：</p> <ul><li><code>Nginx</code>使用多个工作进程来处理请求，可以通过<code>worker_processes</code>指令来设置进程数。</li> <li>通常，可以将进程数设置为与服务器的CPU核心数相等或略多一些。</li> <li>例如，可以设置为<code>worker_processes auto;</code>，<code>Nginx</code>会自动检测可用的CPU核心数。</li></ul></li> <li><p>设置连接池：</p> <ul><li><code>Nginx</code>使用连接池来管理与客户端和上游服务器的连接。</li> <li>可以通过调整<code>worker_connections</code>指令来设置每个工作进程的最大连接数。</li> <li>例如，可以设置为<code>worker_connections 1024;</code>。</li></ul></li> <li><p>启用发送文件和TCP快速打包：</p> <ul><li><code>Nginx</code>可以使用<code>sendfile</code>指令将静态文件直接发送给客户端，而无需通过用户空间和内核空间之间的复制。</li> <li>可以通过设置<code>sendfile on;</code>来启用发送文件功能。</li> <li>另外，可以启用TCP快速打包来减少系统调用次数，通过设置<code>tcp_nopush on;</code>来启用。</li></ul></li> <li><p>启用压缩：</p> <ul><li><code>Nginx</code>可以对响应进行压缩，以减少传输的数据量。</li> <li>可以通过设置<code>gzip on;</code>来启用压缩功能。</li> <li>还可以根据需要进行其他压缩相关的配置，如<code>gzip_comp_level</code>、<code>gzip_types</code>等。</li></ul></li> <li><p>配置缓存：</p> <ul><li><code>Nginx</code>可以使用缓存来存储经常访问的静态资源，减少对后端服务器的请求。</li> <li>可以使用<code>proxy_cache</code>指令或<code>fastcgi_cache</code>指令来配置缓存。</li> <li>需要根据具体情况进行缓存的配置，包括缓存大小、缓存有效期等。</li></ul></li> <li><p>负载均衡：</p> <ul><li>如果有多个后端服务器，可以使用<code>Nginx</code>的负载均衡功能来分发请求。</li> <li>可以使用<code>upstream</code>指令配置后端服务器组，并选择适当的负载均衡算法，如轮询、<code>IP</code>哈希等。</li></ul></li> <li><p>启用日志轮转：</p> <ul><li><code>Nginx</code>会生成访问日志和错误日志，可以通过配置日志轮转来管理日志文件的大小和数量，以避免日志文件过大。</li> <li>可以使用<code>logrotate</code>等工具来实现日志轮转。</li></ul></li></ol> <h2 id="nginx参考资料"><a href="#nginx参考资料" class="header-anchor">#</a> <code>Nginx</code>参考资料</h2> <p><a href="https://dunwu.github.io/nginx-tutorial/" target="_blank" rel="noopener noreferrer">nginx-tutorial<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6844904082067423246" target="_blank" rel="noopener noreferrer">Nginx 入门实战 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/7112826654291918855?searchId=20230728135847C7C19AF5D84F88A9FC0A#heading-3" target="_blank" rel="noopener noreferrer">Nginx一网打尽：动静分离、压缩、缓存、黑白名单、跨域、高可用、性能优化...想要的这都有！<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.yuque.com/wukong-zorrm/cql6cz" target="_blank" rel="noopener noreferrer">nginx一小时入门教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/handbook/devops/docker.html" class="prev">
          Docker
        </a></span> <span class="next"><a href="/blog/handbook/devops/Kubernetes.html">
          K8s教程
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-7115df4a data-v-1c636796><li class="level-2" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#安装和简介" class="sidebar-link reco-side-安装和简介" data-v-7115df4a>安装和简介</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#nginx简介" class="sidebar-link reco-side-nginx简介" data-v-7115df4a>Nginx简介</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#nginx安装" class="sidebar-link reco-side-nginx安装" data-v-7115df4a>Nginx安装</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#nginx常用命令" class="sidebar-link reco-side-nginx常用命令" data-v-7115df4a>Nginx常用命令</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#nginx配置文件结构" class="sidebar-link reco-side-nginx配置文件结构" data-v-7115df4a>Nginx配置文件结构</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#一些重要的文件" class="sidebar-link reco-side-一些重要的文件" data-v-7115df4a>一些重要的文件</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#一些必备基础" class="sidebar-link reco-side-一些必备基础" data-v-7115df4a>一些必备基础</a></li><li class="level-2" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#环境准备" class="sidebar-link reco-side-环境准备" data-v-7115df4a>环境准备</a></li><li class="level-2" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#常见使用场景" class="sidebar-link reco-side-常见使用场景" data-v-7115df4a>常见使用场景</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#静态网页" class="sidebar-link reco-side-静态网页" data-v-7115df4a>静态网页</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#http反向代理" class="sidebar-link reco-side-http反向代理" data-v-7115df4a>HTTP反向代理</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#动静分离" class="sidebar-link reco-side-动静分离" data-v-7115df4a>动静分离</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#缓冲和缓存" class="sidebar-link reco-side-缓冲和缓存" data-v-7115df4a>缓冲和缓存</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#负载均衡" class="sidebar-link reco-side-负载均衡" data-v-7115df4a>负载均衡</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#https配置" class="sidebar-link reco-side-https配置" data-v-7115df4a>HTTPS配置</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#tcp反向代理" class="sidebar-link reco-side-tcp反向代理" data-v-7115df4a>TCP反向代理</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#搭建文件服务器" class="sidebar-link reco-side-搭建文件服务器" data-v-7115df4a>搭建文件服务器</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#解决跨域" class="sidebar-link reco-side-解决跨域" data-v-7115df4a>解决跨域</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#nginx限流" class="sidebar-link reco-side-nginx限流" data-v-7115df4a>Nginx限流</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#nginx热备" class="sidebar-link reco-side-nginx热备" data-v-7115df4a>Nginx热备</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#nginx镜像服务器" class="sidebar-link reco-side-nginx镜像服务器" data-v-7115df4a>Nginx镜像服务器</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#nginx安全认证" class="sidebar-link reco-side-nginx安全认证" data-v-7115df4a>Nginx安全认证</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#其他指令" class="sidebar-link reco-side-其他指令" data-v-7115df4a>其他指令</a></li><li class="level-2" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#nginx优化" class="sidebar-link reco-side-nginx优化" data-v-7115df4a>Nginx优化</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#nginx性能监控" class="sidebar-link reco-side-nginx性能监控" data-v-7115df4a>Nginx性能监控</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#nginx优化方式" class="sidebar-link reco-side-nginx优化方式" data-v-7115df4a>Nginx优化方式</a></li><li class="level-2" data-v-7115df4a><a href="/blog/handbook/devops/nginx.html#nginx参考资料" class="sidebar-link reco-side-nginx参考资料" data-v-7115df4a>Nginx参考资料</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-65133105 data-v-65133105><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-65133105><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-65133105></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-65133105></path></svg></div><canvas id="vuepress-canvas-cursor"></canvas><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:50px;bottom:-70px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/blog/assets/js/app.f600c34c.js" defer></script><script src="/blog/assets/js/3.1aae9359.js" defer></script><script src="/blog/assets/js/1.ae8a88ec.js" defer></script><script src="/blog/assets/js/57.b7d9dbdd.js" defer></script>
  </body>
</html>
