<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第九章 Spark | Adopat的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/blog/logo.jpeg">
    <link rel="manifest" href="/blog/logo.jpeg">
    <link rel="apple-touch-icon" href="/blog/logo.jpeg">
    <link rel="mask-icon" href="/blog/logo.jpeg" color="#3eaf7c">
    <meta name="description" content="长路漫漫，唯键作伴">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="expires" cotent="0">
    <meta http-quiv="pragma" cotent="no-cache, must-revalidate">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta charset="utf-8">
    
    <link rel="preload" href="/blog/assets/css/0.styles.c74f429a.css" as="style"><link rel="preload" href="/blog/assets/js/app.f600c34c.js" as="script"><link rel="preload" href="/blog/assets/js/3.1aae9359.js" as="script"><link rel="preload" href="/blog/assets/js/1.ae8a88ec.js" as="script"><link rel="preload" href="/blog/assets/js/49.eaea0707.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.d3b9c11d.js"><link rel="prefetch" href="/blog/assets/js/11.acb152df.js"><link rel="prefetch" href="/blog/assets/js/12.c8509742.js"><link rel="prefetch" href="/blog/assets/js/13.811061e2.js"><link rel="prefetch" href="/blog/assets/js/14.db6b0e70.js"><link rel="prefetch" href="/blog/assets/js/15.2ce37a4a.js"><link rel="prefetch" href="/blog/assets/js/16.b3452aec.js"><link rel="prefetch" href="/blog/assets/js/17.dc1a8405.js"><link rel="prefetch" href="/blog/assets/js/18.f03199ab.js"><link rel="prefetch" href="/blog/assets/js/19.bb1e396b.js"><link rel="prefetch" href="/blog/assets/js/20.4e2d0adb.js"><link rel="prefetch" href="/blog/assets/js/21.b67291e2.js"><link rel="prefetch" href="/blog/assets/js/22.057ea7c4.js"><link rel="prefetch" href="/blog/assets/js/23.70da62c2.js"><link rel="prefetch" href="/blog/assets/js/24.8cd404c5.js"><link rel="prefetch" href="/blog/assets/js/25.e637bb66.js"><link rel="prefetch" href="/blog/assets/js/26.bb3896ad.js"><link rel="prefetch" href="/blog/assets/js/27.021e6dc3.js"><link rel="prefetch" href="/blog/assets/js/28.6949fbc1.js"><link rel="prefetch" href="/blog/assets/js/29.6c652456.js"><link rel="prefetch" href="/blog/assets/js/30.f23dfdea.js"><link rel="prefetch" href="/blog/assets/js/31.3dcf5164.js"><link rel="prefetch" href="/blog/assets/js/32.b554bb64.js"><link rel="prefetch" href="/blog/assets/js/33.6ba9e186.js"><link rel="prefetch" href="/blog/assets/js/34.2ae1eb6a.js"><link rel="prefetch" href="/blog/assets/js/35.1fe5b5a2.js"><link rel="prefetch" href="/blog/assets/js/36.614599d6.js"><link rel="prefetch" href="/blog/assets/js/37.311ebd2c.js"><link rel="prefetch" href="/blog/assets/js/38.50bccc51.js"><link rel="prefetch" href="/blog/assets/js/39.fc5b9233.js"><link rel="prefetch" href="/blog/assets/js/4.1dd123be.js"><link rel="prefetch" href="/blog/assets/js/40.f5520796.js"><link rel="prefetch" href="/blog/assets/js/41.a23e6477.js"><link rel="prefetch" href="/blog/assets/js/42.1ad13e0e.js"><link rel="prefetch" href="/blog/assets/js/43.1235eb55.js"><link rel="prefetch" href="/blog/assets/js/44.e50bce95.js"><link rel="prefetch" href="/blog/assets/js/45.96aaada5.js"><link rel="prefetch" href="/blog/assets/js/46.f656cba5.js"><link rel="prefetch" href="/blog/assets/js/47.e170369f.js"><link rel="prefetch" href="/blog/assets/js/48.95e08a63.js"><link rel="prefetch" href="/blog/assets/js/5.4cb445b4.js"><link rel="prefetch" href="/blog/assets/js/50.b1126e4d.js"><link rel="prefetch" href="/blog/assets/js/51.c28c85ff.js"><link rel="prefetch" href="/blog/assets/js/52.431357ea.js"><link rel="prefetch" href="/blog/assets/js/53.be380102.js"><link rel="prefetch" href="/blog/assets/js/54.5877a497.js"><link rel="prefetch" href="/blog/assets/js/55.e1d5dddb.js"><link rel="prefetch" href="/blog/assets/js/56.1962bc1e.js"><link rel="prefetch" href="/blog/assets/js/57.b7d9dbdd.js"><link rel="prefetch" href="/blog/assets/js/58.b5d9b427.js"><link rel="prefetch" href="/blog/assets/js/59.e07757a4.js"><link rel="prefetch" href="/blog/assets/js/6.e02ce0fc.js"><link rel="prefetch" href="/blog/assets/js/60.50d5d207.js"><link rel="prefetch" href="/blog/assets/js/61.2bdc68d5.js"><link rel="prefetch" href="/blog/assets/js/62.6f6c77db.js"><link rel="prefetch" href="/blog/assets/js/63.fd62d822.js"><link rel="prefetch" href="/blog/assets/js/64.d83a9500.js"><link rel="prefetch" href="/blog/assets/js/65.e76b3053.js"><link rel="prefetch" href="/blog/assets/js/66.de39f9b4.js"><link rel="prefetch" href="/blog/assets/js/67.44ce2347.js"><link rel="prefetch" href="/blog/assets/js/68.9efe46cd.js"><link rel="prefetch" href="/blog/assets/js/69.a06475fc.js"><link rel="prefetch" href="/blog/assets/js/7.3df43e48.js"><link rel="prefetch" href="/blog/assets/js/70.d38d05d7.js"><link rel="prefetch" href="/blog/assets/js/71.563b0c4a.js"><link rel="prefetch" href="/blog/assets/js/72.14bc1390.js"><link rel="prefetch" href="/blog/assets/js/73.9d176c78.js"><link rel="prefetch" href="/blog/assets/js/74.3a37688f.js"><link rel="prefetch" href="/blog/assets/js/75.7c4802f6.js"><link rel="prefetch" href="/blog/assets/js/76.7309aafa.js"><link rel="prefetch" href="/blog/assets/js/77.418b1686.js"><link rel="prefetch" href="/blog/assets/js/78.8b748ecf.js"><link rel="prefetch" href="/blog/assets/js/8.417a4fef.js"><link rel="prefetch" href="/blog/assets/js/9.28024d7d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.c74f429a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1c636796><div data-v-1c636796><div class="password-shadow password-wrapper-out" style="display:none;" data-v-2c3e9f55 data-v-1c636796 data-v-1c636796><h3 class="title" data-v-2c3e9f55>Adopat的博客</h3> <p class="description" data-v-2c3e9f55>长路漫漫，唯键作伴</p> <label id="box" class="inputBox" data-v-2c3e9f55><input type="password" value="" data-v-2c3e9f55> <span data-v-2c3e9f55>Konck! Knock!</span> <button data-v-2c3e9f55>OK</button></label> <div class="footer" data-v-2c3e9f55><span data-v-2c3e9f55><i class="iconfont reco-theme" data-v-2c3e9f55></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-2c3e9f55>vuePress-theme-reco</a></span> <span data-v-2c3e9f55><i class="iconfont reco-copyright" data-v-2c3e9f55></i> <a data-v-2c3e9f55><span data-v-2c3e9f55>Adopat</span>
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-1c636796><header class="navbar" data-v-1c636796><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.jpeg" alt="Adopat的博客" class="logo"> <span class="site-name">Adopat的博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  HOME
</a></div><div class="nav-item"><a href="/blog/handbook/about/" class="nav-link"><i class="iconfont reco-document"></i>
  导读
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/handbook/basic/composition-principle.html" class="nav-link"><i class="fa fa-solid fa-computer"></i>
  计算机基础
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/frontend/basic.html" class="nav-link"><i class="fa fa-brands fa-js"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/backend/java-core-basic.html" class="nav-link"><i class="fa fa-brands fa-java"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/database/" class="nav-link"><i class="fa fa-solid fa-database"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/bigdata/hadoop.html" class="nav-link"><i class="fa fa-brands fa-hive"></i>
  大数据
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/ml/python-core.html" class="nav-link"><i class="fa fa-brands fa-python"></i>
  人工智能
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/devops/docker.html" class="nav-link"><i class="fa fa-brands fa-docker"></i>
  运维
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/tools/Git.html" class="nav-link"><i class="fa fa-solid fa-toolbox"></i>
  常用开发工具
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      友情链接
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_44446122?type=blog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Adopat" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1c636796></div> <aside class="sidebar" data-v-1c636796><div class="personal-info-wrapper" data-v-6f92ba70 data-v-1c636796><!----> <h3 class="name" data-v-6f92ba70>
    Adopat
  </h3> <div class="num" data-v-6f92ba70><div data-v-6f92ba70><h3 data-v-6f92ba70>67</h3> <h6 data-v-6f92ba70>文章</h6></div> <div data-v-6f92ba70><h3 data-v-6f92ba70>0</h3> <h6 data-v-6f92ba70>标签</h6></div></div> <ul class="social-links" data-v-6f92ba70></ul> <hr data-v-6f92ba70></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  HOME
</a></div><div class="nav-item"><a href="/blog/handbook/about/" class="nav-link"><i class="iconfont reco-document"></i>
  导读
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/handbook/basic/composition-principle.html" class="nav-link"><i class="fa fa-solid fa-computer"></i>
  计算机基础
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/frontend/basic.html" class="nav-link"><i class="fa fa-brands fa-js"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/backend/java-core-basic.html" class="nav-link"><i class="fa fa-brands fa-java"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/database/" class="nav-link"><i class="fa fa-solid fa-database"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/bigdata/hadoop.html" class="nav-link"><i class="fa fa-brands fa-hive"></i>
  大数据
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/ml/python-core.html" class="nav-link"><i class="fa fa-brands fa-python"></i>
  人工智能
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/devops/docker.html" class="nav-link"><i class="fa fa-brands fa-docker"></i>
  运维
</a></li><li class="dropdown-item"><!----> <a href="/blog/handbook/tools/Git.html" class="nav-link"><i class="fa fa-solid fa-toolbox"></i>
  常用开发工具
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      友情链接
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_44446122?type=blog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Adopat" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>大数据基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/bigdata/hadoop.html" class="sidebar-link">第一章 Hadoop</a></li><li><a href="/blog/handbook/bigdata/hdfs.html" class="sidebar-link">第二章 HDFS</a></li><li><a href="/blog/handbook/bigdata/mapreduce.html" class="sidebar-link">第三章 MapReduce</a></li><li><a href="/blog/handbook/bigdata/mapreduce1.html" class="sidebar-link">第四章 MapReduce性能优化</a></li><li><a href="/blog/handbook/bigdata/yarn.html" class="sidebar-link">第五章 YARN</a></li><li><a href="/blog/handbook/bigdata/flume.html" class="sidebar-link">第六章 Flume</a></li><li><a href="/blog/handbook/bigdata/hive.html" class="sidebar-link">第七章 HIVE</a></li><li><a href="/blog/handbook/bigdata/scala.html" class="sidebar-link">第八章 Scala</a></li><li><a href="/blog/handbook/bigdata/spark.html" aria-current="page" class="active sidebar-link">第九章 Spark</a></li><li><a href="/blog/handbook/bigdata/flink.html" class="sidebar-link">第十章 Flink</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>大数据进阶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-2c3e9f55 data-v-1c636796><h3 class="title" data-v-2c3e9f55></h3> <!----> <label id="box" class="inputBox" data-v-2c3e9f55><input type="password" value="" data-v-2c3e9f55> <span data-v-2c3e9f55>Konck! Knock!</span> <button data-v-2c3e9f55>OK</button></label> <div class="footer" data-v-2c3e9f55><span data-v-2c3e9f55><i class="iconfont reco-theme" data-v-2c3e9f55></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-2c3e9f55>vuePress-theme-reco</a></span> <span data-v-2c3e9f55><i class="iconfont reco-copyright" data-v-2c3e9f55></i> <a data-v-2c3e9f55><span data-v-2c3e9f55>Adopat</span>
          
        <!---->
        2023
      </a></span></div></div> <div data-v-1c636796><div data-v-1c636796><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">第九章 Spark</h1> <div data-v-6acedb3b><i class="iconfont reco-account" data-v-6acedb3b><span data-v-6acedb3b>Adopat</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="第九章-spark"><a href="#第九章-spark" class="header-anchor">#</a> 第九章 Spark</h1> <h2 id="_0-思维导图"><a href="#_0-思维导图" class="header-anchor">#</a> 0. 思维导图</h2> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/Spark-1666419078060.png" alt="Spark"></p> <h2 id="_1-spark基础"><a href="#_1-spark基础" class="header-anchor">#</a> 1.Spark基础</h2> <h3 id="_1-1-spark概念"><a href="#_1-1-spark概念" class="header-anchor">#</a> 1.1 Spark概念</h3> <p>Spark是一个用于大规模数据处理的统一<strong>计算引擎</strong>。</p> <blockquote><p>注意：Spark不仅仅可以做类似于<a href="https://so.csdn.net/so/search?q=MapReduce&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">MapReduce<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的离线数据计算，还可以做实时数据计算，并且它还可以实现类似于Hive的SQL计算，等等，所以说它是一个统一的计算引擎。</p></blockquote> <h3 id="_1-2-spark特点"><a href="#_1-2-spark特点" class="header-anchor">#</a> 1.2 Spark特点</h3> <ul><li><p>Speed：速度快</p> <p>Spark基于内存计算，计算速度理论上比MapReduce快100倍。</p></li> <li><p>Easy of Use：易用性</p> <p>Spark 可以使用多种编程语言快速编写应用程序，例如Java、Scala、Python、R和SQL,Spark提供了80多个高阶函数，可以轻松构建Spark任务。</p></li> <li><p>Generality：通用性</p> <p>Spark提供了Core、SQL、Streaming、MLlib、GraphX等技术组件，可以一站式地完成大数据领域的离线批处理、SQL交互式查询、流式实时计算，机器学习、图计算等常见的任务。从这可以看出来Spark也是一个具备完整生态圈的技术框架，它不是一个人在战斗。</p></li> <li><p>Runs Everywhere：到处运行</p> <p>你可以在<a href="https://so.csdn.net/so/search?q=Hadoop&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">Hadoop<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> YARN、Mesos或Kubernetes上使用Spark集群。并且可以访问HDFS、Alluxio、Apache Cassandra、Apache HBase、Apache Hive和数百个其它数据源中的数据。</p></li></ul> <h3 id="_1-3-spark和hadoop对比"><a href="#_1-3-spark和hadoop对比" class="header-anchor">#</a> 1.3 Spark和Hadoop对比</h3> <table><thead><tr><th style="text-align:center;"></th> <th style="text-align:center;">Hadoop</th> <th style="text-align:center;">Spark</th></tr></thead> <tbody><tr><td style="text-align:center;">类型</td> <td style="text-align:center;">分布式基础平台, 包含计算, 存储, 调度</td> <td style="text-align:center;">分布式计算工具</td></tr> <tr><td style="text-align:center;">场景</td> <td style="text-align:center;">大规模数据集上的批处理</td> <td style="text-align:center;">迭代计算, 交互式计算, 流计算</td></tr> <tr><td style="text-align:center;">价格</td> <td style="text-align:center;">对机器要求低, 便宜</td> <td style="text-align:center;">对内存有要求, 相对较贵</td></tr> <tr><td style="text-align:center;">编程范式</td> <td style="text-align:center;">Map+Reduce, API 较为底层, 算法适应性差</td> <td style="text-align:center;">RDD 组成 DAG 有向无环图, API 较为顶层, 方便使用</td></tr> <tr><td style="text-align:center;">数据存储结构</td> <td style="text-align:center;">MapReduce 中间计算结果存在 HDFS 磁盘上, 延迟大</td> <td style="text-align:center;">RDD 中间运算结果存在内存中 , 延迟小</td></tr> <tr><td style="text-align:center;">运行方式</td> <td style="text-align:center;">Task 以进程方式维护, 任务启动慢</td> <td style="text-align:center;">Task 以线程方式维护, 任务启动快</td></tr></tbody></table> <blockquote><p>尽管 Spark 相对于 Hadoop 而言具有较大优势，但 Spark 并不能完全替代 Hadoop，Spark 主要用于替代 Hadoop 中的 MapReduce 计算模型。存储依然可以使用 HDFS，但是中间结果可以存放在内存中；调度可以使用 Spark 内置的，也可以使用更成熟的调度系统 YARN 等。
实际上，Spark 已经很好地融入了 Hadoop 生态圈，并成为其中的重要一员，它可以借助于 YARN 实现资源调度管理，借助于 HDFS 实现分布式存储。
此外，Hadoop 可以使用廉价的、异构的机器来做分布式存储与计算，但是，Spark 对硬件的要求稍高一些，对内存与 CPU 有一定的要求。</p></blockquote> <h3 id="_1-4-spark-和-hadoop结合使用"><a href="#_1-4-spark-和-hadoop结合使用" class="header-anchor">#</a> 1.4 Spark 和 Hadoop结合使用</h3> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221024130538541.png" alt="image-20221024130538541"></p> <blockquote><p>底层是Hadoop的HDFS和YARN
Spark core指的是Spark的离线批处理
Spark Streaming指的是Spark的实时流计算
SparkSQL指的是Spark中的SQL计算
Spark Mlib指的是Spark中的机器学习库，这里面集成了很多机器学习算法
最后这个Spark GraphX是指图计算</p></blockquote> <h3 id="_1-5-spark主要应用场景"><a href="#_1-5-spark主要应用场景" class="header-anchor">#</a> 1.5 Spark主要应用场景</h3> <ul><li>低延时的海量数据计算需求(Spark core)</li> <li>低延时SQL交互查询需求(Spark SQL)</li> <li>准实时(秒级)海量数据计算需求(Spark Streaming)</li></ul> <h3 id="_1-6-spark部署方式"><a href="#_1-6-spark部署方式" class="header-anchor">#</a> 1.6 Spark部署方式</h3> <ul><li><p>Standalong</p> <p>Standalone模式就是说部署一套独立的Spark集群，后期开发的Spark任务就在这个独立的Spark集群中执行。</p> <p>安装步骤(1主两从)</p> <ol><li><p>上传并解压</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata01 soft<span class="token punctuation">]</span><span class="token comment"># tar -zxvf spark-2.4.3-bin-hadoop2.7.tgz</span>
<span class="token punctuation">[</span>root@bigdata01 soft<span class="token punctuation">]</span><span class="token comment"># mv spark-2.4.3-bin-hadoop2.7 spark-2.4.3-bin-hadoop2.7-standalong</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>注意：需要确保这几台机器上的基础环境是OK的，防火墙、免密码登录、还有JDK。</p> <p>主节点 : bigdata01</p> <p>从节点 : bigdata02 bigdata03</p></blockquote></li> <li><p>重命名 spark-env.sh.template</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata01 soft<span class="token punctuation">]</span><span class="token comment"># mv spark-env.sh.template spark-env.sh</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>修改spark-env.sh</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/data/soft/jdk1.8
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SPARK_MASTER_HOST</span><span class="token operator">=</span>bigdata01
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>在文件末尾 增加</p></blockquote></li> <li><p>重命名slaves.template</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata01 conf<span class="token punctuation">]</span><span class="token comment"># mv slaves.template slaves</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>修改slaves</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>bigdata02
bigdata03
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>去掉文件末尾 localhost 增加以下两个从节点</p></blockquote></li> <li><p>将修改好配置的spark安装包，拷贝到bigdata02和bigdata03上</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata01 soft<span class="token punctuation">]</span><span class="token comment"># scp -rq spark-2.4.3-bin-hadoop2.7-standalong bigdata02:/data/soft/</span>
<span class="token punctuation">[</span>root@bigdata01 soft<span class="token punctuation">]</span><span class="token comment"># scp -rq spark-2.4.3-bin-hadoop2.7-standalong bigdata03:/data/soft/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>启动集群</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata01 soft<span class="token punctuation">]</span><span class="token comment"># cd spark-2.4.3-bin-hadoop2.7-standalong/</span>
<span class="token punctuation">[</span>root@bigdata01 spark-2.4.3-bin-hadoop2.7-standalong<span class="token punctuation">]</span><span class="token comment"># sbin/start-all.sh </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>验证</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata01 spark-2.4.3-bin-hadoop2.7-standalong<span class="token punctuation">]</span><span class="token comment"># jps</span>
<span class="token number">1945</span> Master
<span class="token number">1999</span> Jps
<span class="token punctuation">[</span>root@bigdata02 soft<span class="token punctuation">]</span><span class="token comment"># jps</span>
<span class="token number">1923</span> Jps
<span class="token number">1877</span> Worker
<span class="token punctuation">[</span>root@bigdata03 soft<span class="token punctuation">]</span><span class="token comment"># jps</span>
<span class="token number">1884</span> Worker
<span class="token number">1932</span> Jps
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>在主节点上能看到Master 进程，从节点看到Worker进程就说明部署成功了。也可以在SparkWeb界面查看 http://bigdata01:8080/</p> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221024145727548.png" alt="image-20221024145727548"></p></blockquote></li> <li><p>提交任务</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata01 spark-2.4.3-bin-hadoop2.7-standalong<span class="token punctuation">]</span><span class="token comment"># bin/spark-submit  --class org.apache.spark.examples.SparkPi --master spark://bigdata01:7077 examples/jars/spark-examples_2.11-2.4.3.jar 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>停止Spark集群</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata01 spark-2.4.3-bin-hadoop2.7-standalong<span class="token punctuation">]</span><span class="token comment"># sbin/stop-all.sh </span>
bigdata03: stopping org.apache.spark.deploy.worker.Worker
bigdata02: stopping org.apache.spark.deploy.worker.Worker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol></li> <li><p>ON YARN模式</p> <p>ON YARN模式是说使用现有的Hadoop集群，后期开发的Spark任务会在这个Hadoop集群中执行，此时这个Hadoop集群就是一个公共的了，不仅可以运行MapReduce任务，还可以运行Spark任务，这样集群的资源就可以共享了，并且也不需要再维护一套集群了，减少了运维成本和运维压力，一举两得。<strong>推荐使用</strong></p> <p>部署步骤</p> <ol><li><p>上传并解压</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata04 soft<span class="token punctuation">]</span><span class="token comment"># tar -zxvf spark-2.4.3-bin-hadoop2.7.tgz</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>Spark的客户端节点同时也需要是Hadoop的客户端节点，因为Spark需要依赖于Hadoop,所以ON YARN模式里，我们只需要在Hadoop客户端节点上部署Spark就可以了</p></blockquote></li> <li><p>重命名spark-env.sh.template</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata04 soft<span class="token punctuation">]</span><span class="token comment"># cd spark-2.4.3-bin-hadoop2.7/conf/</span>
<span class="token punctuation">[</span>root@bigdata04 conf<span class="token punctuation">]</span><span class="token comment"># mv spark-env.sh.template  spark-env.sh</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>修改spark-env.sh</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/data/soft/jdk1.8
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_CONF_DIR</span><span class="token operator">=</span>/data/soft/hadoop-3.2.0/etc/hadoop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>开启Spark historyServer</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata04 conf<span class="token punctuation">]</span><span class="token comment"># mv spark-defaults.conf.template  spark-defaults.conf</span>
<span class="token punctuation">[</span>root@bigdata04 conf<span class="token punctuation">]</span><span class="token comment"># vi spark-defaults.conf</span>
<span class="token assign-left variable">spark.eventLog.enabled</span><span class="token operator">=</span>true
<span class="token assign-left variable">spark.eventLog.compress</span><span class="token operator">=</span>true
<span class="token assign-left variable">spark.eventLog.dir</span><span class="token operator">=</span>hdfs://bigdata01:9000/tmp/logs/root/logs
<span class="token assign-left variable">spark.history.fs.logDirectory</span><span class="token operator">=</span>hdfs://bigdata01:9000/tmp/logs/root/logs
<span class="token assign-left variable">spark.yarn.historyServer.address</span><span class="token operator">=</span>http://bigdata04:18080
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 在 spark-env.sh</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SPARK_HISTORY_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Dspark.history.ui.port=18080 -Dspark.history.fs.logDirectory=hdfs://bigdata01:9000/tmp/logs/root/logs&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>注意：在哪个节点上启动spark的historyserver进程，spark.yarn.historyServer.address的值里面就指定哪个节点的主机名信息。可以在任一节点上启动spark historyServer 包括客户端节点。</p></blockquote></li> <li><p>启动Hadoop集群和history服务</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata01 hadoop-3.2.0<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/data/soft/hadoop-3.2.0
<span class="token comment"># 启动Hadoop集群</span>
<span class="token punctuation">[</span>root@bigdata01 hadoop-3.2.0<span class="token punctuation">]</span><span class="token comment"># sbin/start-all.sh </span>
<span class="token comment"># bigdata01开启 日志聚合</span>
<span class="token punctuation">[</span>root@bigdata01 hadoop-3.2.0<span class="token punctuation">]</span><span class="token comment"># bin/mapred --daemon start historyserver</span>
<span class="token comment"># 验证</span>
<span class="token punctuation">[</span>root@bigdata01 hadoop-3.2.0<span class="token punctuation">]</span><span class="token comment"># jps</span>
<span class="token number">3248</span> JobHistoryServer
<span class="token number">3316</span> Jps
<span class="token number">2632</span> SecondaryNameNode
<span class="token number">2875</span> ResourceManager
<span class="token number">2367</span> NameNode
 <span class="token comment"># bigdata02开启 日志聚合</span>
 <span class="token punctuation">[</span>root@bigdata02 hadoop-3.2.0<span class="token punctuation">]</span><span class="token comment"># bin/mapred --daemon start historyserver</span>
 <span class="token comment"># bigdata02验证</span>
 <span class="token punctuation">[</span>root@bigdata02 hadoop-3.2.0<span class="token punctuation">]</span><span class="token comment"># jps</span>
 <span class="token number">2145</span> DataNode
 <span class="token number">2420</span> JobHistoryServer
 <span class="token number">2477</span> Jps
 <span class="token number">2255</span> NodeManager
 <span class="token comment"># bigdata03开启 日志聚合</span>
<span class="token punctuation">[</span>root@bigdata03 hadoop-3.2.0<span class="token punctuation">]</span><span class="token comment"># bin/mapred --daemon start historyserver</span>
<span class="token comment"># bigdata03验证</span>
<span class="token punctuation">[</span>root@bigdata03 hadoop-3.2.0<span class="token punctuation">]</span><span class="token comment"># jps</span>
<span class="token number">2487</span> Jps
<span class="token number">2266</span> NodeManager
<span class="token number">2156</span> DataNode
<span class="token number">2430</span> JobHistoryServer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></li> <li><p>启动Spark和spark history</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata04 spark-2.4.3-bin-hadoop2.7<span class="token punctuation">]</span><span class="token comment"># sbin/start-all.sh</span>
<span class="token punctuation">[</span>root@bigdata04 spark-2.4.3-bin-hadoop2.7<span class="token punctuation">]</span><span class="token comment"># sbin/start-history-server.sh </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>提交任务</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@bigdata04 spark-2.4.3-bin-hadoop2.7]# bin/spark-submit --class org.apache.spark.examples.SparkPi --master yarn --deploy-mode cluster examples/jars/spark-examples_2.11-2.4.3.jar 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>查看任务</p> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221024152704945.png" alt="image-20221024152704945"></p> <blockquote><p>可以到YARN的8088界面查看提交上去的任务信息</p></blockquote></li> <li><p>关闭Spark服务</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata04 spark-2.4.3-bin-hadoop2.7<span class="token punctuation">]</span><span class="token comment"># sbin/stop-all.sh </span>
localhost: stopping org.apache.spark.deploy.worker.Worker
stopping org.apache.spark.deploy.master.Master
<span class="token punctuation">[</span>root@bigdata04 spark-2.4.3-bin-hadoop2.7<span class="token punctuation">]</span><span class="token comment"># sbin/stop-history-server.sh </span>
stopping org.apache.spark.deploy.history.HistoryServer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol></li></ul> <h3 id="_1-7-idea配置scala开发环境"><a href="#_1-7-idea配置scala开发环境" class="header-anchor">#</a> 1.7 idea配置Scala开发环境</h3> <ul><li><p>创建maven项目</p></li> <li><p>添加scala的sdk</p></li> <li><p>增加scala目录并设置为root source</p></li> <li><p>添加Spark的maven依赖</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spark<span class="token operator">-</span>core_2<span class="token punctuation">.</span><span class="token number">11</span><span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">2.4</span><span class="token number">.3</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>            <span class="token generics"><span class="token punctuation">&lt;</span>scope<span class="token punctuation">&gt;</span></span>provided<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">&gt;</span><span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>注意项目打包的时候要把spark-core依赖的作用域设置为provided</p></blockquote></li> <li><p>增加log4j依赖</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>slf4j<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>slf4j<span class="token operator">-</span>api<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.7</span><span class="token number">.10</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>slf4j<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>slf4j<span class="token operator">-</span>log4j12<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.7</span><span class="token number">.10</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>log4j<span class="token punctuation">.</span>rootLogger<span class="token operator">=</span>error<span class="token punctuation">,</span>stdout

log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>stdout <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span>ConsoleAppender</span>
<span class="token class-name"><span class="token namespace">log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span></span>Target</span> <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out
log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>layout<span class="token operator">=</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span>PatternLayout</span> 
<span class="token class-name"><span class="token namespace">log4j<span class="token punctuation">.</span>appender<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>layout<span class="token punctuation">.</span></span>ConversionPattern</span><span class="token operator">=</span><span class="token operator">%</span>d<span class="token punctuation">{</span>yyyy<span class="token operator">-</span><span class="token constant">MM</span><span class="token operator">-</span>dd <span class="token constant">HH</span><span class="token operator">:</span>mm<span class="token operator">:</span>ss<span class="token punctuation">,</span><span class="token constant">SSS</span><span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token operator">%</span>t<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">%</span>c<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">%</span>p<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token operator">%</span>m<span class="token operator">%</span>n
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>在resource 目录下 创建log4j.properties文件，将日志级别设置为error</p></blockquote> <blockquote><p>去除一些红色警告，方便开发</p></blockquote></li> <li><p>配置Hadoop_HOME</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span><span class="token string">'E:\hadoop\hadoop-common-2.2.0-bin-master'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>因为一般情况下<a href="https://so.csdn.net/so/search?q=Hadoop&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">Hadoop<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、spark都是运行在Linux系统下的，在windows下运行时需要安装Windows下运行的支持插件：hadoop2.7-common-bin</p></blockquote></li> <li><p>设置hdfs-site.xml中配置dfs.permissions.enabled为false</p> <blockquote><p>主要是为了防止windows用户无法向hdfs中写入数据</p></blockquote></li> <li><p>打包设置</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span>build<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>plugins<span class="token punctuation">&gt;</span></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> java编译插件 <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>maven<span class="token punctuation">.</span>plugins<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>maven<span class="token operator">-</span>compiler<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.6</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
                <span class="token generics"><span class="token punctuation">&lt;</span>source<span class="token punctuation">&gt;</span></span><span class="token number">1.8</span><span class="token operator">&lt;</span><span class="token operator">/</span>source<span class="token operator">&gt;</span>
                <span class="token generics"><span class="token punctuation">&lt;</span>target<span class="token punctuation">&gt;</span></span><span class="token number">1.8</span><span class="token operator">&lt;</span><span class="token operator">/</span>target<span class="token operator">&gt;</span>
                <span class="token generics"><span class="token punctuation">&lt;</span>encoding<span class="token punctuation">&gt;</span></span><span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>encoding<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> scala编译插件 <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>net<span class="token punctuation">.</span>alchim31<span class="token punctuation">.</span>maven<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>scala<span class="token operator">-</span>maven<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.1</span><span class="token number">.6</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
                <span class="token generics"><span class="token punctuation">&lt;</span>scalaCompatVersion<span class="token punctuation">&gt;</span></span><span class="token number">2.11</span><span class="token operator">&lt;</span><span class="token operator">/</span>scalaCompatVersion<span class="token operator">&gt;</span>
                <span class="token generics"><span class="token punctuation">&lt;</span>scalaVersion<span class="token punctuation">&gt;</span></span><span class="token number">2.11</span><span class="token number">.12</span><span class="token operator">&lt;</span><span class="token operator">/</span>scalaVersion<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>executions<span class="token punctuation">&gt;</span></span>
                <span class="token generics"><span class="token punctuation">&lt;</span>execution<span class="token punctuation">&gt;</span></span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>id<span class="token punctuation">&gt;</span></span>compile<span class="token operator">-</span>scala<span class="token operator">&lt;</span><span class="token operator">/</span>id<span class="token operator">&gt;</span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>phase<span class="token punctuation">&gt;</span></span>compile<span class="token operator">&lt;</span><span class="token operator">/</span>phase<span class="token operator">&gt;</span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>goals<span class="token punctuation">&gt;</span></span>
                        <span class="token generics"><span class="token punctuation">&lt;</span>goal<span class="token punctuation">&gt;</span></span>add<span class="token operator">-</span>source<span class="token operator">&lt;</span><span class="token operator">/</span>goal<span class="token operator">&gt;</span>
                        <span class="token generics"><span class="token punctuation">&lt;</span>goal<span class="token punctuation">&gt;</span></span>compile<span class="token operator">&lt;</span><span class="token operator">/</span>goal<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>goals<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>execution<span class="token operator">&gt;</span>
                <span class="token generics"><span class="token punctuation">&lt;</span>execution<span class="token punctuation">&gt;</span></span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>id<span class="token punctuation">&gt;</span></span>test<span class="token operator">-</span>compile<span class="token operator">-</span>scala<span class="token operator">&lt;</span><span class="token operator">/</span>id<span class="token operator">&gt;</span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>phase<span class="token punctuation">&gt;</span></span>test<span class="token operator">-</span>compile<span class="token operator">&lt;</span><span class="token operator">/</span>phase<span class="token operator">&gt;</span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>goals<span class="token punctuation">&gt;</span></span>
                        <span class="token generics"><span class="token punctuation">&lt;</span>goal<span class="token punctuation">&gt;</span></span>add<span class="token operator">-</span>source<span class="token operator">&lt;</span><span class="token operator">/</span>goal<span class="token operator">&gt;</span>
                        <span class="token generics"><span class="token punctuation">&lt;</span>goal<span class="token punctuation">&gt;</span></span>testCompile<span class="token operator">&lt;</span><span class="token operator">/</span>goal<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>goals<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>execution<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>executions<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 打包插件 <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>maven<span class="token operator">-</span>assembly<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
                <span class="token generics"><span class="token punctuation">&lt;</span>descriptorRefs<span class="token punctuation">&gt;</span></span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>descriptorRef<span class="token punctuation">&gt;</span></span>jar<span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>dependencies<span class="token operator">&lt;</span><span class="token operator">/</span>descriptorRef<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>descriptorRefs<span class="token operator">&gt;</span>
                <span class="token generics"><span class="token punctuation">&lt;</span>archive<span class="token punctuation">&gt;</span></span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>manifest<span class="token punctuation">&gt;</span></span>
                        <span class="token generics"><span class="token punctuation">&lt;</span>mainClass<span class="token punctuation">&gt;</span></span><span class="token operator">&lt;</span><span class="token operator">/</span>mainClass<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>manifest<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>archive<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>executions<span class="token punctuation">&gt;</span></span>
                <span class="token generics"><span class="token punctuation">&lt;</span>execution<span class="token punctuation">&gt;</span></span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>id<span class="token punctuation">&gt;</span></span>make<span class="token operator">-</span>assembly<span class="token operator">&lt;</span><span class="token operator">/</span>id<span class="token operator">&gt;</span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>phase<span class="token punctuation">&gt;</span></span><span class="token keyword">package</span><span class="token operator">&lt;</span><span class="token operator">/</span>phase<span class="token operator">&gt;</span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>goals<span class="token punctuation">&gt;</span></span>
                        <span class="token generics"><span class="token punctuation">&lt;</span>goal<span class="token punctuation">&gt;</span></span>single<span class="token operator">&lt;</span><span class="token operator">/</span>goal<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>goals<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>execution<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>executions<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>plugins<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>build<span class="token operator">&gt;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div></li></ul> <h3 id="_1-8-spark任务提交的方式"><a href="#_1-8-spark任务提交的方式" class="header-anchor">#</a> 1.8 spark任务提交的方式</h3> <ul><li>standalone模式</li> <li>基于YARN的client模式</li> <li>基于YARN的cluster模式【推荐】</li></ul> <h2 id="_2-spark五大模块"><a href="#_2-spark五大模块" class="header-anchor">#</a> 2. Spark五大模块</h2> <h3 id="_2-1-spark-core"><a href="#_2-1-spark-core" class="header-anchor">#</a> 2.1 Spark Core</h3> <ul><li><p>RDD详解</p> <p>RDD(Resilient Distributed Dataset)叫做弹性分布式数据集，是 Spark 中最基本的数据抽象，代表一个不可变、可分区、里面的元素可并行计算的集合。</p></li> <li><p>RDD特点</p> <ul><li><p>弹性</p> <p>RDD数据默认情况下存放在内存中，但是在内存资源不足时，Spark也会自动将RDD数据写入磁盘。</p></li> <li><p>分布式</p> <p>RDD在抽象上来说是一种元素数据的集合，它是被分区的，每个分区分布在集群中的不同节点上，从而让RDD中的数据可以被并行操作。</p></li> <li><p>容错性</p> <p>RDD最重要的特性就是提供了容错性，可以自动从节点失败中恢复过来。</p></li></ul></li> <li><p>RDD主要属性</p> <ul><li><p>A list of partitions</p> <p>一组分片(Partition)/一个分区(Partition)列表，即数据集的基本组成单位。对于 RDD 来说，每个分片都会被一个计算任务处理，分片数决定并行度。用户可以在创建 RDD 时指定 RDD 的分片个数，如果没有指定，那么就会采用默认值。</p></li> <li><p>A function for computing each split</p> <p>一个函数会被作用在每一个分区。Spark 中 RDD 的计算是以分片为单位的，compute 函数会被作用到每个分区上。</p></li> <li><p>A list of dependencies on other RDDs</p> <p>一个 RDD 会依赖于其他多个 RDD。RDD 的每次转换都会生成一个新的 RDD，所以 RDD 之间就会形成类似于流水线一样的前后依赖关系。在部分分区数据丢失时，Spark 可以通过这个依赖关系重新计算丢失的分区数据，而不是对 RDD 的所有分区进行重新计算。(Spark 的容错机制)</p></li> <li><p>Optionally, a Partitioner for key-value RDDs (e.g. to say that the RDD is hash-partitioned)</p> <p>可选项，对于 KV 类型的 RDD 会有一个 Partitioner，即 RDD 的分区函数，默认为 HashPartitioner。</p></li> <li><p>Optionally, a list of preferred locations to compute each split on (e.g. block locations for an HDFS file)</p> <p>可选项,一个列表，存储存取每个 Partition 的优先位置(preferred location)。对于一个 HDFS 文件来说，这个列表保存的就是每个 Partition 所在的块的位置。按照&quot;移动数据不如移动计算&quot;的理念，Spark 在进行任务调度的时候，会尽可能选择那些存有数据的 worker 节点来进行任务计算。</p></li></ul></li> <li><p>RDD创建方式</p> <ul><li><p>集合创建</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>

<span class="token comment">/**
 * Scala使用集合创建RDD
 */</span>
<span class="token keyword">object</span> CreateRddByArrayScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//创建SparkContext</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>

    conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;CreateRddByArrayScala&quot;</span><span class="token punctuation">)</span> <span class="token comment">//local表示在本地执行</span>
      <span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span> <span class="token comment">//local表示在本地执行</span>

    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
    <span class="token comment">//创建集合</span>
    <span class="token keyword">val</span> arr <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token comment">//基于集合创建RDD</span>
    <span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>arr<span class="token punctuation">)</span>

    <span class="token keyword">val</span> sum <span class="token operator">=</span> rdd<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span>_ <span class="token operator">+</span> _<span class="token punctuation">)</span>

    println<span class="token punctuation">(</span>sum<span class="token punctuation">)</span>
    <span class="token comment">//停止SparkContext</span>
    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li> <li><p>本地文件和HDFS文件创建</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>

<span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>NoSourceFile<span class="token punctuation">.</span>path

<span class="token keyword">object</span> CreateRddByFileScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//创建SparkContext</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;CreateRddByFileScala&quot;</span><span class="token punctuation">)</span><span class="token comment">//设置任务名称</span>
      <span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span><span class="token comment">//local表示在本地执行</span>

    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>

<span class="token comment">//    val path = &quot;E:\\hello.txt&quot;</span>
    <span class="token comment">// 读取HDFS文件内容</span>
    <span class="token keyword">val</span> path <span class="token operator">=</span> <span class="token string">&quot;hdfs://bigdata01:9000/hello.txt&quot;</span>
    <span class="token comment">//读取文件数据，可以在textFile中指定生成的RDD的分区数量</span>
    <span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token comment">//获取每一行数据的长度，计算文件内数据的总长度</span>
    <span class="token keyword">val</span> length <span class="token operator">=</span> rdd<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span>reduce<span class="token punctuation">(</span>_<span class="token operator">+</span>_<span class="token punctuation">)</span>
    <span class="token keyword">val</span> wordCount <span class="token operator">=</span> rdd<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_<span class="token operator">+</span>_<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token string">&quot;length =&quot;</span><span class="token operator">+</span>length<span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token string">&quot;wordCount =&quot;</span><span class="token operator">+</span>wordCount<span class="token punctuation">.</span>mkString<span class="token punctuation">)</span>
    <span class="token comment">// 关闭上下文对象</span>
    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li></ul></li> <li><p>使用Scala实现wordCount</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>

<span class="token comment">/**
 * Scala wordCount案例
 */</span>
<span class="token keyword">object</span> WorldCountScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.创建SparkContext</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;WorldCountScala&quot;</span><span class="token punctuation">)</span>
      <span class="token comment">// 打包时注释</span>
     <span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
    <span class="token comment">// 2.加载数据</span>
<span class="token comment">//    val linesRDD = sc.textFile(&quot;E:\\hello.txt&quot;)</span>
    <span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token string">&quot;E:\\hello.txt&quot;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>length<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      path <span class="token operator">=</span> args<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">val</span> linesRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token comment">// 3.对数据进行切割把数据切分成一个一个单词</span>
    <span class="token keyword">val</span> worldsRDD <span class="token operator">=</span> linesRDD<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 4、迭代words,将每个word转化为(word,1)这种形式</span>
    <span class="token keyword">val</span> paireRDD <span class="token operator">=</span> worldsRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 5、根据Key(其实就是word)进行分组聚合统计</span>
    <span class="token keyword">val</span> wordCountRDD <span class="token operator">=</span> paireRDD<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_<span class="token operator">+</span>_<span class="token punctuation">)</span>
<span class="token comment">//    wordCountRDD.foreach(wordCount=&gt;println(wordCount._1+&quot;--&quot;+wordCount._2))</span>
    wordCountRDD<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
    <span class="token comment">//7、停止SparkContext</span>
    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div></li> <li><p>Spark 任务提交的几种方式</p> <ul><li><p>idea</p> <blockquote><p>注意设置master 为local,要配置 Hadoop</p></blockquote></li> <li><p>spark-submit</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata04 sparkjars<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/data/soft/sparkjars
<span class="token punctuation">[</span>root@bigdata04 sparkjars<span class="token punctuation">]</span><span class="token comment"># vi wordCountJob.sh</span>
spark-submit <span class="token punctuation">\</span>
<span class="token parameter variable">--class</span> com.imooc.scala.WordCountScala <span class="token punctuation">\</span>
<span class="token parameter variable">--master</span> <span class="token function">yarn</span> <span class="token punctuation">\</span>
--deploy-mode client <span class="token punctuation">\</span>
--executor-memory 1G <span class="token punctuation">\</span>
--num-executors <span class="token number">1</span> <span class="token punctuation">\</span>
db_spark-1.0-SNAPSHOT-jar-with-dependencies.jar <span class="token punctuation">\</span>
hdfs://bigdata01:9000/hello.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>注意：为了能够方便使用spark-submit脚本，需要在/etc/profile中配置SPARK_HOME环境变量</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/data/soft/jdk1.8
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/data/soft/hadoop-3.2.0
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FLUME_HOME</span><span class="token operator">=</span>/data/soft/apache-flume-1.9.0-bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HIVE_HOME</span><span class="token operator">=</span>/data/soft/apache-hive-3.1.2-bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SPARK_HOME</span><span class="token operator">=</span>/data/soft/spark-2.4.3-bin-hadoop2.7
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$HADOOP_HOME</span>/bin:<span class="token variable">$HADOOP_HOME</span>/bin:<span class="token variable">$FLUME_HOME</span>/bin:<span class="token variable">$HIVE_HOME</span>/bin:<span class="token variable">$SPARK_HOME</span>/bin:<span class="token environment constant">$PATH</span>
<span class="token comment"># 配置生效</span>
<span class="token punctuation">[</span>root@bigdata04 sparkjars<span class="token punctuation">]</span><span class="token comment"># source /etc/profile</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></blockquote> <blockquote><p>常见的 spark-submit参数</p> <p>--name mySparkJobName：指定任务名称
--class com.imooc.scala.xxxxx ：指定入口类
--master yarn ：指定集群地址，on yarn模式指定yarn
--deploy-mode cluster ：client代表yarn-client，cluster代表yarn-cluster
--executor-memory 1G ：executor进程的内存大小，实际工作中设置2~4G即可
--num-executors 2 ：分配多少个executor进程
--executor-cores 2 : 一个executor进程分配多少个cpu core
--driver-cores 1 ：driver进程分配多少cpu core，默认为1即可
--driver-memory 1G：driver进程的内存，如果需要使用类似于collect之类的action算子向driver端拉取数据，则这里可以设置大一些
--jars fastjson.jar,abc.jar 在这里可以设置job依赖的第三方jar包【不建议把第三方依赖jar包整体打包进saprk的job中，那样会导致任务jar包过大，并且也不方便统一管理依赖jar包的版本，这里的jar包路径可以指定本地磁盘路径，或者是hdfs路径，建议使用hdfs路径，因为spark在提交任务的时候会把本地磁盘的依赖jar包也上传到hdfs的一个临时目录中，如果在这里本来指定的就是hdfs的路径，那么spark在提交任务的时候就不会重复提交依赖的这个jar包了，这样其实可以提高任务提交的效率，并且这样可以方便统一管理第三方依赖jar包，所有人都统一使用hdfs中的共享的这些第三方jar包，这样版本就统一了，所以我们可以在hdfs中创建一个类似于commonLib的目录，统一存放第三方依赖的jar包，如果一个Spark job需要依赖多个jar包，在这里可以一次性指定多个，多个jar包之间通过逗号隔开即可】
--conf &quot;spark.default.parallelism=10&quot;：可以动态指定一些spark任务的参数，指定多个参数可以通过多个--conf来指定，或者在一个--conf后面的双引号中指定多个，多个参数之间用空格隔开即可</p></blockquote></li> <li><p>spark-sehll</p> <ul><li><p>使用local模式开启本地集群</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata04 sparkjars<span class="token punctuation">]</span><span class="token comment"># spark-shell</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>on yarn模式</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata04 sparkjars<span class="token punctuation">]</span><span class="token comment"># spark-shell --master yarn --deploy-mode client</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>standalong集群</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>spark-shell <span class="token parameter variable">--master</span> spark://ip:port
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>查看帮助信息</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@bigdata04 sparkjars<span class="token punctuation">]</span><span class="token comment"># spark-shell -h</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li></ul></li> <li><p>RDD算子大全</p> <ul><li><p>Transformation</p> <ul><li><p>概念</p> <p>Transformation可以翻译为转换，表示是针对RDD中数据的转换操作，主要会针对已有的RDD创建一个新的RDD：常见的有map、flatMap、filter等。</p></li> <li><p>特性</p> <p>其中Transformation算子有一个特性：lazy
lazy特性在这里指的是，如果一个spark任务中只定义了transformation算子，那么即使你执行这个任务，任务中的算子也不会执行。也就是说，transformation是不会触发spark任务的执行，它们只是记录了对RDD所做的操作，不会执行。只有当transformation之后，接着执行了一个action操作，那么所有的transformation才会执行。Spark通过lazy这种特性，来进行底层的spark任务执行的优化，避免产生过多中间结果。</p></li> <li><p>常见Transformation算子</p> <table><thead><tr><th style="text-align:center;">转换算子</th> <th style="text-align:center;">含义</th></tr></thead> <tbody><tr><td style="text-align:center;"><strong>map</strong>(func)</td> <td style="text-align:center;">返回一个新的 RDD，该 RDD 由每一个输入元素经过 func 函数转换后组成</td></tr> <tr><td style="text-align:center;"><strong>filter</strong>(func)</td> <td style="text-align:center;">返回一个新的 RDD，该 RDD 由经过 func 函数计算后返回值为 true 的输入元素组成</td></tr> <tr><td style="text-align:center;"><strong>flatMap</strong>(func)</td> <td style="text-align:center;">类似于 map，但是每一个输入元素可以被映射为 0 或多个输出元素(所以 func 应该返回一个序列，而不是单一元素)</td></tr> <tr><td style="text-align:center;"><strong>mapPartitions</strong>(func)</td> <td style="text-align:center;">类似于 map，但独立地在 RDD 的每一个分片上运行，因此在类型为 T 的 RDD 上运行时，func 的函数类型必须是 Iterator[T] =&gt; Iterator[U]</td></tr> <tr><td style="text-align:center;"><strong>mapPartitionsWithIndex</strong>(func)</td> <td style="text-align:center;">类似于 mapPartitions，但 func 带有一个整数参数表示分片的索引值，因此在类型为 T 的 RDD 上运行时，func 的函数类型必须是(Int, Interator[T]) =&gt; Iterator[U]</td></tr> <tr><td style="text-align:center;">sample(withReplacement, fraction, seed)</td> <td style="text-align:center;">根据 fraction 指定的比例对数据进行采样，可以选择是否使用随机数进行替换，seed 用于指定随机数生成器种子</td></tr> <tr><td style="text-align:center;"><strong>union</strong>(otherDataset)</td> <td style="text-align:center;">对源 RDD 和参数 RDD 求并集后返回一个新的 RDD</td></tr> <tr><td style="text-align:center;">intersection(otherDataset)</td> <td style="text-align:center;">对源 RDD 和参数 RDD 求交集后返回一个新的 RDD</td></tr> <tr><td style="text-align:center;"><strong>distinct</strong>([numTasks]))</td> <td style="text-align:center;">对源 RDD 进行去重后返回一个新的 RDD</td></tr> <tr><td style="text-align:center;"><strong>groupByKey</strong>([numTasks])</td> <td style="text-align:center;">在一个(K,V)的 RDD 上调用，返回一个(K, Iterator[V])的 RDD</td></tr> <tr><td style="text-align:center;"><strong>reduceByKey</strong>(func, [numTasks])</td> <td style="text-align:center;">在一个(K,V)的 RDD 上调用，返回一个(K,V)的 RDD，使用指定的 reduce 函数，将相同 key 的值聚合到一起，与 groupByKey 类似，reduce 任务的个数可以通过第二个可选的参数来设置</td></tr> <tr><td style="text-align:center;">aggregateByKey(zeroValue)(seqOp, combOp, [numTasks])</td> <td style="text-align:center;">对 PairRDD 中相同的 Key 值进行聚合操作，在聚合过程中同样使用了一个中立的初始值。和 aggregate 函数类似，aggregateByKey 返回值的类型不需要和 RDD 中 value 的类型一致</td></tr> <tr><td style="text-align:center;"><strong>sortByKey</strong>([ascending], [numTasks])</td> <td style="text-align:center;">在一个(K,V)的 RDD 上调用，K 必须实现 Ordered 接口，返回一个按照 key 进行排序的(K,V)的 RDD</td></tr> <tr><td style="text-align:center;">sortBy(func,[ascending], [numTasks])</td> <td style="text-align:center;">与 sortByKey 类似，但是更灵活</td></tr> <tr><td style="text-align:center;"><strong>join</strong>(otherDataset, [numTasks])</td> <td style="text-align:center;">在类型为(K,V)和(K,W)的 RDD 上调用，返回一个相同 key 对应的所有元素对在一起的(K,(V,W))的 RDD</td></tr> <tr><td style="text-align:center;">cogroup(otherDataset, [numTasks])</td> <td style="text-align:center;">在类型为(K,V)和(K,W)的 RDD 上调用，返回一个(K,(Iterable,Iterable))类型的 RDD</td></tr> <tr><td style="text-align:center;">cartesian(otherDataset)</td> <td style="text-align:center;">笛卡尔积</td></tr> <tr><td style="text-align:center;">pipe(command, [envVars])</td> <td style="text-align:center;">对 rdd 进行管道操作</td></tr> <tr><td style="text-align:center;"><strong>coalesce</strong>(numPartitions)</td> <td style="text-align:center;">减少 RDD 的分区数到指定值。在过滤大量数据之后，可以执行此操作</td></tr> <tr><td style="text-align:center;"><strong>repartition</strong>(numPartitions)</td> <td style="text-align:center;">重新给 RDD 分区</td></tr></tbody></table></li> <li><p>实例代码</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>

<span class="token comment">/**
 * spark 转换操作 transformation
 * 转换阶段常见算子
 * map
 * filter
 * flatMap
 * groupByKey
 * reduceByKey
 * sortByKey
 * join
 * distinct
 */</span>
<span class="token keyword">object</span> TransformationOpScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> getSparkContext<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mapOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    filterOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    flatMapOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    groupByKeyOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    groupByKeyOp1<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    reduceByKeyOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    sortByKeyOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    sortByOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    joinOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    distinctOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * distinct
   *
   * @param sc
   */</span>
  <span class="token keyword">def</span> distinctOp<span class="token punctuation">(</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;US&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;王五&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * join(默认innerJoin）
   *
   * @param sc
   */</span>
  <span class="token keyword">def</span> joinOp<span class="token punctuation">(</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;JP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> dataRDD1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;王五&quot;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> dataResult <span class="token operator">=</span> dataRDD<span class="token punctuation">.</span>join<span class="token punctuation">(</span>dataRDD1<span class="token punctuation">)</span>
    <span class="token comment">//println(dataResult.collect().mkString) // (张三,(CN,10))(李四,(JP,12))</span>
    <span class="token comment">//     dataResult.foreach(println(_)) // (张三,(CN,10)) (李四,(JP,12))</span>

    dataResult<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>tup <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
      println<span class="token punctuation">(</span><span class="token string">&quot;姓名 :&quot;</span> <span class="token operator">+</span> tup<span class="token punctuation">.</span>_1 <span class="token operator">+</span> <span class="token string">&quot; 地区 :&quot;</span> <span class="token operator">+</span> tup<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>_1 <span class="token operator">+</span> <span class="token string">&quot;年龄 :&quot;</span> <span class="token operator">+</span> tup<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>_2<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * sortBy
   * 灵活进行排序 false 降序
   *
   * @param sc
   */</span>
  <span class="token keyword">def</span> sortByOp<span class="token punctuation">(</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;王五&quot;</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dataRDD<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>tup <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
      println<span class="token punctuation">(</span>tup<span class="token punctuation">.</span>_1 <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> tup<span class="token punctuation">.</span>_2<span class="token punctuation">)</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * sortByKey
   * 对收入进行排序
   *
   * @param sc
   */</span>
  <span class="token keyword">def</span> sortByKeyOp<span class="token punctuation">(</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;王五&quot;</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// false 降序</span>
    dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tuple <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> tuple<span class="token punctuation">.</span>_1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sortByKey<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>tup <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
      println<span class="token punctuation">(</span>tup<span class="token punctuation">.</span>_2 <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> tup<span class="token punctuation">.</span>_1<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 统计每个地区的人数
   * reduceByKey
   *
   * @param sc
   */</span>
  <span class="token keyword">def</span> reduceByKeyOp<span class="token punctuation">(</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">150001</span><span class="token punctuation">,</span> <span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;male&quot;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150002</span><span class="token punctuation">,</span> <span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;female&quot;</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150003</span><span class="token punctuation">,</span> <span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;male&quot;</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150004</span><span class="token punctuation">,</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;male&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150005</span><span class="token punctuation">,</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;male&quot;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150006</span><span class="token punctuation">,</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;female&quot;</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150007</span><span class="token punctuation">,</span> <span class="token string">&quot;JP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;male&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// reduceByKey(_+_) 等效于 reduceByKey((x:Int,y:Int)=&gt;x+y)</span>
    dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tuple <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_ <span class="token operator">+</span> _<span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>tup <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
      println<span class="token punctuation">(</span>tup<span class="token punctuation">.</span>_1 <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> tup<span class="token punctuation">.</span>_2<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 统计同地区同性别
   * tuple 数据超过两列
   *
   * @param sc
   */</span>
  <span class="token keyword">def</span> groupByKeyOp1<span class="token punctuation">(</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">150001</span><span class="token punctuation">,</span> <span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;male&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150002</span><span class="token punctuation">,</span> <span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;female&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150003</span><span class="token punctuation">,</span> <span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;male&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150004</span><span class="token punctuation">,</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;male&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150005</span><span class="token punctuation">,</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;male&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150006</span><span class="token punctuation">,</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;female&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150007</span><span class="token punctuation">,</span> <span class="token string">&quot;JP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;male&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tuple <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> tuple<span class="token punctuation">.</span>_3<span class="token punctuation">)</span><span class="token punctuation">,</span> tuple<span class="token punctuation">.</span>_1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groupByKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>tup <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取地区</span>
      <span class="token keyword">val</span> area <span class="token operator">=</span> tup<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>_1
      <span class="token keyword">val</span> sex <span class="token operator">=</span> tup<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>_2
      print<span class="token punctuation">(</span>area <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> sex <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span>
      <span class="token comment">// 获取相同大区和相同性别 的所有用户id</span>
      <span class="token keyword">val</span> it <span class="token operator">=</span> tup<span class="token punctuation">.</span>_2
      <span class="token keyword">for</span> <span class="token punctuation">(</span>uid <span class="token keyword">&lt;-</span> it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        print<span class="token punctuation">(</span>uid <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      println<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * groupByKey 对地区进行分组
   * tuple 中的数据不超过两列
   *
   * @param sc
   */</span>
  <span class="token keyword">def</span> groupByKeyOp<span class="token punctuation">(</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">150001</span><span class="token punctuation">,</span> <span class="token string">&quot;US&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150002</span><span class="token punctuation">,</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;150003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;JP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150004</span><span class="token punctuation">,</span> <span class="token string">&quot;US&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150005</span><span class="token punctuation">,</span> <span class="token string">&quot;US&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tuple <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> tuple<span class="token punctuation">.</span>_1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groupByKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>tup <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取地区</span>
      <span class="token keyword">val</span> area <span class="token operator">=</span> tup<span class="token punctuation">.</span>_1
      print<span class="token punctuation">(</span>area <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span>
      <span class="token comment">//获取同一个大区对应的所有用户id</span>
      <span class="token keyword">val</span> it <span class="token operator">=</span> tup<span class="token punctuation">.</span>_2
      <span class="token keyword">for</span> <span class="token punctuation">(</span>uid <span class="token keyword">&lt;-</span> it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        print<span class="token punctuation">(</span>uid <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      println<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * flatMap 将行进行拆分
   *
   * @param sc
   */</span>
  <span class="token keyword">def</span> flatMapOp<span class="token punctuation">(</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello scala&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello spark&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dataRDD<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * filter 对集合进行过滤
   *
   * @param sc
   */</span>
  <span class="token keyword">def</span> filterOp<span class="token punctuation">(</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span>dataRDD<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_ <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * map 对集合每一个元素操作
   *
   * @param sc
   */</span>
  <span class="token keyword">def</span> mapOp<span class="token punctuation">(</span>sc<span class="token operator">:</span> SparkContext<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span>dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_ <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 获取SparkContext
   *
   * @return
   */</span>
  <span class="token keyword">private</span> <span class="token keyword">def</span> getSparkContext<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;TransformationOpScala&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br></div></div></li></ul></li> <li><p>Action</p> <ul><li><p>概念</p> <p>Action可以翻译为执行，表示是触发任务执行的操作，主要对RDD进行最后的操作，比如<a href="https://so.csdn.net/so/search?q=%E9%81%8D%E5%8E%86&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">遍历<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、reduce、保存到文件等，并且还可以把结果返回给Driver程序。</p></li> <li><p>特性</p> <p>执行Action操作才会触发一个Spark 任务的运行，从而触发这个Action之前所有的Transformation的执行</p></li> <li><p>常见Action算子</p> <table><thead><tr><th>count</th> <th>个数</th></tr></thead> <tbody><tr><td>mean</td> <td>均值</td></tr> <tr><td>sum</td> <td>求和</td></tr> <tr><td>max</td> <td>最大值</td></tr> <tr><td>min</td> <td>最小值</td></tr> <tr><td>variance</td> <td>方差</td></tr> <tr><td>sampleVariance</td> <td>从采样中计算方差</td></tr> <tr><td>stdev</td> <td>标准差:衡量数据的离散程度</td></tr> <tr><td>sampleStdev</td> <td>采样的标准差</td></tr> <tr><td>stats</td> <td>查看统计结果</td></tr></tbody></table></li> <li><p>实例代码</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>
<span class="token comment">/**
 * spark 执行阶段 Action
 * 执行阶段常见算子
 * reduce 聚合计算
 * collect  返回集合数组
 * count 获取元素总数
 * take(n) 返回前n个数
 * saveAsTextFile 保存文件
 * countByKey 统计相同的Key 出现多少次
 * foreach 遍历
 */</span>
<span class="token keyword">object</span> ActionOpScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取上下文对象</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> getSparkContext<span class="token punctuation">(</span><span class="token punctuation">)</span>
    reduceOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    collectOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    countOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    takeOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    saveAsTextFileOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    saveAsTextFileOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    countByKeyOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    foreachOp<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
    <span class="token comment">// 关闭上下文对象</span>
    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 迭代遍历元素
   * @param sc
   */</span>
  <span class="token keyword">def</span> foreachOp<span class="token punctuation">(</span>sc<span class="token operator">:</span>SparkContext<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dataRDD<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * countByKey()
   * 统计相同的Key 出现了多少次
   * @param sc
   */</span>
  <span class="token keyword">def</span> countByKeyOp<span class="token punctuation">(</span>sc<span class="token operator">:</span>SparkContext<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;UK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;CN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;王五&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;UK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tuple<span class="token keyword">=&gt;</span><span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_2<span class="token punctuation">,</span>tuple<span class="token punctuation">.</span>_1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>countByKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * saveAsTextFile
   * 保存文件到指定目录
   * @param sc
   */</span>
  <span class="token keyword">def</span> saveAsTextFileOp<span class="token punctuation">(</span>sc<span class="token operator">:</span>SparkContext<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 保存目录必须不存在</span>
<span class="token comment">//    dataRDD.saveAsTextFile(&quot;hdfs://bigdata01:9000/out_20221019&quot;)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * take(n)
   * 获取前n个元素
   * @param sc
   */</span>
  <span class="token keyword">def</span> takeOp<span class="token punctuation">(</span>sc<span class="token operator">:</span>SparkContext<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dataRDD<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * count
   * 获取元素总数
   * @param sc
   */</span>
  <span class="token keyword">def</span> countOp<span class="token punctuation">(</span>sc<span class="token operator">:</span>SparkContext<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> length <span class="token operator">=</span> dataRDD<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token string">&quot;length :&quot;</span><span class="token operator">+</span>length<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * collect
   * 返回数组
   * @param sc
   */</span>
  <span class="token keyword">def</span> collectOp<span class="token punctuation">(</span>sc<span class="token operator">:</span>SparkContext<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> data <span class="token operator">=</span> dataRDD<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>elem <span class="token keyword">&lt;-</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      println<span class="token punctuation">(</span>elem<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * reduce
   * 对每一个元素进行计算
   * @param sc
   */</span>
  <span class="token keyword">def</span> reduceOp<span class="token punctuation">(</span>sc<span class="token operator">:</span>SparkContext<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sum <span class="token operator">=</span> dataRDD<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span>_<span class="token operator">+</span>_<span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token string">&quot;sum =&quot;</span><span class="token operator">+</span>sum<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * 获取SparkContext
   *
   * @return
   */</span>
  <span class="token keyword">private</span> <span class="token keyword">def</span> getSparkContext<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;ActionOpScala&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br></div></div></li></ul></li> <li><p>TOP N 案例</p> <ul><li><p>数据准备</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>video_info.log

<span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251001&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940001&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;21&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251002&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940002&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">201</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;331&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251003&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940003&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">221</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;321&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251004&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940004&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">401</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;311&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251005&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940005&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;131&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251006&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940006&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;3431&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251007&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940007&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;131&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251008&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940008&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;131&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251009&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940009&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;231&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251010&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940010&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">342</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;431&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251011&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940011&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">223</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;331&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251012&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940012&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">554</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;312&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251013&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940013&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">334</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;321&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251014&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940014&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">653</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;311&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251015&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940015&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">322</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;231&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251001&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940016&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">432</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;531&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251005&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940017&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">322</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;231&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251008&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940018&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">564</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;131&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251010&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940019&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">324</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;231&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;8407173251015&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940020&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;area&quot;</span><span class="token operator">:</span><span class="token string">&quot;US&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;start_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344544&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;end_time&quot;</span><span class="token operator">:</span><span class="token string">&quot;1494344570&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;watch_num&quot;</span><span class="token operator">:</span><span class="token number">532</span><span class="token punctuation">,</span><span class="token property">&quot;share_num&quot;</span><span class="token operator">:</span><span class="token string">&quot;331&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;video_info&quot;</span><span class="token punctuation">}</span>gift_record.log

  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141001&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940001&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141002&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940001&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141003&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940002&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141004&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940002&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;40&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141005&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940003&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;50&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141006&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940003&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141007&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940004&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141008&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940004&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141009&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940005&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;40&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141010&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940005&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;50&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141011&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940006&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141012&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940006&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141013&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940007&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141014&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940007&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;40&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141015&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940008&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;50&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141016&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940008&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141017&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940009&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141018&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940009&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141019&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940010&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;40&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141020&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940010&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;50&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141021&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940011&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141022&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940011&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141023&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940012&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141024&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940012&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;40&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141025&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940013&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;50&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141026&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940013&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141027&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940014&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141028&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940014&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141029&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940015&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;40&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141030&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940015&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;50&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141031&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940016&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141032&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940016&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141033&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940017&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141034&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940017&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;40&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141035&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940018&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;50&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141036&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940018&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141037&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940019&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141038&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940019&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141039&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940020&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;40&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span><span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;7201232141040&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vid&quot;</span><span class="token operator">:</span><span class="token string">&quot;14943445328940020&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;good_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;223&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;gold&quot;</span><span class="token operator">:</span><span class="token string">&quot;50&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1494344574</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;gift_record&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div></li> <li><p>代码</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span>JSON
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>
<span class="token comment">/**
 * 统计每个区 TopN人员信息
 */</span>
<span class="token keyword">object</span> TopScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;TopScala&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>

    <span class="token keyword">val</span> videRecord <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;E:\\video_info.log&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> giftRecord <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;E:\\gift_record.log&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> videoRDD <span class="token operator">=</span> videRecord<span class="token punctuation">.</span>map<span class="token punctuation">(</span>line<span class="token keyword">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">val</span> jsonObject <span class="token operator">=</span> JSON<span class="token punctuation">.</span>parseObject<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
      <span class="token comment">// 主播id</span>
      <span class="token keyword">val</span> uid <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span>getString<span class="token punctuation">(</span><span class="token string">&quot;uid&quot;</span><span class="token punctuation">)</span>
      <span class="token comment">// 直播间 id</span>
      <span class="token keyword">val</span> vid <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span>getString<span class="token punctuation">(</span><span class="token string">&quot;vid&quot;</span><span class="token punctuation">)</span>
      <span class="token comment">// 地区</span>
      <span class="token keyword">val</span> area <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span>getString<span class="token punctuation">(</span><span class="token string">&quot;area&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>vid<span class="token punctuation">,</span><span class="token punctuation">(</span>uid<span class="token punctuation">,</span>area<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> giftRDD <span class="token operator">=</span> giftRecord<span class="token punctuation">.</span>map<span class="token punctuation">(</span>line<span class="token keyword">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">val</span> jsonObject <span class="token operator">=</span> JSON<span class="token punctuation">.</span>parseObject<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
      <span class="token comment">// vid 直播间id</span>
      <span class="token keyword">val</span> vid <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span>getString<span class="token punctuation">(</span><span class="token string">&quot;vid&quot;</span><span class="token punctuation">)</span>
      <span class="token comment">// 直播间收入</span>
      <span class="token keyword">val</span> gold <span class="token operator">=</span> Integer<span class="token punctuation">.</span>parseInt<span class="token punctuation">(</span>jsonObject<span class="token punctuation">.</span>getString<span class="token punctuation">(</span><span class="token string">&quot;gold&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>vid<span class="token punctuation">,</span>gold<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// (14943445328940001,(8407173251001,US))</span>
<span class="token comment">//    videoRDD.foreach(println(_))</span>
    <span class="token comment">// (14943445328940001,10)</span>
    <span class="token comment">// 统计每一个直播间收入</span>
    <span class="token keyword">val</span> giftReduceRDD <span class="token operator">=</span> giftRDD<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_<span class="token operator">+</span>_<span class="token punctuation">)</span>
    <span class="token comment">// (14943445328940019,((8407173251010,ID),2030))</span>
    <span class="token comment">// 存在一个用户多个直播间 uid area 分组求和</span>
    <span class="token keyword">val</span> groupRDD <span class="token operator">=</span> videoRDD<span class="token punctuation">.</span>join<span class="token punctuation">(</span>giftReduceRDD<span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>tuple<span class="token keyword">=&gt;</span><span class="token punctuation">{</span>
      <span class="token comment">// 获取 uid</span>
      <span class="token keyword">val</span> uid <span class="token operator">=</span> tuple<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>_1
      <span class="token comment">// 获取area</span>
      <span class="token keyword">val</span> area <span class="token operator">=</span> tuple<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>_2
      <span class="token comment">// 获取 goldSum</span>
      <span class="token keyword">val</span> goldSum <span class="token operator">=</span> tuple<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>_2
      <span class="token punctuation">(</span><span class="token punctuation">(</span>uid<span class="token punctuation">,</span>area<span class="token punctuation">)</span><span class="token punctuation">,</span>goldSum<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// ((8407173251015,US),180) ((uid,area),goldSum)</span>
    <span class="token keyword">val</span> groupRDD_Result <span class="token operator">=</span> groupRDD<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_<span class="token operator">+</span>_<span class="token punctuation">)</span>
    <span class="token keyword">val</span> groupRDD_Result1 <span class="token operator">=</span> groupRDD_Result<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tuple<span class="token keyword">=&gt;</span><span class="token punctuation">{</span>
      <span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>_2<span class="token punctuation">,</span><span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>_1<span class="token punctuation">,</span>tuple<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groupByKey<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// (CN,CompactBuffer((8407173251008,120), (8407173251003,60), (8407173251014,50), (8407173251006,30), (8407173251011,30)))</span>
    groupRDD_Result1<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> result <span class="token operator">=</span> groupRDD_Result1<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tuple<span class="token keyword">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">val</span> area <span class="token operator">=</span> tuple<span class="token punctuation">.</span>_1
      <span class="token keyword">val</span> top3 <span class="token operator">=</span> tuple<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>toList<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">.</span>reverse<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>tuple<span class="token keyword">=&gt;</span><span class="token punctuation">{</span>
        tuple<span class="token punctuation">.</span>_1<span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>tuple<span class="token punctuation">.</span>_2
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>area<span class="token punctuation">,</span>top3<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    result<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>tuple<span class="token keyword">=&gt;</span><span class="token punctuation">{</span>
      println<span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_1<span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token operator">+</span>tuple<span class="token punctuation">.</span>_2<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div></li></ul></li></ul></li> <li><p>RDD的持久化(缓存)</p> <ul><li><p>持久化概念</p> <p>在实际开发中某些 RDD 的计算或转换可能会比较耗费时间，如果这些 RDD 后续还会频繁的被使用到，那么可以将这些 RDD 进行持久化/缓存，这样下次再使用到的时候就不用再重新计算了，提高了程序运行的效率。</p> <blockquote><p>RDD 通过 persist 或 cache 方法可以将前面的计算结果缓存，但是并不是这两个方法被调用时立即缓存，而是触发后面的 action 时，该 RDD 将会被缓存在计算节点的内存中，并供后面重用。</p></blockquote></li> <li><p>cache 和 persist区别</p> <p>cache()是persist()的一种简化方式，cache()的底层就是调用的persist()的无参版本，也就是调用persist(MEMORY_ONLY)，将数据持久化到内存中。如果需要从内存中清除缓存，那么可以使用unpersist()方法。</p></li> <li><p>持久化策略</p> <table><thead><tr><th style="text-align:center;">持久化级别</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;"><strong>MORY_ONLY(默认)</strong></td> <td style="text-align:center;">将 RDD 以非序列化的 Java 对象存储在 JVM 中。如果没有足够的内存存储 RDD，则某些分区将不会被缓存，每次需要时都会重新计算。这是默认级别</td></tr> <tr><td style="text-align:center;"><strong>MORY_AND_DISK(开发中可以使用这个)</strong></td> <td style="text-align:center;">将 RDD 以非序列化的 Java 对象存储在 JVM 中。如果数据在内存中放不下，则溢写到磁盘上．需要时则会从磁盘上读取</td></tr> <tr><td style="text-align:center;">MEMORY_ONLY_SER (Java and Scala)</td> <td style="text-align:center;">将 RDD 以序列化的 Java 对象(每个分区一个字节数组)的方式存储．这通常比非序列化对象(deserialized objects)更具空间效率，特别是在使用快速序列化的情况下，但是这种方式读取数据会消耗更多的 CPU</td></tr> <tr><td style="text-align:center;">MEMORY_AND_DISK_SER (Java and Scala)</td> <td style="text-align:center;">与 MEMORY_ONLY_SER 类似，但如果数据在内存中放不下，则溢写到磁盘上，而不是每次需要重新计算它们</td></tr> <tr><td style="text-align:center;">DISK_ONLY</td> <td style="text-align:center;">将 RDD 分区存储在磁盘上</td></tr> <tr><td style="text-align:center;">MEMORY_ONLY_2, MEMORY_AND_DISK_2 等</td> <td style="text-align:center;">与上面的储存级别相同，只不过将持久化数据存为两份，备份每个分区存储在两个集群节点上</td></tr> <tr><td style="text-align:center;">OFF_HEAP(实验中)</td> <td style="text-align:center;">与 MEMORY_ONLY_SER 类似，但将数据存储在堆外内存中。(即不是直接存储在 JVM 内存中)</td></tr></tbody></table></li> <li><p>持久化代码</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>

<span class="token comment">/**
 * RDD持久化
 * 持久化策略
 */</span>
<span class="token keyword">object</span> PersistRddScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;PersistRddScala&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
    <span class="token comment">// cache()是persist()的一种简化方式，cache()的底层就是调用的persist()的无参版本，也就是调用persist(MEMORY_ONLY)，将数据持久化到内存中。</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;E:\\test_1000W.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cache<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> start_time <span class="token operator">=</span> System<span class="token punctuation">.</span>currentTimeMillis<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> count <span class="token operator">=</span> dataRDD<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span>count<span class="token punctuation">)</span>
    <span class="token keyword">var</span> end_time <span class="token operator">=</span> System<span class="token punctuation">.</span>currentTimeMillis<span class="token punctuation">(</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token string">&quot;第一次耗时：&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>end_time<span class="token operator">-</span>start_time<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//5205</span>

    start_time <span class="token operator">=</span> System<span class="token punctuation">.</span>currentTimeMillis<span class="token punctuation">(</span><span class="token punctuation">)</span>
    count <span class="token operator">=</span> dataRDD<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span>count<span class="token punctuation">)</span>
    end_time <span class="token operator">=</span> System<span class="token punctuation">.</span>currentTimeMillis<span class="token punctuation">(</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token string">&quot;第二次耗时：&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>end_time<span class="token operator">-</span>start_time<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//99</span>
    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></li> <li><p>持久化总结</p> <ol><li>RDD 持久化/缓存的目的是为了提高后续操作的速度。</li> <li>缓存的级别有很多，默认只存在内存中,开发中使用 memory_and_disk。</li> <li>只有执行 action 操作的时候才会真正将 RDD 数据进行持久化/缓存。</li> <li>实际开发中如果某一个 RDD 后续会被频繁的使用，可以将该 RDD 进行持久化/缓存。</li></ol></li></ul></li> <li><p>累加器和广播变量</p> <ul><li><p>Accumulator(累加变量)</p> <ul><li><p>概念</p> <p>Spark提供的Accumulator，主要用于多个节点对一个变量进行共享性的操作。正常情况下在Spark的任务中，由于一个算子可能会产生多个task并行执行，所以在这个算子内部执行的聚合计算都是局部的，想要实现多个task进行全局聚合计算，此时需要使用到Accumulator这个共享的累加变量。</p> <blockquote><p>注意：Accumulator只提供了累加的功能。在task只能对Accumulator进行累加操作，不能读取它的值。只有在Driver进程中才可以读取Accumulator的值</p></blockquote></li> <li><p>使用场景</p> <p>不同节点之间需要对同一个变量进行累加操作(如计数和求和),可以考虑使用累加变量</p></li> <li><p>代码</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>

<span class="token comment">/**
 * 共享变量 之累加变量
 * 累加变量作用? TODO
 * 累加变量使用场景？ TODO
 */</span>
<span class="token keyword">object</span> AccumulatorOpScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;AccumulatorOpScala&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//这种写法是错误的，因为foreach代码是在worker节点上执行的</span>
    <span class="token comment">// var total = 0和println(&quot;total:&quot;+total)是在Driver进程中执行的</span>
    <span class="token comment">//所以无法实现累加操作</span>
    <span class="token comment">//并且foreach算子可能会在多个task中执行，这样foreach内部实现的累加也不是最终全局累加的结果</span>
    <span class="token keyword">var</span> total <span class="token operator">=</span> <span class="token number">0</span>
    dataRDD<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>num<span class="token keyword">=&gt;</span>total <span class="token operator">+=</span> num<span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token string">&quot;total:&quot;</span><span class="token operator">+</span>total<span class="token punctuation">)</span> <span class="token comment">// total:0</span>

    <span class="token comment">//1：定义累加变量</span>
    <span class="token keyword">val</span> sumAccumulator <span class="token operator">=</span> sc<span class="token punctuation">.</span>longAccumulator

    <span class="token comment">//2：使用累加变量</span>
    dataRDD<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>num<span class="token keyword">=&gt;</span>sumAccumulator<span class="token punctuation">.</span>add<span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 15</span>

    <span class="token comment">//注意：只能在Driver进程中获取累加变量的结果</span>
    println<span class="token punctuation">(</span>sumAccumulator<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
   sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>


  <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div></li></ul></li> <li><p>Broadcast Variable(广播变量)</p> <ul><li><p>概念</p> <p>Broadcast Variable会将使用到的变量，仅仅为每个节点拷贝一份，而不会为每个task都拷贝一份副本，因此其最大的作用，就是减少变量到各个节点的网络传输消耗，以及在各个节点上的内存消耗,通过调用SparkContext的broadcast()方法，针对某个变量创建广播变量。</p> <blockquote><p>注意：广播变量，是只读的，然后在算子函数内，使用到广播变量时，每个节点只会拷贝一份副本。可以使用广播变量的value()方法获取值。</p></blockquote></li> <li><p>使用场景</p> <p>广播变量用来把变量在所有节点的内存之间进行共享，在每个机器上缓存一个只读的变量，而不是为机器上的每个任务都生成一个副本。</p> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221026142537567.png" alt="image-20221026142537567"></p></li> <li><p>代码</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>

<span class="token comment">/**
 * 共享变量之广播变量
 * 使用广播变量
 * 广播变量作用 TODO
 * 广播变量使用场景 TODO
 */</span>
<span class="token keyword">object</span> BroadcastOpScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;BroadcastOpScala&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> variable <span class="token operator">=</span> <span class="token number">2</span>
        dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token operator">*</span>variable<span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 创建广播变量</span>
    <span class="token keyword">val</span> broadVariable <span class="token operator">=</span> sc<span class="token punctuation">.</span>broadcast<span class="token punctuation">(</span>variable<span class="token punctuation">)</span>
    <span class="token comment">// 获取广播变量的值</span>
    dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_ <span class="token operator">*</span> broadVariable<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li></ul></li></ul></li></ul> <h3 id="_2-2-spark-sql"><a href="#_2-2-spark-sql" class="header-anchor">#</a> 2.2 Spark SQL</h3> <ul><li><p>前置知识</p> <ul><li><p>常见数据结构</p> <table><thead><tr><th style="text-align:center;">定义</th> <th style="text-align:center;">特点</th> <th style="text-align:center;">举例</th> <th></th></tr></thead> <tbody><tr><td style="text-align:center;">结构化数据</td> <td style="text-align:center;">有固定的 Schema</td> <td style="text-align:center;">有预定义的 Schema</td> <td>关系型数据库的表</td></tr> <tr><td style="text-align:center;">半结构化数据</td> <td style="text-align:center;">没有固定的 Schema，但是有结构</td> <td style="text-align:center;">没有固定的 Schema，有结构信息，数据一般是自描述的</td> <td>指一些有结构的文件格式，例如 JSON</td></tr> <tr><td style="text-align:center;">非结构化数据</td> <td style="text-align:center;">没有固定 Schema，也没有结构</td> <td style="text-align:center;">没有固定 Schema，也没有结构</td> <td>指图片/音频之类的格式</td></tr></tbody></table> <blockquote><p>这里的schema指的是约束,比如字段名字，字段类型</p></blockquote></li> <li><p>Spark处理什么类型的数据</p> <p>SparkCore 中的RDD 主要用于处理非结构化数据 、半结构化数据、结构化；SparkSQL 主要用于处理结构化数据(较为规范的半结构化数据也可以处理)。</p></li></ul></li> <li><p>DataFrame</p> <ul><li><p>DataFrame的创建方式</p> <ul><li><p>RDD创建(文件创建)</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>SparkSession

<span class="token comment">/**
 * 使用文件创建 DataFrame
 * RDD 转DataFrame
 */</span>
<span class="token keyword">object</span> DataFrameCreatedByFile <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 创建SparkSession对象，里面包含SparkContext和SqlContext</span>
    <span class="token keyword">val</span> sparkSession <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">&quot;DataFrameCreatedByFile&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>config<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 获取SparkContext</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>sparkContext
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;E:\\person.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//基于反射直接将包含Person对象的dataRDD转换为DataFrame</span>
    <span class="token comment">//需要导入隐式转换</span>

    <span class="token keyword">import</span> <span class="token namespace">sparkSession<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_

    <span class="token comment">// 将RDD转为 DataFrame </span>
    <span class="token keyword">val</span> personDF <span class="token operator">=</span> dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tup <span class="token keyword">=&gt;</span> Person<span class="token punctuation">(</span>tup<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toInt<span class="token punctuation">,</span> tup<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toString<span class="token punctuation">,</span> tup<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toInt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toDF<span class="token punctuation">(</span><span class="token punctuation">)</span>

    personDF<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>


    sparkSession<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


<span class="token comment">// 定义case class</span>
<span class="token keyword">case</span> <span class="token keyword">class</span> Person<span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div></li> <li><p>JSON创建</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span>SparkConf
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>SparkSession

<span class="token keyword">object</span> DataFrameCreateByJson <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;DataFrameCreateByJson&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sparkSession <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>config<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> stuDF <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>read<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token string">&quot;E:\\student.json&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 也可以通过 sparkSession 直接读取文件，但是没有完整约束 ，建议通过RDD读取 文件 转DataFrame </span>
    <span class="token keyword">val</span> personDF <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>read<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;E:\\person.txt&quot;</span><span class="token punctuation">)</span>
    personDF<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    stuDF<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sparkSession<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li></ul></li> <li><p>DataFrame的常用方法</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span>SparkConf
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>SparkSession

<span class="token comment">/**
 * DataFrame的常用操作
 * show()
 * filter
 * where 底层调用的是 filter
 * count
 * groupBy
 */</span>
<span class="token keyword">object</span> DataFrameOpScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 创建SparkSession对象，里面包含SparkContext和SqlContext</span>
    <span class="token keyword">val</span> sparkSession <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">&quot;DataFrameOpScala&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>config<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> stuDF <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>read<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token string">&quot;E:\\student.json&quot;</span><span class="token punctuation">)</span>
    stuDF<span class="token punctuation">.</span>printSchema<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// show() 默认显示所有数据，可以通过参数控制显示多条</span>
    stuDF<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token comment">// 指定字段</span>
    stuDF<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//在使用select的时候可以对数据做一些操作，需要添加隐式转换函数，否则语法报错</span>
    <span class="token keyword">import</span> <span class="token namespace">sparkSession<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_
    stuDF<span class="token punctuation">.</span>select<span class="token punctuation">(</span>$<span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>$<span class="token string">&quot;age&quot;</span><span class="token operator">+</span><span class="token number">1</span> as <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 对数据进行过滤 需要添加隐式转换函数</span>
    stuDF<span class="token punctuation">.</span>where<span class="token punctuation">(</span>$<span class="token string">&quot;age&quot;</span><span class="token operator">&gt;</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    stuDF<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>$<span class="token string">&quot;age&quot;</span><span class="token operator">&gt;</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 对数据进行分组求和</span>
    stuDF<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sparkSession<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div></li> <li><p>DataFrame的保存</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span>SparkConf
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SaveMode<span class="token punctuation">,</span> SparkSession<span class="token punctuation">}</span>

<span class="token comment">/**
 * DataFrame load 和 save的使用
 * 常见的load format 有 json parquet jdbc orc csv text
 * 常用的saveMode 有
 * SaveMode.ErrorIfExists (默认)	如果目标位置已经存在数据，那么抛出一个异常
 * SaveMode.Append					如果目标位置已经存在数据，那么将数据追加进去
 * SaveMode.Overwrite				如果目标位置已经存在数据，那么就将已经存在的数据删除，用新数据进行覆盖
 * SaveMode.Ignore					如果目标位置已经存在数据，那么就忽略，不做任何操作
 */</span>
<span class="token keyword">object</span> LoadAndSaveOpScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//创建SparkSession对象，里面包含SparkContext和SqlContext</span>
    <span class="token keyword">val</span> sparkSession <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">&quot;LoadAndSaveOpScala&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>config<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">//读取json 数据</span>
    <span class="token keyword">val</span> stuDf <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>read
      <span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">&quot;E:\\student.json&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> stuDF1 <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>read
      <span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">&quot;E:\\hellO.txt&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 保存数据</span>
    stuDF1<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>write
      <span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">&quot;csv&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>mode<span class="token punctuation">(</span>SaveMode<span class="token punctuation">.</span>Overwrite<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">&quot;E:\\hello_DataFrame&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//保存数据</span>
    stuDf<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>write
      <span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">&quot;csv&quot;</span><span class="token punctuation">)</span>
      <span class="token comment">// 指定保存的目录</span>
      <span class="token punctuation">.</span>mode<span class="token punctuation">(</span>SaveMode<span class="token punctuation">.</span>Ignore<span class="token punctuation">)</span> <span class="token comment">//如果目标位置已存在数据，忽略</span>
      <span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">&quot;E:\\student_DataFrame&quot;</span><span class="token punctuation">)</span>
    sparkSession<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div></li></ul></li> <li><p>RDD转DataFrame方式</p> <ul><li><p>通过反射</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span>SparkConf
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>SparkSession

<span class="token comment">/**
 * 使用反射的方式实现RDD转DataFrame
 * RDD 转 DataFrame toDF()
 * DataFrame 转 RDD rdd
 */</span>
<span class="token keyword">object</span> RddToDataFrameByReflectScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 创建SparkSession对象，里面包含SparkContext和SqlContext</span>
    <span class="token keyword">val</span> sparkSession <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">&quot;RddToDataFrameByReflectScala&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>config<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 获取SparkContext</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>sparkContext
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;mike&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//基于反射直接将包含Student对象的dataRDD转换为DataFrame</span>
    <span class="token comment">//需要导入隐式转换</span>
    <span class="token keyword">import</span> <span class="token namespace">sparkSession<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_
    <span class="token keyword">val</span> stuDf <span class="token operator">=</span> dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tup <span class="token keyword">=&gt;</span> Student<span class="token punctuation">(</span>tup<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> tup<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toDF<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">//下面就可以通过DataFrame的方式操作dataRDD中的数据了</span>
    stuDf<span class="token punctuation">.</span>createOrReplaceTempView<span class="token punctuation">(</span><span class="token string">&quot;student&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">//执行sql查询</span>
    <span class="token keyword">val</span> resDf <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">&quot;select name,age from student where age &gt; 18&quot;</span><span class="token punctuation">)</span>
    sparkSession<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">&quot;select name,age from student where age &gt; 18&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//将DataFrame转化为RDD</span>
    <span class="token keyword">val</span> resRDD <span class="token operator">=</span> resDf<span class="token punctuation">.</span>rdd

    <span class="token comment">//从row中取数据，封装成student，打印到控制台</span>
    resRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>row <span class="token keyword">=&gt;</span> Student<span class="token punctuation">(</span>row<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toString<span class="token punctuation">,</span> row<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toString<span class="token punctuation">.</span>toInt<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">//使用row的getAs()方法，获取指定列名的值</span>
    resRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>row <span class="token keyword">=&gt;</span> Student<span class="token punctuation">(</span>row<span class="token punctuation">.</span>getAs<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> row<span class="token punctuation">.</span>getAs<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>

    sparkSession<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>


  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">// 定义一个样例类</span>
<span class="token keyword">case</span> <span class="token keyword">class</span> Student<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div></li> <li><p>通过编码</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span>SparkConf
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>types<span class="token punctuation">.</span></span><span class="token punctuation">{</span>IntegerType<span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> StructField<span class="token punctuation">,</span> StructType<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token punctuation">{</span>Row<span class="token punctuation">,</span> SparkSession<span class="token punctuation">}</span>

<span class="token comment">/**
 * 通过编码方式将RDD 转 DataFrame
 * 当case calss中的字段无法预先定义的时候，就只能用编程方式动态指定元数据了
 * 注意编程方式 将RDD 转 DataFrame 没有样例类
 */</span>
<span class="token keyword">object</span> RddToDataFrameByProgramScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//创建SparkSession对象，里面包含SparkContext和SqlContext</span>
    <span class="token keyword">val</span> sparkSession <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">&quot;RddToDataFrameByProgramScala&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>config<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">//获取SparkContext</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>sparkContext

    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;jessic&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//组装rowRDD</span>
    <span class="token keyword">val</span> rowRDD <span class="token operator">=</span> dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tup <span class="token keyword">=&gt;</span> Row<span class="token punctuation">(</span>tup<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> tup<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//指定元数据信息【这个元数据信息就可以动态从外部获取了，比较灵活】</span>
    <span class="token keyword">val</span> schema <span class="token operator">=</span> StructType<span class="token punctuation">(</span>Array<span class="token punctuation">(</span>
      StructField<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      StructField<span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> IntegerType<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//组装DataFrame</span>
    <span class="token keyword">val</span> stuDf <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span>rowRDD<span class="token punctuation">,</span> schema<span class="token punctuation">)</span>

    <span class="token comment">//下面就可以通过DataFrame的方式操作dataRDD中的数据了</span>
    stuDf<span class="token punctuation">.</span>createOrReplaceTempView<span class="token punctuation">(</span><span class="token string">&quot;student&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">//执行sql查询</span>
    sparkSession<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">&quot;select name,age from student where age &gt; 18&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> resDf <span class="token operator">=</span> sparkSession<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">&quot;select name,age from student where age &gt; 18&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">//将DataFrame转化为RDD</span>
    <span class="token keyword">val</span> resRDD <span class="token operator">=</span> resDf<span class="token punctuation">.</span>rdd

    resRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>row <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>row<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toString<span class="token punctuation">,</span> row<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toString<span class="token punctuation">.</span>toInt<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>

    sparkSession<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div></li></ul></li> <li><p>DataSet RDD DataFrame关系</p> <ul><li><p>结构图解</p> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221028130007609.png" alt="image-20221028130007609"></p> <blockquote><p>以 Person 为类型参数，但不了解 其内部结构。</p> <p>提供了详细的结构信息 schema 列的名称和类型。这样看起来就像一张表了。</p> <p>不光有 schema 信息，还有类型信息。</p></blockquote></li> <li><p>数据图解</p> <ul><li><p>RDD</p> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221028172258180.png" alt="image-20221028172258180"></p></li> <li><p>DataFrame</p> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221028172312925.png" alt="image-20221028172312925"></p></li> <li><p>DataSet</p> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221028172328341.png" alt="image-20221028172328341"></p></li></ul></li> <li><p>总结</p> <p>DataFrame = RDD - 泛型 + Schema + SQL + 优化</p> <p>DataSet = DataFrame + 泛型</p> <p>DataSet = RDD + Schema + SQL + 优化</p> <blockquote><p>在Spark2.0以后 DataFrame 为 DataSet的一个子集，称之为 DataSet[Row]</p></blockquote></li></ul></li> <li><p>SQL风格</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span>SparkContext
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token punctuation">{</span>DataFrame<span class="token punctuation">,</span> Dataset<span class="token punctuation">,</span> SparkSession<span class="token punctuation">}</span>

<span class="token comment">/**
 * SQL方式实现 wordCount
 */</span>
<span class="token keyword">object</span> SQLDemo <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//1.创建SparkSession</span>
    <span class="token keyword">val</span> spark<span class="token operator">:</span> SparkSession <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">&quot;SQLDemo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc<span class="token operator">:</span> SparkContext <span class="token operator">=</span> spark<span class="token punctuation">.</span>sparkContext
    sc<span class="token punctuation">.</span>setLogLevel<span class="token punctuation">(</span><span class="token string">&quot;WARN&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//2.读取文件</span>
    <span class="token comment">// text 返回DataFrame没有类型</span>
    <span class="token keyword">val</span> fileDF<span class="token operator">:</span> DataFrame <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">&quot;E:\\hello.txt&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// textFile 返回的是DataSet</span>
    <span class="token keyword">val</span> fileDS<span class="token operator">:</span> Dataset<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;E:\\hello.txt&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//    fileDF.show()</span>
    <span class="token comment">//    fileDS.show()</span>
    <span class="token comment">//3.对每一行按照空格进行切分并压平</span>
    <span class="token comment">//fileDF.flatMap(_.split(&quot; &quot;)) //注意:错误,因为DF没有泛型,不知道_是String</span>
    <span class="token keyword">import</span> <span class="token namespace">spark<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_
    <span class="token keyword">val</span> wordDS<span class="token operator">:</span> Dataset<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> fileDS<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//注意:正确,因为DS有泛型,知道_是String</span>
    wordDS<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 创建表</span>
    wordDS<span class="token punctuation">.</span>createOrReplaceTempView<span class="token punctuation">(</span><span class="token string">&quot;words&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sql <span class="token operator">=</span>
      <span class="token triple-quoted-string string">&quot;&quot;&quot;
        |select value ,count(value) as count
        |from words
        |group by value
        |order by count desc
      &quot;&quot;&quot;</span><span class="token punctuation">.</span>stripMargin
    spark<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    spark<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div></li> <li><p>DSL风格</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span>SparkContext
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token punctuation">{</span>DataFrame<span class="token punctuation">,</span> Dataset<span class="token punctuation">,</span> SparkSession<span class="token punctuation">}</span>

<span class="token comment">/**
 * DSL风格实现 wordCount
 */</span>
<span class="token keyword">object</span> DSLDemo <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//1.创建SparkSession</span>
    <span class="token keyword">val</span> spark<span class="token operator">:</span> SparkSession <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">&quot;DSLDemo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc<span class="token operator">:</span> SparkContext <span class="token operator">=</span> spark<span class="token punctuation">.</span>sparkContext
    sc<span class="token punctuation">.</span>setLogLevel<span class="token punctuation">(</span><span class="token string">&quot;WARN&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//2.读取文件</span>
    <span class="token comment">// text 返回DataFrame没有类型</span>
    <span class="token keyword">val</span> fileDF<span class="token operator">:</span> DataFrame <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">&quot;E:\\hello.txt&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// textFile 返回的是DataSet</span>
    <span class="token keyword">val</span> fileDS<span class="token operator">:</span> Dataset<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;E:\\hello.txt&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//    fileDF.show()</span>
<span class="token comment">//    fileDS.show()</span>
    <span class="token comment">//3.对每一行按照空格进行切分并压平</span>
    <span class="token comment">//fileDF.flatMap(_.split(&quot; &quot;)) //注意:错误,因为DF没有泛型,不知道_是String</span>
    <span class="token keyword">import</span> <span class="token namespace">spark<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_
    <span class="token keyword">val</span> wordDS<span class="token operator">:</span> Dataset<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> fileDS<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//注意:正确,因为DS有泛型,知道_是String</span>
    wordDS<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//wordDS.show()</span>
    <span class="token comment">/*
    +-----+
    |value|
    +-----+
    |hello|
    |  you|
    |hello|
    |   me|
    |hello|
    |world|
    |hello|
    |scala|
    |hello|
    |spark|
    |hello|
    |flink|
    +-----+

     */</span>
    <span class="token comment">//4.对上面的数据进行WordCount</span>
    wordDS<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>orderBy<span class="token punctuation">(</span>$<span class="token string">&quot;count&quot;</span><span class="token punctuation">.</span>desc<span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    spark<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><blockquote><p>注意<code>local[*]</code> 表示利用所有的CPU核数</p></blockquote></li> <li><p>SparkSQL 多数据源交互</p> <ul><li><p>读文件</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">// 读取 json文件 read.json 只是 read.format(&quot;json&quot;)的封装</span>
sparkSession<span class="token punctuation">.</span>read<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token string">&quot;D:\\data\\output\\json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 读取csv文件</span>
sparkSession<span class="token punctuation">.</span>read<span class="token punctuation">.</span>csv<span class="token punctuation">(</span><span class="token string">&quot;D:\\data\\output\\csv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toDF<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 读取 parquet文件</span>
sparkSession<span class="token punctuation">.</span>read<span class="token punctuation">.</span>parquet<span class="token punctuation">(</span><span class="token string">&quot;D:\\data\\output\\parquet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 读取MySQL表</span>
<span class="token keyword">val</span> prop1 <span class="token operator">=</span> <span class="token keyword">new</span> Properties<span class="token punctuation">(</span><span class="token punctuation">)</span>
    prop1<span class="token punctuation">.</span>setProperty<span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span>
    prop1<span class="token punctuation">.</span>setProperty<span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span>
    sparkSession<span class="token punctuation">.</span>read<span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">&quot;driver&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jdbc<span class="token punctuation">(</span>
      <span class="token string">&quot;jdbc:mysql://localhost:3306/spark_test?characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;student&quot;</span><span class="token punctuation">,</span>prop1<span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>注意也可以通过 <code>sparkSession.read(&quot;xxx&quot;).format().load()</code>来读取数据</p> <p>默认读取的是 <a href="https://blog.csdn.net/BIT_666/article/details/125447193" target="_blank" rel="noopener noreferrer">parquet文件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></li> <li><p>写文件</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">// 保存为Json文件</span>
personDF<span class="token punctuation">.</span>write<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token string">&quot;D:\\data\\output\\json&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 保存为 csv文件</span>
personDF<span class="token punctuation">.</span>write<span class="token punctuation">.</span>csv<span class="token punctuation">(</span><span class="token string">&quot;D:\\data\\output\\csv&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 保存为 parquet文件</span>
personDF<span class="token punctuation">.</span>write<span class="token punctuation">.</span>parquet<span class="token punctuation">(</span><span class="token string">&quot;D:\\data\\output\\parquet&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 保存为数据库表</span>
<span class="token keyword">val</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> Properties<span class="token punctuation">(</span><span class="token punctuation">)</span>
    prop<span class="token punctuation">.</span>setProperty<span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span>
    prop<span class="token punctuation">.</span>setProperty<span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span>
    stuDf<span class="token punctuation">.</span>write<span class="token punctuation">.</span>mode<span class="token punctuation">(</span>SaveMode<span class="token punctuation">.</span>Overwrite<span class="token punctuation">)</span><span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">&quot;driver&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jdbc<span class="token punctuation">(</span>
      <span class="token string">&quot;jdbc:mysql://localhost:3306/spark_test?characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;student&quot;</span><span class="token punctuation">,</span>prop<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>注意添加对应mysql jar包，我这里使用是MySQL 8.0 ,所以使用的驱动是<code>com.mysql.cj.jdbc.Driver</code>,注意设置时区</p> <p>注意也可以通过 <code>dataFrame.write().format().mode().save</code> 来保存文件</p></blockquote></li></ul></li></ul> <h3 id="_2-3-spark-streaming"><a href="#_2-3-spark-streaming" class="header-anchor">#</a> 2.3 Spark Streaming</h3> <ul><li><p>概念</p> <p>Spark Streaming是Spark Core API的一种扩展，它可以用于进行大规模、高吞吐量、容错的实时数据流的处理。
但是注意：这个实时属于近实时，最小可以支持秒级别的实时处理。</p></li> <li><p>原理</p> <p>接收实时输入数据流，然后将数据拆分成多个batch，比如每收集1秒的数据封装为一个batch，然后将每个batch交给Spark计算引擎进行处理，最后会生产出一个结果数据流，其中的数据，也是由一个一个的batch所组成的。</p></li> <li><p>wordCount</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">package</span> <span class="token namespace">streaming</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span>SparkConf
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span></span>RDD
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span></span><span class="token punctuation">{</span>Seconds<span class="token punctuation">,</span> StreamingContext<span class="token punctuation">}</span>

<span class="token comment">/**
 * 需求：通过socket模拟产生数据，实时计算数据中单词出现的次数
 * 只能计算每一次结果，不能累加
 *
 */</span>
<span class="token keyword">object</span> StreamWordCountScala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//创建SparkConf配置对象</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">//注意，此处的local[2]表示启动2个进程，一个进程负责读取数据源的数据，一个进程负责处理数据</span>
      <span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[2]&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;StreamWordCountScala&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//创建StreamingContext，指定数据处理间隔为5秒</span>
    <span class="token keyword">val</span> ssc <span class="token operator">=</span> <span class="token keyword">new</span> StreamingContext<span class="token punctuation">(</span>conf<span class="token punctuation">,</span> Seconds<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">//通过socket获取实时产生的数据</span>
    <span class="token keyword">val</span> linesRDD <span class="token operator">=</span> ssc<span class="token punctuation">.</span>socketTextStream<span class="token punctuation">(</span><span class="token string">&quot;bigdata04&quot;</span><span class="token punctuation">,</span><span class="token number">9001</span><span class="token punctuation">)</span>

    <span class="token comment">//对接收到的数据使用空格进行切割，转换成单个单词</span>
    <span class="token keyword">val</span> wordsRDD <span class="token operator">=</span> linesRDD<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//把每个单词转换为tuple2的形式</span>
    <span class="token keyword">val</span> tupRDD <span class="token operator">=</span> wordsRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//执行reduceByKey操作</span>
    <span class="token keyword">val</span> wordcountRDD <span class="token operator">=</span> tupRDD<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_ <span class="token operator">+</span> _<span class="token punctuation">)</span>

    <span class="token comment">//将结果数据打印到控制台</span>
    wordcountRDD<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">//启动任务</span>
    ssc<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//等待任务停止</span>
    ssc<span class="token punctuation">.</span>awaitTermination<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div></li> <li><p>实时计算wordCount，并累计历史结果</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">package</span> <span class="token namespace">streaming</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span></span><span class="token punctuation">{</span>Seconds<span class="token punctuation">,</span> StreamingContext<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>dstream<span class="token punctuation">.</span></span><span class="token punctuation">{</span>DStream<span class="token punctuation">,</span> ReceiverInputDStream<span class="token punctuation">}</span>

<span class="token comment">/**
 * 实时计算wordCount并累加历史结果
 * updateStateByKey 实时计算并累加计算结果
 */</span>
<span class="token keyword">object</span> StreamingWordCount2Scala <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//1.创建StreamingContext</span>
    <span class="token comment">//spark.master should be set as local[n], n &gt; 1</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;StreamingWordCount2Scala&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
    sc<span class="token punctuation">.</span>setLogLevel<span class="token punctuation">(</span><span class="token string">&quot;WARN&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> ssc <span class="token operator">=</span> <span class="token keyword">new</span> StreamingContext<span class="token punctuation">(</span>sc<span class="token punctuation">,</span>Seconds<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//5表示5秒中对数据进行切分形成一个RDD</span>
    <span class="token comment">//requirement failed: ....Please set it by StreamingContext.checkpoint().</span>
    <span class="token comment">//注意:我们在下面使用到了updateStateByKey对当前数据和历史数据进行累加</span>
    <span class="token comment">//那么历史数据存在哪?我们需要给他设置一个checkpoint目录</span>
    ssc<span class="token punctuation">.</span>checkpoint<span class="token punctuation">(</span><span class="token string">&quot;./wc&quot;</span><span class="token punctuation">)</span><span class="token comment">//开发中HDFS</span>
    <span class="token comment">//2.监听Socket接收数据</span>
    <span class="token comment">//ReceiverInputDStream就是接收到的所有的数据组成的RDD,封装成了DStream,接下来对DStream进行操作就是对RDD进行操作</span>
    <span class="token keyword">val</span> dataDStream<span class="token operator">:</span> ReceiverInputDStream<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> ssc<span class="token punctuation">.</span>socketTextStream<span class="token punctuation">(</span><span class="token string">&quot;bigdata04&quot;</span><span class="token punctuation">,</span><span class="token number">9001</span><span class="token punctuation">)</span>
    <span class="token comment">//3.操作数据</span>
    <span class="token keyword">val</span> wordDStream<span class="token operator">:</span> DStream<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataDStream<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> wordAndOneDStream<span class="token operator">:</span> DStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordDStream<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//val wordAndCount: DStream[(String, Int)] = wordAndOneDStream.reduceByKey(_+_)</span>
    <span class="token comment">//====================使用updateStateByKey对当前数据和历史数据进行累加====================</span>
    <span class="token keyword">val</span> wordAndCount<span class="token operator">:</span> DStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span>wordAndOneDStream<span class="token punctuation">.</span>updateStateByKey<span class="token punctuation">(</span>updateFunc<span class="token punctuation">)</span>
    wordAndCount<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ssc<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//开启</span>
    ssc<span class="token punctuation">.</span>awaitTermination<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//等待优雅停止</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//currentValues:当前批次的value值,如:1,1,1 (以测试数据中的hadoop为例)</span>
  <span class="token comment">//historyValue:之前累计的历史值,第一次没有值是0,第二次是3</span>
  <span class="token comment">//目标是把当前数据+历史数据返回作为新的结果(下次的历史数据)</span>
  <span class="token keyword">def</span> updateFunc<span class="token punctuation">(</span>currentValues<span class="token operator">:</span>Seq<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> historyValue<span class="token operator">:</span>Option<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token operator">:</span>Option<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token keyword">val</span> result<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> currentValues<span class="token punctuation">.</span>sum <span class="token operator">+</span> historyValue<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    Some<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div></li> <li><p>滑动计算(类似热搜实现)</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">package</span> <span class="token namespace">streaming</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span></span><span class="token punctuation">{</span>Seconds<span class="token punctuation">,</span> StreamingContext<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>dstream<span class="token punctuation">.</span></span><span class="token punctuation">{</span>DStream<span class="token punctuation">,</span> ReceiverInputDStream<span class="token punctuation">}</span>

<span class="token comment">/**
 * wordCount滑动计算
 *
 */</span>
<span class="token keyword">object</span> StreamingWordCount3Scala <span class="token punctuation">{</span>
      <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.创建StreamingContext</span>
        <span class="token comment">//spark.master should be set as local[n], n &gt; 1</span>
        <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;wc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
        sc<span class="token punctuation">.</span>setLogLevel<span class="token punctuation">(</span><span class="token string">&quot;WARN&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> ssc <span class="token operator">=</span> <span class="token keyword">new</span> StreamingContext<span class="token punctuation">(</span>sc<span class="token punctuation">,</span> Seconds<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//5表示5秒中对数据进行切分形成一个RDD</span>
        <span class="token comment">//2.监听Socket接收数据</span>
        <span class="token comment">//ReceiverInputDStream就是接收到的所有的数据组成的RDD,封装成了DStream,接下来对DStream进行操作就是对RDD进行操作</span>
        <span class="token keyword">val</span> dataDStream<span class="token operator">:</span> ReceiverInputDStream<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> ssc<span class="token punctuation">.</span>socketTextStream<span class="token punctuation">(</span><span class="token string">&quot;bigdata04&quot;</span><span class="token punctuation">,</span> <span class="token number">9001</span><span class="token punctuation">)</span>
        <span class="token comment">//3.操作数据</span>
        <span class="token keyword">val</span> wordDStream<span class="token operator">:</span> DStream<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataDStream<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> wordAndOneDStream<span class="token operator">:</span> DStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordDStream<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">//4.使用窗口函数进行WordCount计数</span>
        <span class="token comment">//reduceFunc: (V, V) =&gt; V,集合函数</span>
        <span class="token comment">//windowDuration: Duration,窗口长度/宽度</span>
        <span class="token comment">//slideDuration: Duration,窗口滑动间隔</span>
        <span class="token comment">//注意:windowDuration和slideDuration必须是batchDuration的倍数</span>
        <span class="token comment">//windowDuration=slideDuration:数据不会丢失也不会重复计算==开发中会使用</span>
        <span class="token comment">//windowDuration&gt;slideDuration:数据会重复计算==开发中会使用</span>
        <span class="token comment">//windowDuration&lt;slideDuration:数据会丢失</span>
        <span class="token comment">//下面的代码表示:</span>
        <span class="token comment">//windowDuration=10</span>
        <span class="token comment">//slideDuration=5</span>
        <span class="token comment">//那么执行结果就是每隔5s计算最近10s的数据</span>
        <span class="token comment">//比如开发中让你统计最近1小时的数据,每隔1分钟计算一次,那么参数该如何设置?</span>
        <span class="token comment">//windowDuration=Minutes(60)</span>
        <span class="token comment">//slideDuration=Minutes(1)</span>
        <span class="token comment">// 每隔5s 计算最近10s的数据</span>
        <span class="token keyword">val</span> wordAndCount<span class="token operator">:</span> DStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordAndOneDStream<span class="token punctuation">.</span>reduceByKeyAndWindow<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">,</span> Seconds<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Seconds<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        wordAndCount<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>
        ssc<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//开启</span>
        ssc<span class="token punctuation">.</span>awaitTermination<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//等待优雅停止</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div></li> <li><p>Spark整合Kafka</p></li></ul> <h3 id="_2-4-mlib"><a href="#_2-4-mlib" class="header-anchor">#</a> 2.4 MLib</h3> <h3 id="_2-5-graphx"><a href="#_2-5-graphx" class="header-anchor">#</a> 2.5 GraphX</h3> <h2 id="_3-spark-shuffle"><a href="#_3-spark-shuffle" class="header-anchor">#</a> 3. Spark shuffle</h2> <ul><li><p>概念</p> <p>shuffle 是集群范围内跨节点、跨进程的数据分发。它的本质是数据的重组和分发</p></li> <li><p>原理</p> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221028155715141.png" alt="image-20221028155715141"></p></li> <li><p>发展历程</p> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221028155737689.png" alt="image-20221028155737689"></p></li></ul> <h2 id="_4-spark-checkpoint"><a href="#_4-spark-checkpoint" class="header-anchor">#</a> 4. Spark checkpoint</h2> <ul><li><p>checkpoint概念</p> <p>Checkpoint 的产生就是为了更加可靠的数据持久化，在 Checkpoint 的时候一般把数据放在在 HDFS 上，这就天然的借助了 HDFS 天生的高容错、高可靠来实现数据最大程度上的安全，实现了 RDD 的容错和高可用。</p></li> <li><p>RDD checkpoint流程</p> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221028160403539.png" alt="image-20221028160403539"></p></li> <li><p>checkpoint与持久化区别</p> <ol><li>位置：Persist 和 Cache 只能保存在本地的磁盘和内存中(或者堆外内存--实验中) Checkpoint 可以保存数据到 HDFS 这类可靠的存储上。</li> <li>生命周期：Cache 和 Persist 的 RDD 会在程序结束后会被清除或者手动调用 unpersist 方法 Checkpoint 的 RDD 在程序结束后依然存在，不会被删除。</li></ol></li> <li><p>checkpoint使用</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{</span>SparkConf<span class="token punctuation">,</span> SparkContext<span class="token punctuation">}</span>

<span class="token comment">/**
 * 需求：checkpoint的使用
 * 
 */</span>
<span class="token keyword">object</span> CheckPointOpScala <span class="token punctuation">{</span>

  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;CheckPointOpScala&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>length<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      System<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">val</span> outputPath <span class="token operator">=</span> args<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token comment">//1：设置checkpint目录</span>
    sc<span class="token punctuation">.</span>setCheckpointDir<span class="token punctuation">(</span><span class="token string">&quot;hdfs://bigdata01:9000/chk001&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;hdfs://bigdata01:9000/hello_10000000.dat&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//2：对rdd执行checkpoint操作</span>
    dataRDD<span class="token punctuation">.</span>checkpoint<span class="token punctuation">(</span><span class="token punctuation">)</span>
    dataRDD<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_ <span class="token operator">+</span> _<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span>outputPath<span class="token punctuation">)</span>

    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div></li> <li><p>总结</p> <p>开发中如何保证数据的安全性性及读取效率：可以对频繁使用且重要的数据，先做缓存/持久化，再做 checkpint 操作。</p></li></ul> <h2 id="_5-故障排除"><a href="#_5-故障排除" class="header-anchor">#</a> 5. 故障排除</h2> <ul><li><p>避免内存溢出(OOM)-- 主要针对reduce端</p> <p>在Shuffle过程，reduce端task并不是等到map端task将其数据全部写入磁盘后再去拉取，而是map端写一点数据，reduce端task就会拉取一小部分数据，然后立即进行后面的聚合、算子函数的使用等操作。</p> <p>reduce端task能够拉取多少数据，由reduce拉取数据的缓冲区buffer来决定，因为<strong>拉取过来的数据都是先放在buffer中，然后再进行后续的处理，buffer的默认大小为48MB</strong>。</p> <p>reduce端task会一边拉取一边计算，不一定每次都会拉满48MB的数据，可能大多数时候拉取一部分数据就处理掉了。</p> <p>虽然说增大reduce端缓冲区大小可以减少拉取次数，提升Shuffle性能，但是有时map端的数据量非常大，写出的速度非常快，此时reduce端的所有task在拉取的时候，有可能全部达到自己缓冲的最大极限值，即48MB，此时，再加上reduce端执行的聚合函数的代码，可能会创建大量的对象，这可能会导致内存溢出，即<strong>OOM</strong>。</p> <p><strong>如果一旦出现reduce端内存溢出的问题，我们可以考虑减小reduce端拉取数据缓冲区的大小，例如减少为12MB</strong>。</p> <p>在实际生产环境中是出现过这种问题的，这是典型的<strong>以性能换执行的原理</strong>。reduce端拉取数据的缓冲区减小，不容易导致OOM，但是相应的，reudce端的拉取次数增加，造成更多的网络传输开销，造成性能的下降。</p> <blockquote><p>注意，要保证任务能够运行，再考虑性能的优化。</p></blockquote></li> <li><p>避免(JVM垃圾回收机制)JVMGC</p> <p>在Spark作业中，有时会出现<code>shuffle file not found</code>的错误，这是非常常见的一个报错，有时出现这种错误以后，选择重新执行一遍，就不再报出这种错误。</p> <p>出现上述问题可能的原因<strong>是Shuffle操作中，后面stage的task想要去上一个stage的task所在的Executor拉取数据，结果对方正在执行GC，执行GC会导致Executor内所有的工作现场全部停止</strong>，比如BlockManager、基于netty的网络通信等，这就会导致后面的task拉取数据拉取了半天都没有拉取到，就会报出<code>shuffle file not found</code>的错误，而第二次再次执行就不会再出现这种错误。</p> <p>可以通过调整reduce端拉取数据重试次数和reduce端拉取数据时间间隔这两个参数来对Shuffle性能进行调整，增大参数值，使得reduce端拉取数据的重试次数增加，并且每次失败后等待的时间间隔加长。</p> <p>JVM GC导致的shuffle文件拉取失败调整数据重试次数和reduce端拉取数据时间间隔：</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">&quot;spark.shuffle.io.maxRetries&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;6&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">&quot;spark.shuffle.io.retryWait&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;60s&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>网卡流量激增</p> <p>在YARN-client模式下，Driver启动在本地机器上，而Driver负责所有的任务调度，需要与YARN集群上的多个Executor进行频繁的通信。</p> <p>假设有100个Executor，1000个task，那么每个Executor分配到10个task，之后，Driver要频繁地跟Executor上运行的1000个task进行通信，通信数据非常多，并且通信品类特别高。这就导致有可能在Spark任务运行过程中，由于频繁大量的网络通讯，本地机器的网卡流量会激增。</p> <p>注意，YARN-client模式只会在测试环境中使用，而之所以使用YARN-client模式，是由于可以看到详细全面的log信息，通过查看log，可以锁定程序中存在的问题，避免在生产环境下发生故障。</p> <p>在生产环境下，使用的一定是YARN-cluster模式。在YARN-cluster模式下，就不会造成本地机器网卡流量激增问题，如果YARN-cluster模式下存在网络通信的问题，需要运维团队进行解决。</p></li> <li><p>JVM内存溢出</p> <p>当Spark作业中包含SparkSQL的内容时，可能会碰到YARN-client模式下可以运行，但是YARN-cluster模式下无法提交运行（报出OOM错误）的情况。</p> <p>YARN-client模式下，Driver是运行在本地机器上的，Spark使用的JVM的PermGen的配置，是本地机器上的spark-class文件，JVM永久代的大小是128MB，这个是没有问题的，但是在YARN-cluster模式下，Driver运行在YARN集群的某个节点上，使用的是没有经过配置的默认设置，PermGen永久代大小为82MB。</p> <p>SparkSQL的内部要进行很复杂的SQL的语义解析、语法树转换等等，非常复杂，如果sql语句本身就非常复杂，那么很有可能会导致性能的损耗和内存的占用，特别是对PermGen的占用会比较大。</p> <p>所以，此时如果PermGen占用好过了82MB，但是又小于128MB，就会出现YARN-client模式下可以运行，YARN-cluster模式下无法运行的情况。</p> <p>解决上述问题的方法是增加PermGen(永久代)的容量，需要在spark-submit脚本中对相关参数进行设置，设置方法如下：</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token operator">--</span>conf spark<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>extraJavaOptions<span class="token operator">=</span><span class="token string">&quot;-XX:PermSize=128M -XX:MaxPermSize=256M&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过上述方法就设置了Driver永久代的大小，默认为128MB，最大256MB，这样就可以避免上面所说的问题。</p></li></ul> <h2 id="_6-性能调优"><a href="#_6-性能调优" class="header-anchor">#</a> 6. 性能调优</h2> <ul><li>RDD 算子调优</li> <li>Shuffle 调优</li> <li>高性能序列化类库</li> <li>持久化或者checkpoint</li> <li>JVM垃圾回收调优</li> <li>提高并行度</li> <li>数据本地化</li></ul> <h2 id="_7-数据倾斜"><a href="#_7-数据倾斜" class="header-anchor">#</a> 7. 数据倾斜</h2> <ul><li><p>数据倾斜的定义</p> <p>Spark中的数据倾斜问题主要指shuffle过程中出现的数据倾斜问题，是由于不同的key对应的数据量不同导致的不同task所处理的数据量不同的问题。</p> <blockquote><p>注意，要区分开<strong>数据倾斜</strong>与<strong>数据过量</strong>这两种情况，数据倾斜是指少数task被分配了绝大多数的数据，因此少数task运行缓慢；数据过量是指所有task被分配的数据量都很大，相差不多，所有task都运行缓慢。</p></blockquote></li> <li><p>数据倾斜的判断</p> <ol><li>Spark作业的大部分task都执行迅速，只有有限的几个task执行的非常慢，此时可能出现了数据倾斜，作业可以运行，但是运行得非常慢；</li> <li>Spark作业的大部分task都执行迅速，但是有的task在运行过程中会突然报出OOM，反复执行几次都在某一个task报出OOM错误，此时可能出现了数据倾斜，作业无法正常运行。定位数据倾斜问题：</li> <li>查阅代码中的shuffle算子，例如reduceByKey、countByKey、groupByKey、join等算子，根据代码逻辑判断此处是否会出现数据倾斜；</li> <li>查看Spark作业的log文件，log文件对于错误的记录会精确到代码的某一行，可以根据异常定位到的代码位置来明确错误发生在第几个stage，对应的shuffle算子是哪一个；</li></ol></li> <li><p>数据倾斜的解决办法</p> <ul><li><p>预聚合原始数据</p> <ul><li>避免shuffle</li> <li>增大数据粒度</li></ul></li> <li><p>预处理导致倾斜的key</p> <ul><li><p>过滤</p> <p>如果在Spark作业中允许丢弃某些数据，那么可以考虑将可能导致数据倾斜的key进行过滤，滤除可能导致数据倾斜的key对应的数据，这样，在Spark作业中就不会发生数据倾斜了。</p></li> <li><p>使用随机Key</p> <p>首先，通过map算子给每个数据的key添加随机数前缀，对key进行打散，将原先一样的key变成不一样的key，然后进行第一次聚合，这样就可以让原本被一个task处理的数据分散到多个task上去做局部聚合；随后，去除掉每个key的前缀，再次进行聚合。</p></li></ul></li> <li><p>提高reduce并行度</p></li></ul></li></ul> <h2 id="_8-底层执行原理"><a href="#_8-底层执行原理" class="header-anchor">#</a> 8. 底层执行原理</h2> <ul><li><p>spark 运行流程</p> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221028170111633.png" alt="image-20221028170111633"></p></li> <li><p>Spark 常见进程</p> <ul><li><p>Driver：</p> <p>我们编写的Spark程序就在Driver(进程)上，由Driver进程负责执行,Driver进程所在的节点可以是Spark集群的某一个节点或者就是我们提交Spark程序的客户端节点,具体Driver进程在哪个节点上启动是由我们提交任务时指定的参数决定的</p></li> <li><p>Master</p> <p>集群的主节点中启动的进程,主要负责集群资源的管理和分配，还有集群的监控等</p></li> <li><p>Worker</p> <p>集群的从节点中启动的进程,主要负责启动其它进程来执行具体数据的处理和计算任务</p></li> <li><p>Executor</p> <p>此进程由Worker负责启动，主要为了执行数据处理和计算</p></li> <li><p>Task</p> <p>是一个线程,由Executor负责启动，它是真正干活的</p></li></ul></li> <li><p>DAG</p> <ul><li><p>DAG 概念</p> <p>DAG(Directed Acyclic Graph 有向无环图)指的是数据转换执行的过程，有方向，无闭环(其实就是 RDD 执行的流程)；
原始的 RDD 通过一系列的转换操作就形成了 DAG 有向无环图，任务执行时，可以按照 DAG 的描述，执行真正的计算(数据被操作的一个过程)。</p></li> <li><p>DAG边界</p> <p>开始:通过 SparkContext 创建的 RDD；，结束:触发 Action，一旦触发 Action 就形成了一个完整的 DAG。</p></li> <li><p>DAG 划分 Stage</p> <p><img src="/blog/%E7%AC%AC%E4%B9%9D%E7%AB%A0Spark.assets/image-20221028172129558.png" alt="image-20221028172129558"></p> <p>一个 Spark 程序可以有多个 DAG(有几个 Action，就有几个 DAG，上图最后只有一个 Action（图中未表现）,那么就是一个 DAG)。</p> <p>一个 DAG 可以有多个 Stage(根据宽依赖/shuffle 进行划分)。</p> <p>同一个 Stage 可以有多个 Task 并行执行(task 数=分区数，如上图，Stage1 中有三个分区 P1、P2、P3，对应的也有三个 Task)。</p> <p>可以看到这个 DAG 中只 reduceByKey 操作是一个宽依赖，Spark 内核会以此为边界将其前后划分成不同的 Stage。</p> <p>同时我们可以注意到，在图中 Stage1 中，从 textFile 到 flatMap 到 map 都是窄依赖，这几步操作可以形成一个流水线操作，通过 flatMap 操作生成的 partition 可以不用等待整个 RDD 计算结束，而是继续进行 map 操作，这样大大提高了计算的效率。</p></li></ul></li> <li><p>宽依赖和窄依赖</p> <ul><li><p>宽依赖</p> <p>宽依赖(Shuffle Dependency)：父RDD的每个分区都可能被子RDD的多个分区使用，例如groupByKey、reduceByKey，sortBykey等算子，这些算子其实都会产生shuffle操作
也就是说，每一个父RDD的partition中的数据都可能会传输一部分到下一个RDD的每个partition中。此时就会出现，父RDD和子RDD的partition之间，具有错综复杂的关系，那么，这种情况就叫做两个RDD之间是宽依赖，同时，他们之间会发生shuffle操作。</p></li> <li><p>窄依赖</p> <p>窄依赖(Narrow Dependency)：指父RDD的每个分区只被子RDD的一个分区所使用，例如map、filter等这些算子
一个RDD，对它的父RDD只有简单的一对一的关系，也就是说，RDD的每个partition仅仅依赖于父RDD中的一个partition，父RDD和子RDD的partition之间的对应关系，是一对一的。</p></li></ul></li> <li><p>划分Staage 核心算法</p> <p>spark job是根据action算子触发的,遇到action算子就会起一个jobSpark Job会被划分为多个Stage，每一个Stage是由一组并行的Task组成的。</p> <blockquote><p>stage的划分依据就是看是否产生了shuflle(即宽依赖),遇到一个shuffle操作就划分为前后两个stage
stage是由一组并行的task组成，stage会将一批task用TaskSet来封装，提交给TaskScheduler进行分配，最后发送到Executor执行</p> <p>注意：Stage的划分规则：从后往前，遇到宽依赖就划分Stage</p></blockquote></li></ul></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/handbook/bigdata/scala.html" class="prev">
          第八章 Scala
        </a></span> <span class="next"><a href="/blog/handbook/bigdata/flink.html">
          第十章 Flink
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-7115df4a data-v-1c636796><li class="level-2" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_0-思维导图" class="sidebar-link reco-side-_0-思维导图" data-v-7115df4a>0. 思维导图</a></li><li class="level-2" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_1-spark基础" class="sidebar-link reco-side-_1-spark基础" data-v-7115df4a>1.Spark基础</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_1-1-spark概念" class="sidebar-link reco-side-_1-1-spark概念" data-v-7115df4a>1.1 Spark概念</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_1-2-spark特点" class="sidebar-link reco-side-_1-2-spark特点" data-v-7115df4a>1.2 Spark特点</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_1-3-spark和hadoop对比" class="sidebar-link reco-side-_1-3-spark和hadoop对比" data-v-7115df4a>1.3 Spark和Hadoop对比</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_1-4-spark-和-hadoop结合使用" class="sidebar-link reco-side-_1-4-spark-和-hadoop结合使用" data-v-7115df4a>1.4 Spark 和 Hadoop结合使用</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_1-5-spark主要应用场景" class="sidebar-link reco-side-_1-5-spark主要应用场景" data-v-7115df4a>1.5 Spark主要应用场景</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_1-6-spark部署方式" class="sidebar-link reco-side-_1-6-spark部署方式" data-v-7115df4a>1.6 Spark部署方式</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_1-7-idea配置scala开发环境" class="sidebar-link reco-side-_1-7-idea配置scala开发环境" data-v-7115df4a>1.7 idea配置Scala开发环境</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_1-8-spark任务提交的方式" class="sidebar-link reco-side-_1-8-spark任务提交的方式" data-v-7115df4a>1.8 spark任务提交的方式</a></li><li class="level-2" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_2-spark五大模块" class="sidebar-link reco-side-_2-spark五大模块" data-v-7115df4a>2. Spark五大模块</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_2-1-spark-core" class="sidebar-link reco-side-_2-1-spark-core" data-v-7115df4a>2.1 Spark Core</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_2-2-spark-sql" class="sidebar-link reco-side-_2-2-spark-sql" data-v-7115df4a>2.2 Spark SQL</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_2-3-spark-streaming" class="sidebar-link reco-side-_2-3-spark-streaming" data-v-7115df4a>2.3 Spark Streaming</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_2-4-mlib" class="sidebar-link reco-side-_2-4-mlib" data-v-7115df4a>2.4 MLib</a></li><li class="level-3" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_2-5-graphx" class="sidebar-link reco-side-_2-5-graphx" data-v-7115df4a>2.5 GraphX</a></li><li class="level-2" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_3-spark-shuffle" class="sidebar-link reco-side-_3-spark-shuffle" data-v-7115df4a>3. Spark shuffle</a></li><li class="level-2" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_4-spark-checkpoint" class="sidebar-link reco-side-_4-spark-checkpoint" data-v-7115df4a>4. Spark checkpoint</a></li><li class="level-2" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_5-故障排除" class="sidebar-link reco-side-_5-故障排除" data-v-7115df4a>5. 故障排除</a></li><li class="level-2" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_6-性能调优" class="sidebar-link reco-side-_6-性能调优" data-v-7115df4a>6. 性能调优</a></li><li class="level-2" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_7-数据倾斜" class="sidebar-link reco-side-_7-数据倾斜" data-v-7115df4a>7. 数据倾斜</a></li><li class="level-2" data-v-7115df4a><a href="/blog/handbook/bigdata/spark.html#_8-底层执行原理" class="sidebar-link reco-side-_8-底层执行原理" data-v-7115df4a>8. 底层执行原理</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-65133105 data-v-65133105><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-65133105><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-65133105></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-65133105></path></svg></div><canvas id="vuepress-canvas-cursor"></canvas><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:50px;bottom:-70px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/blog/assets/js/app.f600c34c.js" defer></script><script src="/blog/assets/js/3.1aae9359.js" defer></script><script src="/blog/assets/js/1.ae8a88ec.js" defer></script><script src="/blog/assets/js/49.eaea0707.js" defer></script>
  </body>
</html>
